

<!DOCTYPE html>
<html class="writer-html5" lang="it" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stima WiFi V3 &mdash; http://rmap.cc</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=7a5cd723" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=b3290714"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/translations.js?v=45930005"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Indice" href="../../genindex.html" />
    <link rel="search" title="Cerca" href="../../search.html" />
    <link rel="next" title="Testa di prelievo per sensori Air Quality" href="../testa_prelievo/testa_prelievo.html" />
    <link rel="prev" title="Stima WiFi V2" href="../stimawifi_v2/stima_wifi_howto.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            RMAP e Stima
              <img src="../../_static/logo_stima.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Cerca documenti" aria-label="Cerca documenti" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Menu di navigazione">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../rmap_rfc/rfc.html">RFC rmap versione 3.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../obsolete/index.html">Stima obsolete</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stima_v3/stima_v3.html">Stima V3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stima_v4/stima_v4.html">Stima V4</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Stima WiFi</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../stimawifi_v2/stima_wifi_howto.html">Stima WiFi V2</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Stima WiFi V3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduzione">Introduzione</a></li>
<li class="toctree-l3"><a class="reference internal" href="#schema-a-blocchi">Schema a blocchi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bus-i2c">BUS I2C</a></li>
<li class="toctree-l3"><a class="reference internal" href="#componenti-hardware">Componenti Hardware</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#elenco-componenti-elettroniche-e-sensori">Elenco componenti elettroniche e sensori</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mcu-espressif-esp32-c3">MCU - Espressif ESP32 C3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rtc-and-microsd-data-logger-shield">RTC and Microsd Data Logger Shield</a></li>
<li class="toctree-l4"><a class="reference internal" href="#oled-0-96-shield">OLED 0.96 Shield</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tft-i2c-connector-shield">TFT I2C Connector Shield</a></li>
<li class="toctree-l4"><a class="reference internal" href="#power-shield">Power Shield</a></li>
<li class="toctree-l4"><a class="reference internal" href="#base-board">Base Board</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#hardware-alternativo-compatibile-sconsigliato-o-obsoleto">Hardware alternativo compatibile (sconsigliato o obsoleto)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#oled-shield">Oled Shield</a></li>
<li class="toctree-l4"><a class="reference internal" href="#micro-sd-card-shield">Micro SD Card Shield</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#assemblaggio-componenti-elettroniche-e-sensori">Assemblaggio componenti elettroniche e sensori</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scatola">Scatola</a></li>
<li class="toctree-l3"><a class="reference internal" href="#schermo-solare">Schermo solare</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#connessione-device">Connessione Device</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sensori">Sensori</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sensirion-sps30-sensore-per-le-polveri-sottili">Sensirion SPS30 (Sensore per le polveri sottili)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sensirion-scd30-sensore-co-2">Sensirion SCD30 (Sensore CO 2 )</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sensirion-sht85-sensore-umidita-temperatura">Sensirion SHT85 (Sensore Umidità &amp; Temperatura)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#software">Software</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#thread-loop-arduino">thread loop arduino</a></li>
<li class="toctree-l4"><a class="reference internal" href="#threadmeasure">threadMeasure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#threadpublish">threadPublish</a></li>
<li class="toctree-l4"><a class="reference internal" href="#threaddb">threadDb</a></li>
<li class="toctree-l4"><a class="reference internal" href="#threadudp">threadUdp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#threadgps">threadGps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#remote-procedure-call">Remote Procedure Call</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#messa-in-opera-della-stazione">Messa in opera della stazione</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assemblaggio-scheda-elettronica">Assemblaggio scheda elettronica</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#strumentazione-necessaria">Strumentazione necessaria</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dotazione-software">Dotazione Software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#caricamento-firmware">Caricamento firmware</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Strumentazione necessaria</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Dotazione Software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#collegamento-dei-sensori">Collegamento dei sensori</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">Strumentazione necessaria</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">Dotazione Software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#censimento-stazione">Censimento stazione</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">Strumentazione necessaria</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">Dotazione Software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#collaudo-stazione">Collaudo Stazione</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#reset-della-configurazione">Reset della configurazione</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">Strumentazione necessaria</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">Dotazione Software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#preparazione-del-guscio">Preparazione del guscio</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">Strumentazione necessaria</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">Dotazione Software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installazione-in-loco">Installazione in loco</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installazione-schermo-solare-e-sensore-temperatura">Installazione schermo solare e sensore temperatura</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#todo">TODO</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configurazione-firmware-software-python-json-nodered">Configurazione // Firmware + Software // Python + Json // NodeRed</a></li>
<li class="toctree-l3"><a class="reference internal" href="#appendice-a-checklist-installazione">Appendice A Checklist installazione</a></li>
<li class="toctree-l3"><a class="reference internal" href="#appendice-b-accesso-wifi">Appendice B Accesso WiFi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#appendice-c-pin">Appendice C PIN</a></li>
<li class="toctree-l3"><a class="reference internal" href="#appendice-d-indirizzi-i2c">Appendice D Indirizzi I2C</a></li>
<li class="toctree-l3"><a class="reference internal" href="#appendice-e-i2c-resistenze-di-pull-up">Appendice E I2C resistenze di pull up</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../testa_prelievo/testa_prelievo.html">Testa di prelievo per sensori Air Quality</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../server_rmap/server_rmap.html">Server RMAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../videotutorial/videotutorial.html">Videotutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dispense/index.html">Dispense</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../progetti/index.html">Progetti</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Menu navigazione dispositivi mobili" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">RMAP e Stima</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Naviga tra le pagine">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Stima WiFi</a></li>
      <li class="breadcrumb-item active">Stima WiFi V3</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/stima_wifi/stimawifi_v3/stima_wifi_howto.rst.txt" rel="nofollow"> Visualizza sorgente pagina</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="stima-wifi-v3">
<span id="stimawifi-v3-reference"></span><h1>Stima WiFi V3<a class="headerlink" href="#stima-wifi-v3" title="Link to this heading"></a></h1>
<section id="introduzione">
<h2>Introduzione<a class="headerlink" href="#introduzione" title="Link to this heading"></a></h2>
<p>Stima WiFi è una stazione di monitoraggio ambientale, uno strumento
che misura in modo continuativo, a intervalli regolari, alcuni
parametri chimici e fisici che caratterizzano l’inquinamento e le
proprietà dell’ambiente in cui viviamo.</p>
<p>La stazione Stima WiFi è un apparato pensato per il monitoraggio
ambientale non troppo complicato da assemblare e di costo
relativamento contenuto.  Il software e, nei limiti del possibile,
l’hardware utilizzato è stato selezionato per permettere la
condivisione di schemi di assemblaggio, firmware e software di
supporto sotto licenze libere.  Anche i dati raccolti sono
rilasciati con una licenza permissiva CC-BY 4.0</p>
<p>La stazione è stata progettata per essere generalmente installata in
ambiente urbano. I criteri per la sua installazione sono diversi e
meno stringenti da quelli da seguire per la messa in opera e l’uso di
stazioni meteorologiche di riferimento a standard dell'Organizzazione
Mondiale della Meteorologia ma bisogna comunque seguire alcuni criteri</p>
<img alt="../../_images/stimawifi.png" src="../../_images/stimawifi.png" />
<p><strong>Pavimenti bassi, soffitti alti e stanze spaziose</strong></p>
<p>Quando discuteva di tecnologie di supporto alla didattica Seymour
Papert sottolineava spesso l’importanza di &quot;pavimenti bassi&quot; e dei
&quot;soffitti alti&quot;. Per essere efficace, affermava, una tecnologia deve
essere facile da apprendere ed esplorare per i principianti (pavimenti
bassi) ma, con il tempo, deve permettere di lavorare su progetti
sempre più sofisticati (soffitti alti).</p>
<p>Per un quadro più completo, bisogna aggiungere una dimensione in più
l’ampiezza dell’ambiente [di apprendimento] (stanze spaziose). Non
basta prevedere un percorso di apprendimento dal pavimento basso al
soffitto alto; dobbiamo offrire la possibilità di esplorare differenti
percorsi significativi.</p>
<p>[libera interpretazione del pensiero di] Mitchel Resnick</p>
<a class="reference internal image-reference" href="../../_images/stimawifi_open1.png"><img alt="../../_images/stimawifi_open1.png" src="../../_images/stimawifi_open1.png" style="width: 50%;" />
</a>
<a class="reference internal image-reference" href="../../_images/stimawifi_open2.png"><img alt="../../_images/stimawifi_open2.png" src="../../_images/stimawifi_open2.png" style="width: 50%;" />
</a>
</section>
<section id="schema-a-blocchi">
<h2>Schema a blocchi<a class="headerlink" href="#schema-a-blocchi" title="Link to this heading"></a></h2>
<img alt="../../_images/stimawifi_blocchi.png" src="../../_images/stimawifi_blocchi.png" />
<p>Caratteristiche del progetto:</p>
<ul class="simple">
<li><p>Precisione delle misure;</p></li>
<li><p>Economicità dell’hardware</p></li>
<li><p>Facilità di assemblaggio</p></li>
<li><p>Possibilità di personalizzazione</p></li>
</ul>
<p>Il progetto RMAP, di cui la stazione Stima WiFi fa parte, è in
continua evoluzione e così la stazione di monitoraggio ha vissuto
diverse incarnazioni, variando la sua conﬁgurazione in base
all’hardware via via disponibile.</p>
</section>
<section id="bus-i2c">
<h2>BUS I2C<a class="headerlink" href="#bus-i2c" title="Link to this heading"></a></h2>
<p>Stima WiFi controlla i sensori via bus I2C.
<a class="reference external" href="http://www.i2c-bus.org/">http://www.i2c-bus.org/</a>
<a class="reference external" href="https://www.nxp.com/docs/en/application-note/AN10216.pdf">https://www.nxp.com/docs/en/application-note/AN10216.pdf</a></p>
<ul class="simple">
<li><p>Protocollo seriale (sincrono)</p></li>
<li><p>due sole linee comunicazione
* SCL (Serial CLock) (sincronia)
* SDA (Serial DAta)</p></li>
<li><p>Single Master ~ slave // Multi-master</p></li>
<li><p>Lento (100/400 kbit/s)</p></li>
<li><p>Supporta ﬁno a 127 device</p></li>
<li><p>Ogni device ha indirizzo univoco (sul bus)</p></li>
</ul>
<p>Semplice interazione basata su messaggi (Master invia richiesta ad
indirizzo device slave, slave device risponde solo se interpellato)</p>
</section>
<section id="componenti-hardware">
<h2>Componenti Hardware<a class="headerlink" href="#componenti-hardware" title="Link to this heading"></a></h2>
<section id="elenco-componenti-elettroniche-e-sensori">
<h3>Elenco componenti elettroniche e sensori<a class="headerlink" href="#elenco-componenti-elettroniche-e-sensori" title="Link to this heading"></a></h3>
<a class="reference internal image-reference" href="../../_images/stimawifi_bom_mini.jpg"><img alt="../../_images/stimawifi_bom_mini.jpg" src="../../_images/stimawifi_bom_mini.jpg" style="width: 50%;" />
</a>
<p><a class="reference download internal" download="" href="../../_downloads/ae5db8689c59603d059a8783bf7845b8/stimawifi_bom.jpg"><code class="xref download docutils literal notranslate"><span class="pre">immagine</span> <span class="pre">ad</span> <span class="pre">alta</span> <span class="pre">risoluzione</span></code></a>.</p>
<section id="datalogger">
<h4>Datalogger<a class="headerlink" href="#datalogger" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>C3 Mini V2.1.0 - LOLIN WIFI Bluetooth LE BLE Scheda IOT ESP32-C3FH4 ESP32-C3 4MB FLASH
<a class="reference external" href="https://it.aliexpress.com/item/1005006753245627.html">https://it.aliexpress.com/item/1005006753245627.html</a>
5,49€</p></li>
<li><p>DC Power Shield V1.1.0 per LOLIN (WEMOS) D1 mini
<a class="reference external" href="https://it.aliexpress.com/item/32790327733.html">https://it.aliexpress.com/item/32790327733.html</a>
2,63€</p></li>
<li><p>OLED 0.96 Shield V1.0.0 per LOLIN (WEMOS) D1 mini D32 0.96 &quot;pollici 128X64 IIC I2C
<a class="reference external" href="https://it.aliexpress.com/item/1005001804136025.html">https://it.aliexpress.com/item/1005001804136025.html</a>
3,89€</p></li>
<li><p>Shield connettore TFT I2C V1.1.0 per LOLIN (WEMOS) D1 mini 1x TFT, 2x I2C e 1x connettore IO utente
<a class="reference external" href="https://it.aliexpress.com/item/32846977179.html">https://it.aliexpress.com/item/32846977179.html</a>
1,69€</p></li>
<li><p>Cavo I2C 100mm 10cm per cavo a doppia testa LOLIN (WEMOS) SH1.0 4P
<a class="reference external" href="https://it.aliexpress.com/item/32867490848.html">https://it.aliexpress.com/item/32867490848.html</a>
1,45€</p></li>
<li><p>Data Logger Shield DS1307 slot microSD Wemos per estensione D1 Mini
<a class="reference external" href="https://www.ebay.it/itm/255283310856">https://www.ebay.it/itm/255283310856</a>
EUR 5,75</p></li>
<li><p>SanDisk 128 GB Ultra microSDXC UHS-I scheda, con adattatore SD, fino a 140 MB/s, prestazioni dell'app A1, Classe 10, U1. Twin Pack
<a class="reference external" href="https://www.amazon.it/dp/B0B7NVV55M">https://www.amazon.it/dp/B0B7NVV55M</a>
16,82€ / unità</p></li>
<li><p>7X Duracell 1220 (7 Blister Da 1 Batteria) 7 Pile (CR1220)
<a class="reference external" href="https://www.amazon.it/dp/B0C86NRTXV">https://www.amazon.it/dp/B0C86NRTXV</a>
2,82€ /unità</p></li>
<li><p>numero 15 PCB doppia faccia con spedizione e tasse
<a class="reference external" href="https://jlcpcb.com">https://jlcpcb.com</a>
9,54€</p></li>
<li><p>Funmo 50 morsetti a vite PCB 2,54 mm 0,1&quot; Pitch PCB Mount Screw Terminal Block, 2 pin/3 pin/4 pin, per cavi da 26-18AWG
<a class="reference external" href="https://www.amazon.it/dp/B0CQ243JHC">https://www.amazon.it/dp/B0CQ243JHC</a>
12,99€</p></li>
<li><p>Alimentatore switching 12V / 1,5A – 18W
<a class="reference external" href="https://futuranet.it/prodotto/alimentatore-switching-12v-15a-18w/">https://futuranet.it/prodotto/alimentatore-switching-12v-15a-18w/</a>
8,55€</p></li>
<li><p>Cavo prolunga DC maschio / DC femmina – 3 metri
<a class="reference external" href="https://futuranet.it/prodotto/cavo-prolunga-dc-maschio-dc-femmina-3-metri/">https://futuranet.it/prodotto/cavo-prolunga-dc-maschio-dc-femmina-3-metri/</a>
4,50€</p></li>
<li><p>Scatola di derivazione Gewiss, Plastica Grigio, 150 x 110 x 70mm
<a class="reference external" href="https://it.rs-online.com/web/p/scatole-di-derivazione/3038288">https://it.rs-online.com/web/p/scatole-di-derivazione/3038288</a>
13,97€</p></li>
</ul>
</section>
<section id="sensori-e-cavi">
<h4>Sensori e cavi<a class="headerlink" href="#sensori-e-cavi" title="Link to this heading"></a></h4>
<p>Particolato</p>
<ul class="simple">
<li><p>SENSIRION SPS30
<a class="reference external" href="https://www.tme.eu/it/details/sps30/sensori-di-gas/sensirion/1-101638-10/">https://www.tme.eu/it/details/sps30/sensori-di-gas/sensirion/1-101638-10/</a>
48,8€</p></li>
<li><p>Connettore ZHR-5 from JST Micro JST 5 pin 1,25 mm connettore 28AWG 20 cm
<a class="reference external" href="https://www.ebay.it/itm/205681297852">https://www.ebay.it/itm/205681297852</a>
4,55€</p></li>
</ul>
<p>CO2</p>
<ul class="simple">
<li><p>Sensirion SCD30
<a class="reference external" href="https://www.tme.eu/it/details/scd30/sensori-dumidita/sensirion/1-101625-10/">https://www.tme.eu/it/details/scd30/sensori-dumidita/sensirion/1-101625-10/</a>
55€</p></li>
<li><p>10 set SH1.0  connettore femmina + maschio 4P spina con cavo 20 cm
<a class="reference external" href="https://it.aliexpress.com/item/1005001649158434.html">https://it.aliexpress.com/item/1005001649158434.html</a>
3,41€</p></li>
</ul>
<p>Temperatura e Umidità</p>
<ul class="simple">
<li><p>Sensirion SHT85
<a class="reference external" href="https://www.tme.eu/it/details/sht85/sensori-dumidita/sensirion/3-000-074/">https://www.tme.eu/it/details/sht85/sensori-dumidita/sensirion/3-000-074/</a>
31€</p></li>
<li><p>Morsettiera collegabile Harting Femmina a 4 vie, 1 fila, passo 1.27mm, Montaggio su cavo
<a class="reference external" href="https://it.rs-online.com/web/p/morsettiere-innestabili/8164994">https://it.rs-online.com/web/p/morsettiere-innestabili/8164994</a>
4,65 €</p></li>
<li><p>cavo dati numero di fili 4,  sezione nominale del conduttore 0.14, lunghezza 1m
<a class="reference external" href="https://www.igus.it/product/CF240?artnr=CF240.01.04">https://www.igus.it/product/CF240?artnr=CF240.01.04</a>
<a class="reference external" href="https://it.rs-online.com/web/p/cavi-di-comando/2100551">https://it.rs-online.com/web/p/cavi-di-comando/2100551</a>
2,34-3.0 EUR / m</p></li>
</ul>
<p>Schermo radiazioni per temperatura e umidità</p>
<ul class="simple">
<li><p>TFA Dostmann Copertura Protettiva Custodia Protettiva, Protegge dalle precipitazioni e dai Raggi solari, buona circolazione, Bianco
<a class="reference external" href="https://www.amazon.it/dp/B017ILZF6C">https://www.amazon.it/dp/B017ILZF6C</a>
14,49€</p></li>
</ul>
<p>in alternativa la versione delux</p>
<ul class="simple">
<li><p>TFA Dostmann Custodia protettiva per sensore esterno, 98.1111.02,
custodia protettiva, copertura del trasmettitore di stazioni
meteorologiche/termometro, protegge dalle precipitazioni
<a class="reference external" href="https://www.amazon.it/dp/B0CK2RJ2BS">https://www.amazon.it/dp/B0CK2RJ2BS</a>
35,99€</p></li>
</ul>
</section>
<section id="gps-per-stazione-mobile">
<h4>GPS per stazione mobile<a class="headerlink" href="#gps-per-stazione-mobile" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Waveshare LC76G Multi-GNSS Module Compatible with Raspberry PI, Supports GPS, BDS, GLONASS, Galileo, QZSS
<a class="reference external" href="https://www.amazon.it/dp/B0C498QPS3">https://www.amazon.it/dp/B0C498QPS3</a>
24,99€</p></li>
</ul>
<p>oppure:</p>
<ul class="simple">
<li><p>Reland Sun Modulo GPS micro USB NEO-6M NEO-7M NEO-8M (8M-A)
<a class="reference external" href="https://www.amazon.it/dp/B09YCBYLBR">https://www.amazon.it/dp/B09YCBYLBR</a>
11,63€</p></li>
</ul>
</section>
</section>
<section id="mcu-espressif-esp32-c3">
<h3>MCU - Espressif ESP32 C3<a class="headerlink" href="#mcu-espressif-esp32-c3" title="Link to this heading"></a></h3>
<a class="reference internal image-reference" href="../../_images/c3_mini_v2.1.0_1_16x16.jpg"><img alt="../../_images/c3_mini_v2.1.0_1_16x16.jpg" src="../../_images/c3_mini_v2.1.0_1_16x16.jpg" style="width: 50%;" />
</a>
<ul class="simple">
<li><p>based ESP32-C3 WIFI &amp; Bluetooth LE RISC-V Single-Core CPU</p></li>
<li><p>Type-C USB</p></li>
<li><p>4MB Flash</p></li>
<li><p>1x WS2812B RGB LED</p></li>
<li><p>Digital I/O Pins 12</p></li>
<li><p>ADC, I2C, SPI, UART</p></li>
<li><p>Compatible with LOLIN D1 mini shields</p></li>
<li><p>Compatible with MicroPython, Arduino, CircuitPython and ESP-IDF</p></li>
<li><p>Operating Voltage 3.3V</p></li>
<li><p>Clock Speed 160MHz</p></li>
<li><p>Flash 4M Bytes</p></li>
<li><p>Size 34.3*25.4mm</p></li>
<li><p>Weight 2.6g</p></li>
</ul>
<p>La scheda di sviluppo, basata su esp32, è stata lanciata da Wemos,
come alternativa alle schede Arduino. Nella versione mini misura
35x26mm.</p>
<a class="reference internal image-reference" href="../../_images/c3_mini_v2.webp"><img alt="../../_images/c3_mini_v2.webp" src="../../_images/c3_mini_v2.webp" style="width: 50%;" />
</a>
<p>Come con arduino, il modulo è espandibile con apposite schede di
espansione dette shield.</p>
<blockquote>
<div><ul class="simple">
<li><p>Schema elettrico <a class="reference download internal" download="" href="../../_downloads/0ddc3ba1fb6fe485f736d4fb529af899/sch_c3_mini_v2.1.0.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a></p></li>
</ul>
</div></blockquote>
</section>
<section id="rtc-and-microsd-data-logger-shield">
<h3>RTC and Microsd Data Logger Shield<a class="headerlink" href="#rtc-and-microsd-data-logger-shield" title="Link to this heading"></a></h3>
<p>Data logger shield per la memorizzazione dei dati tramite scheda
MicroSD e orologio in tempo reale integrato DS1307 con quarzo e
batteria in tampone.</p>
<a class="reference internal image-reference" href="../../_images/rtc-sd-shield.png"><img alt="../../_images/rtc-sd-shield.png" src="../../_images/rtc-sd-shield.png" style="width: 50%;" />
</a>
<section id="devono-essere-fatte-delle-modifiche-al-modulo-cosi-come-viene-fornito">
<h4>Devono essere fatte delle modifiche al modulo così come viene fornito<a class="headerlink" href="#devono-essere-fatte-delle-modifiche-al-modulo-cosi-come-viene-fornito" title="Link to this heading"></a></h4>
<p>Questo lo schema elettrico:</p>
<img alt="../../_images/chematic-Prints.png" src="../../_images/chematic-Prints.png" />
<p>Come discusso in questi articoli esiste di fatto un errore che porta
la batteria a scaricarsi in brevissimo tempo</p>
<ul class="simple">
<li><p><a class="reference external" href="https://forum.arduino.cc/t/trying-to-understand-a-part-of-a-circuit-for-ds1307-rtc/610934/10">https://forum.arduino.cc/t/trying-to-understand-a-part-of-a-circuit-for-ds1307-rtc/610934/10</a></p></li>
<li><p><a class="reference external" href="https://sharedinventions.com/?p=663">https://sharedinventions.com/?p=663</a></p></li>
</ul>
<p>Bisogna quindi rimuovere con il saldatore il diodo e la resistenza R5.</p>
<img alt="../../_images/Screen-Shot-2018-08-26-at-07.31.03a.png" src="../../_images/Screen-Shot-2018-08-26-at-07.31.03a.png" />
<p>che sono posizionate qui sul modulo:</p>
<img alt="../../_images/FPONC2XKMT6CU7Y.webp" src="../../_images/FPONC2XKMT6CU7Y.webp" />
<p>Alla fine il modulo dovrà presentarsi così</p>
<img alt="../../_images/IMG_20180819_110150a.jpg" src="../../_images/IMG_20180819_110150a.jpg" />
</section>
</section>
<section id="oled-0-96-shield">
<h3>OLED 0.96 Shield<a class="headerlink" href="#oled-0-96-shield" title="Link to this heading"></a></h3>
<p>E' un display oled con risoluzione 128x64 pixels (0.96”).</p>
<a class="reference internal image-reference" href="../../_images/oled_0.96_v1.0.0_1_16x16.jpg"><img alt="../../_images/oled_0.96_v1.0.0_1_16x16.jpg" src="../../_images/oled_0.96_v1.0.0_1_16x16.jpg" style="width: 50%;" />
</a>
<a class="reference internal image-reference" href="../../_images/oled_0.96_v1.0.0_2_16x16.jpg"><img alt="../../_images/oled_0.96_v1.0.0_2_16x16.jpg" src="../../_images/oled_0.96_v1.0.0_2_16x16.jpg" style="width: 50%;" />
</a>
<ul class="simple">
<li><p>Schema elettrico <a class="reference download internal" download="" href="../../_downloads/901d78ee54a2973813d24cc64d9ed590/sch_oled_0.96_v1.0.0.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a></p></li>
</ul>
</section>
<section id="tft-i2c-connector-shield">
<h3>TFT I2C Connector Shield<a class="headerlink" href="#tft-i2c-connector-shield" title="Link to this heading"></a></h3>
<p>Per collegare il display e eventuali altri dispositivi è risultato
utile utilizzare questa board di connessione.</p>
<a class="reference internal image-reference" href="../../_images/tft_i2c_con_v1.1.0_1_16x16.jpg"><img alt="../../_images/tft_i2c_con_v1.1.0_1_16x16.jpg" src="../../_images/tft_i2c_con_v1.1.0_1_16x16.jpg" style="width: 50%;" />
</a>
<a class="reference internal image-reference" href="../../_images/tft_i2c_con_v1.1.0_2_16x16.jpg"><img alt="../../_images/tft_i2c_con_v1.1.0_2_16x16.jpg" src="../../_images/tft_i2c_con_v1.1.0_2_16x16.jpg" style="width: 50%;" />
</a>
</section>
<section id="power-shield">
<h3>Power Shield<a class="headerlink" href="#power-shield" title="Link to this heading"></a></h3>
<a class="reference internal image-reference" href="../../_images/power_shield.png"><img alt="../../_images/power_shield.png" src="../../_images/power_shield.png" style="width: 50%;" />
</a>
<p>La scheda D1 mini può essere alimentata tramite connessione
usb (micro).
Per utilizzare la scheda lontano da un computer si può
utilizzare uno shield di alimentazione
Alla scheda di espansione possibile connettere un
alimentatore esterno ( da 7 a 24 V ).</p>
<blockquote>
<div><ul class="simple">
<li><p>Schema elettrico <a class="reference download internal" download="" href="../../_downloads/2d4bafd744043ecad6a129ce58678dea/sch_dc_v1.1.0.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a></p></li>
</ul>
</div></blockquote>
</section>
<section id="base-board">
<h3>Base Board<a class="headerlink" href="#base-board" title="Link to this heading"></a></h3>
<p>Esporta le connessioni al bus I2C.</p>
<p>Può essere popolata con diversi tipi di connettori (passo 2.54mm)</p>
<a class="reference internal image-reference" href="../../_images/base1.jpg"><img alt="../../_images/base1.jpg" src="../../_images/base1.jpg" style="width: 50%;" />
</a>
<p>Dei sensori in dotazione, quello per il particolato è alimentato a 5V,
gli altri componenti a 3.3v.</p>
<p>La base board permette di selezionare il voltaggio adatto al sensore
tramite un cavallotto.  Se il selettore non è popolato, la periferica
collegata, non riceve alimentazione.</p>
<a class="reference internal image-reference" href="../../_images/base2.jpg"><img alt="../../_images/base2.jpg" src="../../_images/base2.jpg" style="width: 50%;" />
</a>
</section>
</section>
<section id="hardware-alternativo-compatibile-sconsigliato-o-obsoleto">
<h2>Hardware alternativo compatibile (sconsigliato o obsoleto)<a class="headerlink" href="#hardware-alternativo-compatibile-sconsigliato-o-obsoleto" title="Link to this heading"></a></h2>
<section id="oled-shield">
<h3>Oled Shield<a class="headerlink" href="#oled-shield" title="Link to this heading"></a></h3>
<p>Questo è un display con un numero di pixel inferiore a queello
standard non più in commercio.  E' supportato per compatibilità con
vecchi hardware.</p>
<a class="reference internal image-reference" href="../../_images/oled_v2.1.0_1_16x16.jpg"><img alt="../../_images/oled_v2.1.0_1_16x16.jpg" src="../../_images/oled_v2.1.0_1_16x16.jpg" style="width: 50%;" />
</a>
<p>Dimensione dello schermo: 64x48 pixel
VCC: 3.3V
Driver IC: SSD1306
Indirizzo I2C: 0x3C or 0x3D
Può essere utilizzato sia impilato sullo stack principale, sia
collegato alla base di espansione (in entrambi i casi via I2C bus)</p>
</section>
<section id="micro-sd-card-shield">
<h3>Micro SD Card Shield<a class="headerlink" href="#micro-sd-card-shield" title="Link to this heading"></a></h3>
<p>Questo modulo può sostituire RTC and Microsd Data Logger Shield ma non
fornisce le funzionalità relative all'RTC in quanto non è presente.
Necessita anche di uno specifico firmware in quanto richiede una
specifica configurazione tempo di compilazione.</p>
<a class="reference internal image-reference" href="../../_images/sd_v1.2.0_1_16x16.jpg"><img alt="../../_images/sd_v1.2.0_1_16x16.jpg" src="../../_images/sd_v1.2.0_1_16x16.jpg" style="width: 50%;" />
</a>
<p>Micro SD(TF) card per D1 mini</p>
</section>
</section>
<section id="assemblaggio-componenti-elettroniche-e-sensori">
<h2>Assemblaggio componenti elettroniche e sensori<a class="headerlink" href="#assemblaggio-componenti-elettroniche-e-sensori" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../../_images/stimawifi_out_of_box_mini.jpg"><img alt="../../_images/stimawifi_out_of_box_mini.jpg" src="../../_images/stimawifi_out_of_box_mini.jpg" style="width: 50%;" />
</a>
<p><a class="reference download internal" download="" href="../../_downloads/673fe3433a0112532be535b6aff81b8c/stimawifi_out_of_box.jpg"><code class="xref download docutils literal notranslate"><span class="pre">immagine</span> <span class="pre">ad</span> <span class="pre">alta</span> <span class="pre">risoluzione</span></code></a>.</p>
<p>Questo lo schema di collegamento elettrico delle varie componenti.
La pila dei moduli Wemos è rappresentata in modo semplificato.</p>
<a class="reference internal image-reference" href="../../_images/global_bb.png"><img alt="../../_images/global_bb.png" src="../../_images/global_bb.png" style="width: 50%;" />
</a>
<a class="reference internal image-reference" href="../../_images/global_schem.png"><img alt="../../_images/global_schem.png" src="../../_images/global_schem.png" style="width: 50%;" />
</a>
</section>
<section id="scatola">
<h2>Scatola<a class="headerlink" href="#scatola" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../../_images/scatola.png"><img alt="../../_images/scatola.png" src="../../_images/scatola.png" style="width: 50%;" />
</a>
<p>Serve a proteggere l’elettronica ed alloggiare parte dei sensori.</p>
<p>Deve essere divisa in due sezioni principali, una ospita i componenti
elettronici, l’altra (divisa a sua volta in due camere separate) il
sensore per le polveri sottili e quello per la rilevazione della
concentrazione di CO2</p>
<a class="reference internal image-reference" href="../../_images/scatola_interno.png"><img alt="../../_images/scatola_interno.png" src="../../_images/scatola_interno.png" style="width: 50%;" />
</a>
<p>Nella parte alta della foto si nota l’alloggiamento
delle componenti elettroniche principali.</p>
<a class="reference internal image-reference" href="../../_images/scatola_elettronica.png"><img alt="../../_images/scatola_elettronica.png" src="../../_images/scatola_elettronica.png" style="width: 50%;" />
</a>
<p>La parte bassa è divisa in due sezioni e queste sezioni sono aperte
verso l’esterno a differenza di quella superiore</p>
<a class="reference internal image-reference" href="../../_images/scatola_inferiore.png"><img alt="../../_images/scatola_inferiore.png" src="../../_images/scatola_inferiore.png" style="width: 50%;" />
</a>
<p>I cavi per i sensori passano attraverso piccole incisioni del
polietilene per mantere il più possibile la camera superiore stagna</p>
<p>La ﬁnestra per il monitor è ricavata incollando un riquadro di
policarbonato con della colla a caldo.</p>
<a class="reference internal image-reference" href="../../_images/scatola_display.png"><img alt="../../_images/scatola_display.png" src="../../_images/scatola_display.png" style="width: 30%;" />
</a>
</section>
<section id="schermo-solare">
<h2>Schermo solare<a class="headerlink" href="#schermo-solare" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../../_images/schermo_solare.png"><img alt="../../_images/schermo_solare.png" src="../../_images/schermo_solare.png" style="width: 20%;" />
</a>
<p>Alloggiamento esterno alla stazione per sensore
umidità e temperatura</p>
<ul class="simple">
<li><p>Protegge il sensore da intemperie</p></li>
<li><p>Protegge il sensore da radiazione solare diretta</p></li>
<li><p>Evita surriscaldamento e migliora precisione</p></li>
<li><p>Può essere autocostruito <a class="reference external" href="https://e.pavlin.si/2019/02/04/low-cost-solar-radiation-shield/">https://e.pavlin.si/2019/02/04/low-cost-solar-radiation-shield/</a></p></li>
<li><p>Modelli molto economici già pronti</p></li>
</ul>
<section id="connessione-device">
<h3>Connessione Device<a class="headerlink" href="#connessione-device" title="Link to this heading"></a></h3>
<p>Connettere i device necessari è semplice</p>
<ul class="simple">
<li><p>assicurarsi che la stazione non sia alimentata</p></li>
<li><p>selezionare appropriato voltaggio alimentazione</p></li>
<li><p>assicurarsi che i collegamenti siano corretti (SCl -&gt; SCl, SDA-&gt;SDA, GND -&gt; GND, Vcc -&gt;Vcc)</p></li>
</ul>
<p>NOTE</p>
<ul class="simple">
<li><p>Alcuni device hanno più dei quattro pin necessari alla connessione
al bus I2C</p></li>
<li><p>VCC, Vcc, Vdd e VDD sono denominazioni equivalenti</p></li>
</ul>
</section>
</section>
<section id="sensori">
<h2>Sensori<a class="headerlink" href="#sensori" title="Link to this heading"></a></h2>
<section id="sensirion-sps30-sensore-per-le-polveri-sottili">
<h3>Sensirion SPS30 (Sensore per le polveri sottili)<a class="headerlink" href="#sensirion-sps30-sensore-per-le-polveri-sottili" title="Link to this heading"></a></h3>
<a class="reference internal image-reference" href="../../_images/sps30.png"><img alt="../../_images/sps30.png" src="../../_images/sps30.png" style="width: 50%;" />
</a>
<ul class="simple">
<li><p>Tecnologia: Scatter Beam OPC (Optical Particulate Counter)</p></li>
<li><p>VCC: 5V</p></li>
<li><p>Indirizzo I2C: 0x69</p></li>
<li><p>Data Sheet: <a class="reference external" href="https://sensirion.com/products/catalog/SPS30/">https://sensirion.com/products/catalog/SPS30/</a></p></li>
</ul>
<p>Note: Connettore a 5 poli.</p>
<p>Il quinto ﬁlo del connettore deve essere collegato a GND per
selezionare la modalità I2C (se lasciato non collegato il
sensore comunica con la modalità UART</p>
<a class="reference internal image-reference" href="../../_images/sps30_pinout.png"><img alt="../../_images/sps30_pinout.png" src="../../_images/sps30_pinout.png" style="width: 50%;" />
</a>
</section>
<section id="sensirion-scd30-sensore-co-2">
<h3>Sensirion SCD30 (Sensore CO 2 )<a class="headerlink" href="#sensirion-scd30-sensore-co-2" title="Link to this heading"></a></h3>
<img alt="../../_images/scd30.png" src="../../_images/scd30.png" />
<ul class="simple">
<li><p>Tecnologia: NonDispersive InfraRed (NDIR)</p></li>
<li><p>VCC: 3.3V ~ 5.5V</p></li>
<li><p>Indirizzo I2C: 0x61</p></li>
<li><p>Data Sheet: <a class="reference external" href="https://sensirion.com/products/catalog/SCD30/">https://sensirion.com/products/catalog/SCD30/</a></p></li>
</ul>
<a class="reference internal image-reference" href="../../_images/scd30_pinout.png"><img alt="../../_images/scd30_pinout.png" src="../../_images/scd30_pinout.png" style="width: 30%;" />
</a>
</section>
<section id="sensirion-sht85-sensore-umidita-temperatura">
<h3>Sensirion SHT85 (Sensore Umidità &amp; Temperatura)<a class="headerlink" href="#sensirion-sht85-sensore-umidita-temperatura" title="Link to this heading"></a></h3>
<a class="reference internal image-reference" href="../../_images/sht85.png"><img alt="../../_images/sht85.png" src="../../_images/sht85.png" style="width: 50%;" />
</a>
<ul class="simple">
<li><p>Tecnologia: Scatter Beam OPC (Optical Particulate Counter)</p></li>
<li><p>VCC: 2.5V ~ 3.3V ~ 5V (Typical 3.3V)</p></li>
<li><p>Indirizzo I2C: 0x44</p></li>
<li><p>Data Sheet: <a class="reference external" href="https://sensirion.com/products/catalog/SHT85/">https://sensirion.com/products/catalog/SHT85/</a></p></li>
</ul>
<a class="reference internal image-reference" href="../../_images/sht85_pinout.png"><img alt="../../_images/sht85_pinout.png" src="../../_images/sht85_pinout.png" style="width: 50%;" />
</a>
</section>
</section>
<section id="software">
<h2>Software<a class="headerlink" href="#software" title="Link to this heading"></a></h2>
<p>FreeRtos viene utilizzato attraverso un wrapper C++.  Ogni thread ha
una struttura dati utilizzata per comunicare trutture dati e dati.
Nessun dato possibilmente è definito globalmente.</p>
<p>Il colore del led indica lo stato di funzionamento:</p>
<ul class="simple">
<li><p>spento: sconosciuto</p></li>
<li><p>blu: in elaborazione</p></li>
<li><p>verde : tutto funziona</p></li>
<li><p>Rosso: almeno un errore è presente</p></li>
</ul>
<p>Il display è opzionale e visualizza comunicazioni, ogni 3 secondi lo
stato aggiornato riassuntivo di funzionamento e un riassunto delle
ultime misurazioni effettuate. Sono supportati due differenti display
con dimensioni differenti riconosciuti automaticamente.</p>
<p>L'SD card è opzionale; se presente è utilizzata per memorizzare i dati
in sqlite3; la struttura del DB è qui rappresentata</p>
<img alt="../../_images/db_structure.png" src="../../_images/db_structure.png" />
<p>Dopo essere passati dal DB sqlite i file vengono trasferiti in un
archivio, integrato in modalità append.</p>
<p>Per poter utilizzare la stazione in modalità &quot;mobile&quot; ossia con
posizione continuamente aggiornata ci sono due possibilità:</p>
<ul class="simple">
<li><p>connettere un modulo GPS con Ublox neo6m</p></li>
<li><p>utilizzare l'app android GPSD_forwarder</p></li>
</ul>
<p>La configurazione è gestita sul server e i thread sono attivati
automaticamente. Quando la geolocalizzazione è possibile i dati
vengono generati, in caso contrario no.</p>
<p>E' attivo un web server accessibile quando ci si connette allo stesso Wifi
a cui è connessa la stazione, Sono forniti le seguenti URL/servizi:</p>
<ul class="simple">
<li><p><a class="reference external" href="http:/">http:/</a>/&lt;station slug&gt;             Full main page</p></li>
<li><p><a class="reference external" href="http:/">http:/</a>/&lt;station slug&gt;/data.json   Data in json format</p></li>
<li><p><a class="reference external" href="http:/">http:/</a>/&lt;station slug&gt;/geo         Coordinate of the station</p></li>
<li><p><a class="reference external" href="http:/">http:/</a>/&lt;station slug&gt;/archive.dat Dati dell'archivio da leggere con apposito tools</p></li>
<li><p><a class="reference external" href="http:/">http:/</a>/&lt;station slug&gt;/info.dat    Info file dell'archivio da leggere con apposito tools</p></li>
</ul>
<p>I dati sono visualizzabile da browser sempre se connessi allo stesso WiFi
autenticandosi sul server RMAP e accedendo alla propria pagina personale,
selezionando la stazione e poi alla voce &quot;Mostra i dettagli stazione&quot; e poi
&quot;Dati locali in tempo reale&quot;.</p>
<p>Il reset delle configurazioni è effettuabile a stazione disalimentata
collegando a massa il pin RESET_PIN  o premendo il pulsante A della
board del display, alimentare la stazione e dopo 10 secondi scollegare il
RESET_PIN o rilasciare il pulsante. Il reset della configurazione effettua:</p>
<ul class="simple">
<li><p>rimozione delle configurazioni del wifi</p></li>
<li><p>rimozione delle configurazioni stazione (utente slug password)</p></li>
<li><p>completa formattazione dell'SD card con rimozione definitiva di
tutti i dati presenti</p></li>
</ul>
<p>Il frusso dei dati nelle code è il seguente:</p>
<p>i dati e metadati sono generati da threadMeasure e accodati nella coda
mqttqueue per la pubblicazione, ricevuti da threadPublish per la
pubblicazione sul broker MQTT; se non c'è spazio
vanno direttamente nella coda dbqueue per l'archiviazione su SD card.
threadMeasure è attivato periodicamente.</p>
<p>threadPublish prova la pubblicazione MQTT.</p>
<p>Dopo ogni tentativo di pubblicazione al broker MQTT
i dati vengono accodati per l'archiviazione nella coda dbqueue
etichettati relativamente al risultato della pubblicazione.</p>
<p>Il thread threadDb gestisce due tipi di archiviazione dati.</p>
<p>Il primo (DB) che contiene gli ultimi dati misurati (solitamente 24 ore)
con sovrascrittura nel database e una etichetta a indicare lo stato di
pubblicazione; fino a quando i dati sono presenti in questo
DB i dati possono essere recuperati per la pubblicazione fino al successo della
pubblicazione.</p>
<p>Quando i dati nel DB invecchiano oltre il limite vengono trasferiti nell'archivio
dove potranno essere riletti solo tramite un PC.</p>
<p>Ogni thread ha una struttura dati che descrive
lo stato di funzionamento. Il thread loop di arduino effettua una
sintesi degli stati di tutti i thread e li visualizza tramite i
colori del LED e tramite il display opzionale.</p>
<p>Per pubblicare e archiviare i dati è necessario avere un corretto timestamp.
Data e ora possono essere impostati tramite:</p>
<ul class="simple">
<li><p>NTP</p></li>
<li><p>GPS</p></li>
<li><p>UDP</p></li>
</ul>
<p>Se presente un RTC locale (DS1307) data e ora sono impostate sull'RTC
automaticamente con uno dei metodi precedenti e poi se tutti i metodi
precedenti non sono più disponibili riletti dall'RTC.</p>
<p>Senza un corretto timestamp i dati non possono essere gestiti e
vengono subito ignorati.</p>
<p>Threads:</p>
<section id="thread-loop-arduino">
<h3>thread loop arduino<a class="headerlink" href="#thread-loop-arduino" title="Link to this heading"></a></h3>
<p>Questo thread esegue tutte le operazioni iniziali di configurazione e
attivazione degli altri thread. Prima si configura la connessione WiFi
insieme ad alcuni parametri univoci della stazione. Tramite questi
ultimi la configurazione stazione viene scaricata dal server. Il
thread governa la visualizzazione sul display e la colorazione del
LED. Inoltre è possibile visualizzare i dati misurati tramite un
browser indirizzandolo sulla pagina personale sul server RMAP.
La libreria TimeAlarm gestisce l'attivazione dei segnali ai
thread per attivazioni perioche.</p>
</section>
<section id="threadmeasure">
<h3>threadMeasure<a class="headerlink" href="#threadmeasure" title="Link to this heading"></a></h3>
<p>Questo thread si occupa di interrogare i sensori, associare i metadati
e accodarli per la pubblicazione e archiviazione. I sensori vengono
interrogati in parallelo tramite delle macchine a stati finiti.
Inoltre viene prodotta una struttura di dati di riassunto delle misure
effettuate. Insieme alla libreria di driver per sensori viene gestita
la loro inizializzazione e il restart in caso di ripetuti errori.</p>
</section>
<section id="threadpublish">
<h3>threadPublish<a class="headerlink" href="#threadpublish" title="Link to this heading"></a></h3>
<p>Pubblica i dati in MQTT secondo lo standard RMAP.  Se la
configurazione è per una stazione mobile della struttura con la
geolocalizzazione viene controllato il timestamp e se ancora attuale
associate le coordinate ai dati.  Periodicamente viene pubblicato
anche lo stato della diagnostica fatta dalla stazione; il server
provvederà a visualizzarne lo stato e a inviare delle email di
segnalazione al proprietario della stazione e a un apposito gruppo di
utenti di amministrazione.  Il thread una volta provata la
pubblicazione dei record sul broker MQTT provvederà se necessario</p>
</section>
<section id="threaddb">
<h3>threadDb<a class="headerlink" href="#threaddb" title="Link to this heading"></a></h3>
<p>Archivia i dati su SD card. Il formato del DB è quello portabile di sqlite3 e
possono essere letti tramite la stessa libreria da PC. Più scritture
con gli stessi metadati aggiornano i dati, non creano record
duplicati. L'archivio invece è composto da due file, uno di descrizione
e il secondo con i dati.</p>
<p>Il thread threadDb viene attivato periodicamente
per recuperare l'invio dei dati presenti nel DB e non ancora pubblicati
inviando un piccolo blocco di dati a mqttqueue fino a quando avanzi
sufficiente spazio nella coda di pubblicazione per altri thread.</p>
<p>Il thread threadDb esegue a priorità più alta degli altri per garantire
l'archiviazione senza perdita di dati in tempi utili e non riempire le code.</p>
<p>I dati vengo continuamente traferiti dal DB all'archivio eliminando dal
database i dati più vecchi trasferendoli in un semplice archivio su file
sempre sull'SD card. I dati in archivio possono essere letti e traferiti
sul server RMAP tramite mqtt2bufr, un tool della suite RMAP.</p>
<p>Se all'avvio i dati presenti nel DB risultano essere
tutti vecchi i dati vengono traferiti all'archivio e l'intero DB viene eliminato
e ricreato vuoto per limiti di memoria e performance.</p>
</section>
<section id="threadudp">
<h3>threadUdp<a class="headerlink" href="#threadudp" title="Link to this heading"></a></h3>
<p>Legge i dati UDP inviati dalla app GPSD forwarder di uno smartphone
riempiendo una struttura dati con la geolocalizzazione e un timestamp.</p>
</section>
<section id="threadgps">
<h3>threadGps<a class="headerlink" href="#threadgps" title="Link to this heading"></a></h3>
<p>Legge i dati dal GPS se presente (porta seriale) riempiendo una struttura dati con
la geolocalizzazione e un timestamp.</p>
</section>
<section id="remote-procedure-call">
<h3>Remote Procedure Call<a class="headerlink" href="#remote-procedure-call" title="Link to this heading"></a></h3>
<p>La stazione funge da Remote Procedure Call (RPC) server: è quindi in
grado di eseguire operazioni su ordine di un client che in questo caso
può essere il server RMAP istruito tramite interfaccia WEB o il tool
rmap-configure installato su proprio PC ad esempio con le opzioni:</p>
<ul>
<li><dl class="option-list">
<dt><kbd><span class="option">--rpc_mqtt_reboot</span></kbd></dt>
<dd><p>execute reboot RPC over MQTT</p>
</dd>
</dl>
</li>
<li><p>--rpc_mqtt_pinout execute pinout RPC over MQTT</p></li>
<li><p>--rpc_mqtt_pinout_P1 set status of Pin 1</p></li>
<li><p>--rpc_mqtt_pinout_P2 set status of Pin 2</p></li>
<li><p>--rpc_mqtt_recovery execute recovery data RPC over MQTT</p></li>
<li><p>--datetimestart recovery data starting from this date and time in iso format (2011-11-04T12:05:23)</p></li>
<li><p>--datetimeend recovery data ending to this date and time in iso format (2011-11-05T18:06:23)</p></li>
</ul>
<p>Fare riferimento alla apposita documentazione per le possibili RPC e i
relativi parametri.</p>
<p>La stazione si iscrive con connessione persistente (clean session
false) a un topic MQTT da cui riceve i messaggi del client e pubblica
il risultato della RPC su un altro specifico topic. Al riavvio della
stazione gli eventuali messaggi accodati dal server per la stazione
vengono eliminati in quanto la coda di messaggi potrebbe essere
obsoleta.  Vengono invece gestiti i messaggi accodati dal server per
la stazione se questa è rimasta per un periodo disconnessa (ma
accesa).  I messaggi RPC vengono gestiti dal threadPublish. In alcuni
casi le operazioni richieste dalla RPC sono eseguibili dallo stesso
thread ma ad esempio l'RPC &quot;recovery&quot; deve essere eseguite da un
thread differente (threadDb). In questo ultimo caso le informazioni
per eseguire l'RPC vengono inviate tramite una apposita coda
&quot;recoveryqueue&quot;; è una coda binaria, ossia in grado mi gestire un solo
messaggio che sarà sempre l'ultimo. L'RPC recovery sarà quindi
eseguita dal threadDb; Il recupero dei dati selezionati per limite di
data e su richiesta tra quelli non ancora inviati viene gestito in
modo differente a seconda che risiedano sul DB di lavoro o nel file di
archivio.  Sul DB di lavoro i dati richiesti vengono reimpostati con
la flag &quot;sent&quot; a false, mentre dall'archivio vengono semplicemente
letti e filtrati i record senza poi comunque modificare lo stato della
flag &quot;sent&quot; presente in archivio.
Essendo la rilettura dell'archivio una operazione in alcuni casi
particolarmente lunga e non volendo creare un apposito thread è stata
creata una piccola macchina a stati finiti che continua ad accodare
quando possibile i record per la pubblicazione senza bloccare
l'esecuzione del thread per l'esecuzione delle operazioni ordinarie.
Il threadPublish analizzerà il messaggio di cui è stato chiesto l'invio:</p>
<ul class="simple">
<li><p>se non era già stato pubblicato viene reinviato al threadDb</p></li>
<li><p>se era già stato pubblicato non viene reinviato al threadDb</p></li>
</ul>
<p>I dati per la ritrasmissione (vedi RPC recovery) quindi presenti in
archivio vengono sempre inviati al thread per la pubblicazione con la
flag di &quot;inviato&quot; attiva per evitare duplicati in archivio</p>
</section>
</section>
<section id="messa-in-opera-della-stazione">
<h2>Messa in opera della stazione<a class="headerlink" href="#messa-in-opera-della-stazione" title="Link to this heading"></a></h2>
<p>La messa in opera della stazione può essere affrontata in più fasi:
dopo aver assemblato la scheda elettronica ed averla posizionata nel
proprio guscio bisognerà configurare la stazione, registrarla presso
il sito che raccoglierà i dati e installare la stazione nel sito
prescelto.</p>
<p>In queste pagine tratteremo sommariamente queste operazioni
preoccupandoci di dare delle indicazioni di massima su cosa fare, sui
materiali e strumenti necessari alla corretta esecuzione delle
procedure necessarie alla messa in opera.</p>
</section>
<section id="assemblaggio-scheda-elettronica">
<h2>Assemblaggio scheda elettronica<a class="headerlink" href="#assemblaggio-scheda-elettronica" title="Link to this heading"></a></h2>
<p>La prima fase della messa in opera presuppone l’assemblaggio del
data logger, la parte della stazione che si occupa di consultare
periodicamente i sensori installati e di inviare i campionamenti al
server centrale.</p>
<p>A seconda del kit utilizzato, potrebbe essere necessario utilizzare un
saldatore a stagno per installare i connettori a pettine necessari a
collegare tra loro i vari componenti ed assemblare i cavi di
connessione (il progetto prevede che connettori e cavi siano
preassemblati ma nulla vieta, per chi avesse tra gli obiettivi di
migliorare la confidenza con la saldatura di componenti elettronici di
utilizzare il kit senza il servizio di saldatura).</p>
<p>I diversi moduli dovranno essere collegati tra di loro rispettando la
polarità.  Prima di procedere alla connessione dei sensori, bisognerà
controllare che il sistema funzioni attivandolo tramite l’alimentatore
in dotazione oppure collegandolo via usb ad un computer.</p>
<p>L’apparizione sul piccolo schermo oled in dotazione della scritta
Starting Up! seguito dal numero di versione del firmware e, nella
schermata successiva dell’ESSID di configurazione della scheda,
STIMA-Config, e della password indicano che l’assemblaggio è stato
completato con successo.</p>
<p>Una volta completata con successo il primo avvio, visto che la scheda
può essere alimentata in due modi diversi, tramite connettore micro
usb e tramite alimentatore 12v, bisogna togliere l’alimentazione e
provare il metodo ad alimentare la stazione verificando anche la
modalità di alimentazione che non si è ancora utilizzata.</p>
<section id="strumentazione-necessaria">
<h3>Strumentazione necessaria<a class="headerlink" href="#strumentazione-necessaria" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>cavo micro usb</p></li>
<li><p>computer/Alimentatore per smartphone</p></li>
<li><p>saldatore a stagno*</p></li>
</ul>
</section>
<section id="dotazione-software">
<h3>Dotazione Software<a class="headerlink" href="#dotazione-software" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Nessuna</p></li>
</ul>
</section>
</section>
<section id="caricamento-firmware">
<h2>Caricamento firmware<a class="headerlink" href="#caricamento-firmware" title="Link to this heading"></a></h2>
<p>Questa fase della messa in opera è facoltativa. La stazione arriva già
con un firmware installato pronta per la configurazione iniziale ma,
in caso si voglia modificare l’utilizzo della stazione,
personalizzarne le funzionalità o cogliere l’occasione di
impratichirsi con questa operazione fondamentale nel ciclo di vita del
software per microcontrollori,</p>
<p>La stazione Stima WiFi è basata sul microcontrollore Esp32 prodotto
da ExpressIf. Si tratta di una soluzione economica e affidabile che da
qualche anno sta aumentando esponenzialmente la propria popolarità.
Il produttore mette a disposizione strumenti gratuiti e liberi per lo
sviluppo, e sono diffuse librerie ed ambienti di progettazione per i
maggiori linguaggi di programmazione.</p>
<p>Fatta salva la facoltà di usare la soluzione software con cui si ha
più confidenza, abbiamo selezionato, per la ridotta invasività, la
licenza di distribuzione e la disponibilità su tutti i maggiori
sistemi operativi, dell’ambiente di sviluppo integrato Platformio
disponibile all’Url <a class="reference external" href="https://www.platformio.org">https://www.platformio.org</a> che è a sua volta
basato su ambiente di sviluppo Python.</p>
<p>Questa scelta, val la pena notarlo, non influisce in alcun modo sulle
dotazioni software adottabili successivamente per lo sviluppo di
programmi che interagiscano con la stazione di monitoraggio dopo la
sua installazione.</p>
<p>NOTA: Non tutti i cavi usb sono uguali, in special modo quelli forniti
con gli smartphone. Alcuni sono adatti solo all’alimentazione ed alla
ricarica dei dispositivi e non permettono lo scambio di dati. Se il
computer non sembra riconoscere la stazione provare a sostituire il
cavo di connessione. Se anche questa prova non sortisce effetti, ma la
stazione si accende regolarmente, è probabile che il computer in uso
non riconosca l’interfaccia seriale usb usata dalla stazione. In
questo caso bisognerà caricare l’apposito driver prima di poter
procedere.</p>
<section id="id1">
<h3>Strumentazione necessaria<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>cavo usb C</p></li>
<li><p>computer</p></li>
</ul>
</section>
<section id="id2">
<h3>Dotazione Software<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Ambiente di sviluppo Python versione &gt;= 3.11</p></li>
<li><p>Platformio (Piattaforma per lo sviluppo embedded)</p></li>
</ul>
</section>
</section>
<section id="collegamento-dei-sensori">
<h2>Collegamento dei sensori<a class="headerlink" href="#collegamento-dei-sensori" title="Link to this heading"></a></h2>
<video controls="True" preload="auto" width="100%"><source src="../../_images/stimawifi_v3_board_e_pila.mp4" type="video/mp4"></video><p>Prima di procedere con questa fase, disalimentare la stazione di
monitoraggio.</p>
<p>Una volta assemblata e configurata la scheda madre della stazione, è
necessario collegare i sensori alla scheda e verificarne il
funzionamento.</p>
<p>Per farlo bisogna assemblare i cavi di collegamento secondo gli schemi
forniti dal produttore dei sensori facendo in modo che corrispondono
alla piedinatura dei connettori presenti sulla stazione Stima WiFi.</p>
<img alt="../../_images/board.jpg" src="../../_images/board.jpg" />
<p>Dopo aver messo a punto la cavetteria bisogna collegare i sensori
ognuno secondo lo standard facendo attenzione alla polarità ed al
voltaggio (il sensore di polveri sottili ha bisogno di essere
alimentato a 5v mentre gli altri sensori a 3,3v)</p>
<p>La prima installazione ed il collaudo dei sensori è una fase critica,
errori possono rendere un sensore, la scheda o entrambi
inutilizzabili. Prima di alimentare ancora una volta la stazione, è
buona norma controllare la connessione con un multimetro che disponga
della modalità test di continuità.  Dopo le opportune verifiche
bisogna collegare l’alimentazione esterna, usando l’alimentatore
esterno in dotazione, e verificare che la stazione si avvii
regolarmente.</p>
<p>Dovrebbe comparire sullo schermo un messaggio che invita a collegarsi
alla rete wireless attivata per le operazioni di configurazione
iniziale. Prima di procedere, però, è necessario censire la stazione
presso il server centrale.</p>
<p>NOTA: Anche se operano in condizioni ideali, i sensori di rilevamento
hanno, al netto di malfunzionamenti, una vita attesa non
illimitata. Si stima che passino circa due anni prima che i sensori,
in special modo quello per il particolato, comincino a perdere di
precisione.</p>
<section id="id3">
<h3>Strumentazione necessaria<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Multimetro</p></li>
<li><p>Computer, tablet o smartphone con connettività Wi-Fi</p></li>
</ul>
</section>
<section id="id4">
<h3>Dotazione Software<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Un qualunque browser web</p></li>
<li><p>Accesso alla rete Wi-Fi</p></li>
</ul>
</section>
</section>
<section id="censimento-stazione">
<h2>Censimento stazione<a class="headerlink" href="#censimento-stazione" title="Link to this heading"></a></h2>
<p>Prima di poter operare, a meno che non sia stata dotata di un firmware
specifico, la stazione deve essere censita presso un server di
raccolta dati.</p>
<p>Esistono due punti di raccolta dati, test.rmap.cc ed rmap.cc. Il primo
viene utilizzato per le procedure di collaudo, per controllare il
funzionamento di prototipi di nuove stazioni e per mettere a punto
l’adozione di nuovi sensori; il secondo viene usato per la raccolta e
l’elaborazione dei dati sul campo.</p>
<p>Durante la fase di collaudo bisognerà registrare la stazione presso il
sito di test, una volta completata l’installazione bisognerà ripetere
la registrazione sul sito principare e censire nuovamente la
stazione. Non è prevista, al momento, una procedura automatizzata per
gestire la migrazione, da effettuarsi una tantum.</p>
<p>Prima di procedere al censimento vero e proprio, il gestore della
stazione deve registrare un nuovo utente, nel caso disponga già di un
profilo.</p>
<p>Una volta effettuato l’accesso al sito con nome utente e password,
sarà possibile censire una o più stazioni.</p>
<p>Censire una stazione consiste nel dichiararne le caratteristiche:</p>
<ul class="simple">
<li><p>Coordinate</p></li>
<li><p>Identificativo di stazione</p></li>
<li><p>Altezza dal livello del suolo</p></li>
<li><p>Classificazione del sito dal punto di vista qualità dell’aria</p></li>
<li><p>Alcune fotografie (5): una della stazione e 4 con le spalle alla
stazione verso i 4 punti cardinali</p></li>
</ul>
<p>L’identificativo di stazione non è altro che il nome che dovrà essere
usato in fase di configurazione iniziale.</p>
<section id="id5">
<h3>Strumentazione necessaria<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Computer, tablet o smartphone</p></li>
</ul>
</section>
<section id="id6">
<h3>Dotazione Software<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Un qualunque browser web</p></li>
</ul>
</section>
</section>
<section id="collaudo-stazione">
<h2>Collaudo Stazione<a class="headerlink" href="#collaudo-stazione" title="Link to this heading"></a></h2>
<p>Dopo aver censito la stazione è possibile configurarla. A sensori
collegati, si può accendere la stazione di monitoraggio.</p>
<p>Dovrebbe comparire sullo schermo un messaggio che invita a collegarsi
alla rete wireless attivata per le operazioni di configurazione
iniziale:</p>
<p>ssid: STIMA-config password: bellastima</p>
<p>L’access point è dotato di Capture Portal ma, se l’automatismo non
dovesse funzionare, è sempre possibile visitare con un browser l’url
<a class="reference external" href="http://192.168.4.1">http://192.168.4.1</a> per iniziare la procedura di configurazione.</p>
<p>Una volta raggiunta la pagina di configurazione, bisognerà inserire i
dati necessari alla connessione al sito rmap, l’url dell’istanza
prescelta e le credenziali per l’accesso alla rete Wi-Fi attraverso la
quale la stazione avrà accesso ad internet.</p>
<p>Se tutto andrà per il meglio e la stazione configurata correttamente,
sullo schermo cominceranno a scorrere le misure dei diversi sensori;
misure che saranno visibili, dopo un lasso di tempo, anche sul sito
preposto alla raccolta dei campionamenti.</p>
<p>NOTA: Non è previsto l’uso di proxy con autenticazione per accedere ad
internet. In caso l’istituto preveda questa modalità di navigazione
sarà necessario derogare in base al mac address della stazione o
creando una sottorete Wi-Fi dedicata.</p>
<section id="reset-della-configurazione">
<h3>Reset della configurazione<a class="headerlink" href="#reset-della-configurazione" title="Link to this heading"></a></h3>
<p>Quando necessario, ad esempio per un cambio di configurazione
dell'access point wifi, è possibile procedere al reset delle
configurazioni effettuando un reset con l'apposito ponticello mentre il ponticello di riconfigurazione è cortocirduitato.
Questo video mostra una modalità per procedere alla riconfigurazione.</p>
<video controls="True" preload="auto" width="100%"><source src="../../_images/stimawifi_v3_reset.mp4" type="video/mp4"></video></section>
<section id="id7">
<h3>Strumentazione necessaria<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Computer, tablet o smartphone con connettività Wi-Fi</p></li>
</ul>
</section>
<section id="id8">
<h3>Dotazione Software<a class="headerlink" href="#id8" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Un qualunque browser web</p></li>
<li><p>Accesso alla rete Wi-Fi</p></li>
</ul>
</section>
</section>
<section id="preparazione-del-guscio">
<h2>Preparazione del guscio<a class="headerlink" href="#preparazione-del-guscio" title="Link to this heading"></a></h2>
<p>Una volta completata l'assemblaggio, la configurazione ed il collaudo
della parte elettronica della stazione, bisognerà procedere ad
installarla, insieme ad alcuni sensori, all’interno del suo guscio
protettivo. Il sensore di temperatura, per non essere influenzato
nelle sue misurazioni dal funzionamento della stazione, viene
installato in un involucro separato denominato schermo solare passivo.</p>
<p>Con delle forbici o un taglierino, bisognerà tagliare da un foglio di
schiuma per imballaggi, che può essere riciclato, dei riquadri che
permettano separare l’interno della scatola di derivazione usata come
guscio della stazione, in tre compartimenti, uno per l’elettronica,
uno per l’ingresso dell’aria da analizzare e un altro alloggiamento
che permetterà a sensore di polveri sottili, che andrà installato a
cavallo delle due sezioni, di emettere l’aria analizzata senza
influenzare il flusso in ingresso.</p>
<p>Il foglio di schiuma andrà fissato alla scatola di derivazione con
nastro biadesivo o colla a caldo, a seconda se la parete debba essere
rimovibile, insieme ai sensori. Utilizzeremo un cacciavite per
praticare dei piccoli tagli nel foglio di schiuma per far passare i
cavi di collegamento dei sensori.  Per poter controllare lo schermo
della stazione dall’esterno, andrà rimosso un passacavi
laterale. L’apertura andrà chiusa con un piccolo, 4x4cm, riquadro in
plexiglas fissato con la colla a caldo all’interno della scatola di
derivazione.</p>
<p>Altri due passacavi laterali dovranno essere intagliati per permettere
l’ingresso di cavo di alimentazione e cavo dati del sensore di
temperatura.</p>
<p>Infine andranno rimossi i passacavi posti sul lato inferiore per permettere il ricircolo d’aria.</p>
<section id="id9">
<h3>Strumentazione necessaria<a class="headerlink" href="#id9" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Forbici o taglierino</p></li>
<li><p>Colla a caldo</p></li>
<li><p>Nastro biadesivo</p></li>
<li><p>Un foglio di Foam a celle chiuse (schiuma per imballaggi)</p></li>
<li><p>Multimetro</p></li>
<li><p>Cacciavite</p></li>
<li><p>Plexiglas</p></li>
</ul>
</section>
<section id="id10">
<h3>Dotazione Software<a class="headerlink" href="#id10" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Nessuna</p></li>
</ul>
</section>
</section>
<section id="installazione-in-loco">
<h2>Installazione in loco<a class="headerlink" href="#installazione-in-loco" title="Link to this heading"></a></h2>
<p>L’installazione della stazione prevede opere in muratura ed elettriche
che andrebbero eseguite da personale competente.</p>
<p>È possibile usare una staffa per parabola satellitare per ottenere un
economico sostegno che allontani la stazione dalla muratura
dell’edificio che la sosterrà dello spazio necessario ad una corretta
analisi del particolato. Alla staffa andranno fissati sia lo schermo
solare, più in basso, la stazione vera e propria. La stazione vinen
alimentata a non più di 12v e quindi i rischi di incidenti elettrici
sono inesistenti, a patto che l’allaccio alla presa elettrica sia
protetto dalle intemperie secondi gli standard vigenti.</p>
</section>
<section id="installazione-schermo-solare-e-sensore-temperatura">
<h2>Installazione schermo solare e sensore temperatura<a class="headerlink" href="#installazione-schermo-solare-e-sensore-temperatura" title="Link to this heading"></a></h2>
<img alt="../../_images/schermo.png" src="../../_images/schermo.png" />
<section id="todo">
<h3>TODO<a class="headerlink" href="#todo" title="Link to this heading"></a></h3>
</section>
</section>
<section id="configurazione-firmware-software-python-json-nodered">
<h2>Configurazione // Firmware + Software // Python + Json // NodeRed<a class="headerlink" href="#configurazione-firmware-software-python-json-nodered" title="Link to this heading"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p>Versione pdf <a class="reference download internal" download="" href="../../_downloads/b05a610f8260bc20b6f53fa8bd322285/stimawifi_programming.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a></p></li>
<li><p>Versione open documet <a class="reference download internal" download="" href="../../_downloads/4497a94b2aa4f687713d1d7bab6d1fef/stimawifi_programming.odp"><code class="xref download docutils literal notranslate"><span class="pre">odp</span></code></a></p></li>
</ul>
</div></blockquote>
</section>
<section id="appendice-a-checklist-installazione">
<h2>Appendice A Checklist installazione<a class="headerlink" href="#appendice-a-checklist-installazione" title="Link to this heading"></a></h2>
<p>Checklist installazione Stima WiFi Per mettere in opera una stazione
Stima WiFi bisogna tenere da conto tre fattori che permettono di farla
operare al meglio:</p>
<ul class="simple">
<li><p>L’accesso all’alimentazione di rete</p></li>
<li><p>L’accesso ad un access point wifi</p></li>
<li><p>Una corretta installazione per permettere ai diversi sensori di operare al meglio</p></li>
</ul>
<p>Essendo un apparato che opera all’esterno, bisogna assicurarsi che la
corrente elettrica raggiunga il sito di installazione seguendo tutto
gli standard del caso e che la connessione possa sopportare le
intemperie. Questa attività esula dal mero assemblaggio della stazione
ed andrebbe demandata ad un tecnico specializzato.</p>
<p>La stazione dovrà essere alimentata continuamente, il consumo
elettrico è trascurabile, qualche decina di mA, ma non è possibile
togliere alimentazione alla stazione, ad esempio nei weekend o in
tarda serata, pena l’impossibilità di registrare e conferire i dati
raccolti.</p>
</section>
<section id="appendice-b-accesso-wifi">
<h2>Appendice B Accesso WiFi<a class="headerlink" href="#appendice-b-accesso-wifi" title="Link to this heading"></a></h2>
<p>Le stazioni Stima WiFi, utilizzano una rete WiFi a 2.4Ghz* per collegarsi
ad internet e non possono utilizzare un proxy.  Prima di procedere con
l’installazione è bene confrontarsi con il personale dell’ufficio
tecnico per assicurarsi che la rete che si vuole utilizzare per la
connessione sia adatta</p>
<p>Annotare l’SSID della rete wifi a cui dovrà connettersi la stazione
Stabilire se l’accesso alla rete wifi è protetto da password.</p>
<p>Assicurarsi che la stazione possa accedere ad internet senza passare
per un proxy Solitamente, si può derogare al filtro dei dati,
indicando all’ufficio tecnico della scuola l’indirizzo MAC della
stazione La connessione WiFi deve essere assicurata 7/24</p>
<p>Una volta soddisfatti i prerequisiti, basta assicurarsi che la rete
WiFi copra con un segnale stabile il punto prescelto per
l’installazione.</p>
<p>Il RSSI (Indicatore della potenza del segnale ricevuto), indica
l'intensità del segnale. A seconda dei risultati delle nostre
misurazioni, conosceremo la qualità della nostra connessione:</p>
<ul class="simple">
<li><p>Ottimo segnale (tra -30 dBm e -50 dBm), perfetto per gaming o per
riprodurre video 4K.</p></li>
<li><p>Buon segnale (tra -50 dBm e -70 dBm): sufficiente per la navigazione
e lo streaming video.</p></li>
<li><p>Segnale normale (tra -70 dBm e -80 dBm), che potrebbero causare
interruzioni o rallentamenti della velocità.</p></li>
<li><p>Senale debole (più di -80 dBm): abbiamo un problema.</p></li>
</ul>
<p>[*] Anche se più veloce, la rete a 5Ghz non garantisce, nel nostro
caso, migliorie significative rispetto a quella a 2.4Ghz e, di contro,
è molto più sensibile agli ostacoli che dovessero frapporsi tra
l’access point e la stazione.</p>
</section>
<section id="appendice-c-pin">
<h2>Appendice C PIN<a class="headerlink" href="#appendice-c-pin" title="Link to this heading"></a></h2>
<p><strong>Pin</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Stima use</p></th>
<th class="head"><p>Pin</p></th>
<th class="head"><p>ESP-8286</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"><p>ESP32 C3</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"><p>ESP32 S3</p></th>
<th class="head"></th>
<th class="head"></th>
</tr>
<tr class="row-even"><th class="head"></th>
<th class="head"></th>
<th class="head"><p>Pin</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>Function</p></th>
<th class="head"><p>Pin</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>Function</p></th>
<th class="head"><p>Pin</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>TXD/encA</p></td>
<td><p>dx8</p></td>
<td><p>TXD</p></td>
<td><p>TX</p></td>
<td><p>TXD</p></td>
<td><p>TXD  (21)</p></td>
<td><p>TX</p></td>
<td><p>TXD</p></td>
<td><p>TXD  (43)</p></td>
<td><p>TX</p></td>
<td><p>TXD</p></td>
</tr>
<tr class="row-even"><td><p>RXD/encB</p></td>
<td><p>dx7</p></td>
<td><p>RXD</p></td>
<td><p>RX</p></td>
<td><p>RXD</p></td>
<td><p>RXD  (20)</p></td>
<td><p>RX</p></td>
<td><p>RXD</p></td>
<td><p>RXD  (44)</p></td>
<td><p>RX</p></td>
<td><p>RXD</p></td>
</tr>
<tr class="row-odd"><td><p>encBtn/CLEAR</p></td>
<td><p>sx7</p></td>
<td><p>A0</p></td>
<td><p>A0</p></td>
<td><p>Analog input, max 3.2V</p></td>
<td><p>GPIO3</p></td>
<td><p>D9/A3</p></td>
<td><p>IO</p></td>
<td><p>GPIO2</p></td>
<td><p>D9/A3</p></td>
<td><p>IO</p></td>
</tr>
<tr class="row-even"><td><p>RAIN/Analog input</p></td>
<td><p>sx6</p></td>
<td><p>GPIO16</p></td>
<td><p>D0</p></td>
<td><p>IO</p></td>
<td><p>GPIO2</p></td>
<td><p>D0/A2</p></td>
<td><p>IO, Analog input, max 3.2V</p></td>
<td><p>GPIO4</p></td>
<td><p>D0/A2</p></td>
<td><p>IO, Analog input, max 3.2V</p></td>
</tr>
<tr class="row-odd"><td><p>SCL</p></td>
<td><p>dx6</p></td>
<td><p>GPIO5</p></td>
<td><p>D1</p></td>
<td><p>IO, SCL</p></td>
<td><p>GPIO10</p></td>
<td><p>D1</p></td>
<td><p>IO, SCL</p></td>
<td><p>GPIO36</p></td>
<td><p>D1</p></td>
<td><p>IO, SCL</p></td>
</tr>
<tr class="row-even"><td><p>SDA</p></td>
<td><p>dx5</p></td>
<td><p>GPIO4</p></td>
<td><p>D2</p></td>
<td><p>IO, SDA</p></td>
<td><p>GPIO8</p></td>
<td><p>D2</p></td>
<td><p>IO, SDA</p></td>
<td><p>GPIO35</p></td>
<td><p>D2</p></td>
<td><p>IO, SDA</p></td>
</tr>
<tr class="row-odd"><td><p>RGB LED (V3)</p></td>
<td><p>dx4</p></td>
<td><p>GPIO0</p></td>
<td><p>D3</p></td>
<td><p>IO</p></td>
<td><p>GPIO7</p></td>
<td><p>D3</p></td>
<td><p>RGB_LED</p></td>
<td><p>GPIO18</p></td>
<td><p>D3</p></td>
<td><p>RGB_LED</p></td>
</tr>
<tr class="row-even"><td><p>LED (V2) SS (V3)</p></td>
<td><p>dx3</p></td>
<td><p>GPIO2</p></td>
<td><p>D4</p></td>
<td><p>IO, 10k Pull-up, BUILTIN_LED</p></td>
<td><p>GPIO6</p></td>
<td><p>D4</p></td>
<td><p>IO</p></td>
<td><p>GPIO16</p></td>
<td><p>D4</p></td>
<td><p>IO</p></td>
</tr>
<tr class="row-odd"><td><p>SCK</p></td>
<td><p>sx5</p></td>
<td><p>GPIO14</p></td>
<td><p>D5</p></td>
<td><p>IO, SCK</p></td>
<td><p>GPIO1</p></td>
<td><p>D5/A1</p></td>
<td><p>IO, SCK</p></td>
<td><p>GPIO12</p></td>
<td><p>D5/A1</p></td>
<td><p>IO, SCK</p></td>
</tr>
<tr class="row-even"><td><p>MISO</p></td>
<td><p>sx4</p></td>
<td><p>GPIO12</p></td>
<td><p>D6</p></td>
<td><p>IO, MISO</p></td>
<td><p>GPIO0</p></td>
<td><p>D6/A0</p></td>
<td><p>IO, MISO</p></td>
<td><p>GPIO13</p></td>
<td><p>D6/A0</p></td>
<td><p>IO, MISO</p></td>
</tr>
<tr class="row-odd"><td><p>MOSI</p></td>
<td><p>sx3</p></td>
<td><p>GPIO13</p></td>
<td><p>D7</p></td>
<td><p>IO, MOSI</p></td>
<td><p>GPIO4</p></td>
<td><p>D7/A4</p></td>
<td><p>IO, MOSI</p></td>
<td><p>GPIO11</p></td>
<td><p>D7/A4</p></td>
<td><p>IO, MOSI</p></td>
</tr>
<tr class="row-even"><td><p>SS (V3 with RTC)</p></td>
<td><p>sx2</p></td>
<td><p>GPIO15</p></td>
<td><p>D8</p></td>
<td><p>IO, 10k Pull-down, SS</p></td>
<td><p>GPIO5</p></td>
<td><p>D8/A5</p></td>
<td><p>IO, 10k Pull-down, SS</p></td>
<td><p>GPIO10</p></td>
<td><p>D8/A5</p></td>
<td><p>IO, 10k Pull-down, SS</p></td>
</tr>
<tr class="row-odd"><td><p>GND</p></td>
<td><p>dx2</p></td>
<td><p>GND</p></td>
<td><p>G</p></td>
<td><p>Ground</p></td>
<td><p>GND</p></td>
<td><p>G</p></td>
<td><p>Ground</p></td>
<td><p>GND</p></td>
<td><p>G</p></td>
<td><p>Ground</p></td>
</tr>
<tr class="row-even"><td><p>5v</p></td>
<td><p>dx1</p></td>
<td><p>-</p></td>
<td><p>5V</p></td>
<td><p>5V</p></td>
<td><p>-</p></td>
<td><p>5V</p></td>
<td><p>5V</p></td>
<td><p>-</p></td>
<td><p>5V</p></td>
<td><p>5V</p></td>
</tr>
<tr class="row-odd"><td><p>3.3V</p></td>
<td><p>sx1</p></td>
<td><p>3.3V</p></td>
<td><p>3V3</p></td>
<td><p>3.3V</p></td>
<td><p>3.3V</p></td>
<td><p>3V3</p></td>
<td><p>3.3V</p></td>
<td><p>3.3V</p></td>
<td><p>3V3</p></td>
<td><p>3.3V</p></td>
</tr>
<tr class="row-even"><td><p>RST</p></td>
<td><p>sx8</p></td>
<td><p>RST</p></td>
<td><p>RST</p></td>
<td><p>Reset</p></td>
<td><p>RST</p></td>
<td><p>RST</p></td>
<td><p>Reset</p></td>
<td><p>RST</p></td>
<td><p>RST</p></td>
<td><p>Reset</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>All of the IO pins run at 3.3V.</p>
</div>
</section>
<section id="appendice-d-indirizzi-i2c">
<h2>Appendice D Indirizzi I2C<a class="headerlink" href="#appendice-d-indirizzi-i2c" title="Link to this heading"></a></h2>
<p><strong>Indirizzi I2C</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>DEC</p></th>
<th class="head"><p>HEX</p></th>
<th class="head"><p>Device</p></th>
<th class="head"><p>50</p></th>
<th class="head"><p>100</p></th>
<th class="head"><p>200</p></th>
<th class="head"><p>250</p></th>
<th class="head"><p>400</p></th>
<th class="head"><p>500</p></th>
<th class="head"><p>800</p></th>
<th class="head"><p>[KHz]</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>49</p></td>
<td><p>0x31</p></td>
<td><p>bottone</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>60</p></td>
<td><p>0x3C</p></td>
<td><p>display
64X48</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>60</p></td>
<td><p>0x3D</p></td>
<td><p>display
128X64</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>68</p></td>
<td><p>0x44</p></td>
<td><p>SHT</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>80</p></td>
<td><p>0x50</p></td>
<td><p>GPS</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>.</p></td>
<td><p>.</p></td>
<td><p>.</p></td>
<td><p>.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>80</p></td>
<td><p>0x54</p></td>
<td><p>GPS</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>.</p></td>
<td><p>.</p></td>
<td><p>.</p></td>
<td><p>.</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>97</p></td>
<td><p>0x61</p></td>
<td><p>SCD</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>104</p></td>
<td><p>0x68</p></td>
<td><p>RTC</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>.</p></td>
<td><p>.</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>105</p></td>
<td><p>0x69</p></td>
<td><p>SPS</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>8 devices found</p>
</div>
</section>
<section id="appendice-e-i2c-resistenze-di-pull-up">
<h2>Appendice E I2C resistenze di pull up<a class="headerlink" href="#appendice-e-i2c-resistenze-di-pull-up" title="Link to this heading"></a></h2>
<p><strong>I2C resistenze di pull up</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Shield</p></th>
<th class="head"><p>SDA</p></th>
<th class="head"><p>SCL</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Oled Shield</p></td>
<td><p>4.7K</p></td>
<td><p>4.7K</p></td>
</tr>
<tr class="row-odd"><td><p>RTC and Microsd
data Logger Shield</p></td>
<td><p>10K</p></td>
<td><p>10K</p></td>
</tr>
<tr class="row-even"><td><p>MCU - Espressif
ESP32 C3</p></td>
<td><p>10K</p></td>
<td><p>---</p></td>
</tr>
<tr class="row-odd"><td><p>Totale</p></td>
<td><p>2.4K</p></td>
<td><p>3.2K</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Piè di pagina">
        <a href="../stimawifi_v2/stima_wifi_howto.html" class="btn btn-neutral float-left" title="Stima WiFi V2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Precedente</a>
        <a href="../testa_prelievo/testa_prelievo.html" class="btn btn-neutral float-right" title="Testa di prelievo per sensori Air Quality" accesskey="n" rel="next">Prossimo <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, CC BY-SA 4.0, Parco dei Cedri nel cuore.</p>
  </div>

  Realizzato con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    fornito da <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>