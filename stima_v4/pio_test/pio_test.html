

<!DOCTYPE html>
<html class="writer-html5" lang="it" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Platformio unit tests &mdash; http://rmap.cc</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=7a5cd723" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=b3290714"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/translations.js?v=45930005"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Indice" href="../../genindex.html" />
    <link rel="search" title="Cerca" href="../../search.html" />
    <link rel="next" title="Stima WiFi" href="../../stima_wifi/index.html" />
    <link rel="prev" title="Manuale software" href="../software_manual/software_manual.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            RMAP e Stima
              <img src="../../_static/logo_stima.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Cerca documenti" aria-label="Cerca documenti" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Menu di navigazione">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../rmap_rfc/rfc.html">RFC rmap versione 3.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../obsolete/index.html">Stima obsolete</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stima_v3/stima_v3.html">Stima V3</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../stima_v4.html">Stima V4</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../manual/manual_stima_V4_1.2.html">Manuale d'uso e manutenzione</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_manual/user_manual.html">Manuale Utente</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software_manual/software_manual.html">Manuale software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software_manual/software_manual.html#documentazione-del-codice">Documentazione del codice</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Platformio unit tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisiti-per-l-esecuzione-dei-test">Prerequisiti per l'esecuzione dei test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scheda-master">Scheda Master</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scheda-slave">Scheda Slave</a></li>
<li class="toctree-l3"><a class="reference internal" href="#can-hardware-setup">Can hardware setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#display-lcd">Display LCD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-1">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-1">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-1">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#http">HTTP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-2">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-2">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-2">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#master-queue-data">Master queue data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-3">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-3">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-3">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#master-o-slave-memory">Master o Slave memory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-4">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-4">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-4">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#modem-gsm-hardware-setup">Modem GSM hardware setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-5">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-5">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-5">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mqtt">MQTT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-6">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-6">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-6">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ntp">NTP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-7">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-7">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-7">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#rpc-test-and-reboot">RPC Test and Reboot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-8">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-8">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-8">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#slave-low-power">Slave low power</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-9">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-9">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-9">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#slave-register">Slave register</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-10">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-10">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-10">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#stack-fault-exception">Stack Fault Exception</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-11">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-11">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-11">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#queue-log-with-sd-card">Queue log with SD Card</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-12">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-12">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-12">Descrizione software</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#uavcan">Uavcan</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-13">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#collegamenti-necessari">Collegamenti necessari</a></li>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-13">Procedimento</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#watchdog">Watchdog</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#procedimento-14">Procedimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requisiti-hardware-14">Requisiti hardware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descrizione-software-13">Descrizione software</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stima_wifi/index.html">Stima WiFi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../server_rmap/server_rmap.html">Server RMAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../videotutorial/videotutorial.html">Videotutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dispense/index.html">Dispense</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../progetti/index.html">Progetti</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Menu navigazione dispositivi mobili" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">RMAP e Stima</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Naviga tra le pagine">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../stima_v4.html">Stima V4</a></li>
      <li class="breadcrumb-item active">Platformio unit tests</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/stima_v4/pio_test/pio_test.rst.txt" rel="nofollow"> Visualizza sorgente pagina</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="platformio-unit-tests">
<h1>Platformio unit tests<a class="headerlink" href="#platformio-unit-tests" title="Link to this heading"></a></h1>
<section id="prerequisiti-per-l-esecuzione-dei-test">
<h2>Prerequisiti per l'esecuzione dei test<a class="headerlink" href="#prerequisiti-per-l-esecuzione-dei-test" title="Link to this heading"></a></h2>
<p>I moduli Master e Slave necessitano di un'alimentazione da 9-30V.</p>
<p><strong>Tutti i test elencati sono stati eseguiti nella data del 05/04/2023
presso la sede Digiteco con esito positivo.</strong></p>
<p>N.B. Per la replica dei test è necessario inserire i jumper delle schede
master e slave in modalità default come di seguito descritta.</p>
</section>
<section id="scheda-master">
<h2>Scheda Master<a class="headerlink" href="#scheda-master" title="Link to this heading"></a></h2>
<p>master-sheet</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Identificatore</p></th>
<th class="head"><p>Descrizione</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>J1</p></td>
<td><p>Connettore Encoder</p></td>
</tr>
<tr class="row-odd"><td><p>J2</p></td>
<td><p>Connettore Programmatore MCU</p></td>
</tr>
<tr class="row-even"><td><p>J3</p></td>
<td><p>Connettore Micro SD-Card</p></td>
</tr>
<tr class="row-odd"><td><p>J4</p></td>
<td><p>Connettore CAN BUS</p></td>
</tr>
<tr class="row-even"><td><p>J5</p></td>
<td><p>Connettore EIA RS-232</p></td>
</tr>
<tr class="row-odd"><td><p>J6</p></td>
<td><p>Connettore USB-C</p></td>
</tr>
<tr class="row-even"><td><p>J7</p></td>
<td><p>Connettore Alimentazione board</p></td>
</tr>
<tr class="row-odd"><td><p>JP1 e JP2</p></td>
<td><p>Abilitazione terminatori di linea
CAN BUS - Default jumper inserito</p></td>
</tr>
<tr class="row-even"><td><p>JP3</p></td>
<td><p>Abilitazione UPIN27 o connettore
EIA RS232 - Default jumper
inserito sui pin 1-2 (UPIN27)</p></td>
</tr>
<tr class="row-odd"><td><p>JP4</p></td>
<td><p>Abilitazione LED DL1 di colore
verde - Default jumper inserito</p></td>
</tr>
<tr class="row-even"><td><p>BOOT1</p></td>
<td><p>Abilitazione BOOT</p></td>
</tr>
<tr class="row-odd"><td><p>BATT1</p></td>
<td><p>Abilitazione batteria tampone -
Default jumper inserito</p></td>
</tr>
</tbody>
</table>
</section>
<section id="scheda-slave">
<h2>Scheda Slave<a class="headerlink" href="#scheda-slave" title="Link to this heading"></a></h2>
<p>slave-sheet</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Identificatore</p></th>
<th class="head"><p>Descrizione</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>J1</p></td>
<td><p>Connettore Programmatore MCU</p></td>
</tr>
<tr class="row-odd"><td><p>J2</p></td>
<td><p>Connettore I2C 12V</p></td>
</tr>
<tr class="row-even"><td><p>J3</p></td>
<td><p>Connettore CAN BUS</p></td>
</tr>
<tr class="row-odd"><td><p>J4</p></td>
<td><p>Connettore EIA RS-232 3V3</p></td>
</tr>
<tr class="row-even"><td><p>J5</p></td>
<td><p>Connettore EIA RS-232</p></td>
</tr>
<tr class="row-odd"><td><p>J6</p></td>
<td><p>Connettore SPI</p></td>
</tr>
<tr class="row-even"><td><p>J7</p></td>
<td><p>Connettore Ingressi digitali</p></td>
</tr>
<tr class="row-odd"><td><p>J8</p></td>
<td><p>Connettore Ingressi analogici</p></td>
</tr>
<tr class="row-even"><td><p>J9</p></td>
<td><p>Connettore Alimentazione sensori
5V e 3V3</p></td>
</tr>
<tr class="row-odd"><td><p>J10</p></td>
<td><p>Connettore Alimentazione sensori
12V</p></td>
</tr>
<tr class="row-even"><td><p>J12</p></td>
<td><p>Connettore Alimentazione board</p></td>
</tr>
<tr class="row-odd"><td><p>JP1</p></td>
<td><p>Impostazione della programmazione
- Default jumper inserito sui pin
1-2</p></td>
</tr>
<tr class="row-even"><td><p>JP2</p></td>
<td><p>Abilitazione BOOT</p></td>
</tr>
<tr class="row-odd"><td><p>JP3</p></td>
<td><p>Abilitazione batteria tampone -
Default jumper inserito</p></td>
</tr>
<tr class="row-even"><td><p>JP4 e JP5</p></td>
<td><p>Abilitazione terminatori di linea
CAN BUS - Default jumper inserito</p></td>
</tr>
<tr class="row-odd"><td><p>JP6</p></td>
<td><p>Impostazione dell'alimentazione
dell'I2C esteso e bufferizzato
dal PCA9517D (5V o 3V3)</p></td>
</tr>
<tr class="row-even"><td><p>JP7</p></td>
<td><p>Impostazione doppia alimentazione
del traslatore di livello
TXU0204-Q1 (5V o 3V3)</p></td>
</tr>
<tr class="row-odd"><td><p>da JP8 a JP31</p></td>
<td><p>Impostazione del tipo di ingresso
del segnale analogico</p></td>
</tr>
<tr class="row-even"><td><p>JP32</p></td>
<td><p>Abilitazione LED DL1 di colore
verde - Default jumper inserito</p></td>
</tr>
<tr class="row-odd"><td><p>da JP33 a JP35</p></td>
<td><p>Abilitazione resistori da 1K5 in
ingresso agli optoisolatori per
utilizzare gli ingressi digitali
a 5V</p></td>
</tr>
</tbody>
</table>
</section>
<section id="can-hardware-setup">
<h2>Can hardware setup<a class="headerlink" href="#can-hardware-setup" title="Link to this heading"></a></h2>
<p>Percorso test: <em>rmap/platformio/stima_v4/test/master_can_setup</em></p>
<section id="procedimento">
<h3>Procedimento<a class="headerlink" href="#procedimento" title="Link to this heading"></a></h3>
<p>Eseguire tramite linea di comando: <strong>pio run test</strong></p>
</section>
<section id="requisiti-hardware">
<h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware" title="Link to this heading"></a></h3>
<p>Modulo Master</p>
</section>
<section id="descrizione-software">
<h3>Descrizione software<a class="headerlink" href="#descrizione-software" title="Link to this heading"></a></h3>
<p>Test sull'inizializzazione e avvio hardware del CAN BUS: 1. Impostazione
bit-rate CAN 2. Configurazione velocità e modalità BXCan 3. Avvio modulo
CAN 4. Abilitazione interrupts 5. Verifica delle sottoscrizioni messaggi
Canard</p>
<p>Il test effettua la programmazione delle apparecchiature hardware HAL
STM32 e il chip di alimentazione della linea CAN StimaV4. Viene inoltre
tramite l'utilizzo dei registri UAVCAN memorizzati su EEprom configurata
e programmata la velocità di linea CAN. Se la velocità non è corretta
viene impostata la velocità di Default di 1 Mhz e nuovamente
riprogrammata la sequenza.</p>
</section>
</section>
<section id="display-lcd">
<h2>Display LCD<a class="headerlink" href="#display-lcd" title="Link to this heading"></a></h2>
<p>Percorso test: <em>rmap/platformio/stima_v4/test/master_lcd</em></p>
<section id="procedimento-1">
<span id="id1"></span><h3>Procedimento<a class="headerlink" href="#procedimento-1" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Eseguire tramite linea di comando: <strong>pio run test</strong></p></li>
<li><p>Effettuare una pressione sull'encoder rotativo per attivare il
display</p></li>
</ol>
</section>
<section id="requisiti-hardware-1">
<span id="id2"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-1" title="Link to this heading"></a></h3>
<p>Modulo Master</p>
</section>
<section id="descrizione-software-1">
<span id="id3"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-1" title="Link to this heading"></a></h3>
<p>Test sull'inizializzazione e avvio del task LCD con scrittura “Hello
World” sul display: effettua il test della libreria utilizzata con
semplici comandi e scritta HelloWorld. Viene utilizzata la libreria
U8gl2 opportunamente modifica per renderla funzionante. A partire dalla
libreria che utilizzava solamente l'I2C principale si è modificata per
renderla programmabile anche ad altri canali I2C e come parametro
nel'istanza principale è stato aggiunto il passagio del semaforo per la
gestione a basso livello del canale I2C nel sistema RTOS per rendere il
tutto più rapido possibile.</p>
</section>
</section>
<section id="http">
<h2>HTTP<a class="headerlink" href="#http" title="Link to this heading"></a></h2>
<p>Percorso test: <em>rmap/platformio/stima_v4/test/master_http</em></p>
<section id="procedimento-2">
<span id="id4"></span><h3>Procedimento<a class="headerlink" href="#procedimento-2" title="Link to this heading"></a></h3>
<p>Eseguire tramite linea di comando: <strong>pio run test</strong></p>
</section>
<section id="requisiti-hardware-2">
<span id="id5"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-2" title="Link to this heading"></a></h3>
<p>Modulo Master con il modulo GSM</p>
</section>
<section id="descrizione-software-2">
<span id="id6"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-2" title="Link to this heading"></a></h3>
<p>Richiede una fase precedente di connessione del modem GSM. 1.
Inizializzazione task e libreria Cyclone 2. Connessione http 3. Verifica
stringa avvio board 4. Ricezione rpc configurazione ricevuta 5.
Ricezione rpc richiesta reboot</p>
<p>Il test effettua la connessione https con parametri di default
preimpostati e avvia lo scaricamento della configurazione StimaV4.
Termina al raggiungimento corretto della prima linea di configurazione.
Viene utilizzata la libreria CycloneTCP opportunamente configurata nel
sistema. Il test è in conseguenza della connessione GSM che attiva il
collegamento http.</p>
</section>
</section>
<section id="master-queue-data">
<h2>Master queue data<a class="headerlink" href="#master-queue-data" title="Link to this heading"></a></h2>
<p>Percorso test: <em>rmap/platformio/stima_v4/test/master_queue_data</em></p>
<section id="procedimento-3">
<span id="id7"></span><h3>Procedimento<a class="headerlink" href="#procedimento-3" title="Link to this heading"></a></h3>
<p>Eseguire tramite linea di comando: <strong>pio run test</strong></p>
</section>
<section id="requisiti-hardware-3">
<span id="id8"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-3" title="Link to this heading"></a></h3>
<p>Modulo Master con il modulo SDCard UPIN27 (necessario collegarlo
attraverso il modulo GSM)</p>
</section>
<section id="descrizione-software-3">
<span id="id9"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-3" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Inizializzazione SD card , creazione di file dati fittizzio e
impostazione del puntatore ad un dato esistente/non esistente</p></li>
<li><p>Passaggio richiesta e risposta tramite coda gestita dal Supervisor
task</p></li>
</ol>
</section>
</section>
<section id="master-o-slave-memory">
<h2>Master o Slave memory<a class="headerlink" href="#master-o-slave-memory" title="Link to this heading"></a></h2>
<p>Percorso test Master: <em>rmap/platformio/stima_v4/test/master_memory</em>
Percorso test Slave: <em>rmap/platformio/stima_v4/test/slave_memory</em></p>
<section id="procedimento-4">
<span id="id10"></span><h3>Procedimento<a class="headerlink" href="#procedimento-4" title="Link to this heading"></a></h3>
<p>Eseguire tramite linea di comando: <strong>pio run test</strong></p>
</section>
<section id="requisiti-hardware-4">
<span id="id11"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-4" title="Link to this heading"></a></h3>
<p>Modulo Master o Slave</p>
</section>
<section id="descrizione-software-4">
<span id="id12"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-4" title="Link to this heading"></a></h3>
<p>Test sui task e librerie EEPROM e Flash con scrittura e lettura
automatica. 1. Scrittura di dati fittizi 2. Lettura e verifica dei dati
scritti in memoria</p>
</section>
</section>
<section id="modem-gsm-hardware-setup">
<h2>Modem GSM hardware setup<a class="headerlink" href="#modem-gsm-hardware-setup" title="Link to this heading"></a></h2>
<p>Percorso test: <em>rmap/platformio/stima_v4/test/master_gsm</em></p>
<section id="procedimento-5">
<span id="id13"></span><h3>Procedimento<a class="headerlink" href="#procedimento-5" title="Link to this heading"></a></h3>
<p>Eseguire tramite linea di comando: <strong>pio run test</strong></p>
</section>
<section id="requisiti-hardware-5">
<span id="id14"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-5" title="Link to this heading"></a></h3>
<p>Modulo Master con il modulo GSM</p>
</section>
<section id="descrizione-software-5">
<span id="id15"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-5" title="Link to this heading"></a></h3>
<p>Test sul task con inizializzazione, accensione, connessione e
spegnimento modulo SIM7600E: effettua la connessione modem con parametri
di default preimpostati e avvia a partire dal task supervisor(quello che
gestisce la comunicazione) il collegamento al driver C++ SIMCOM7600. La
libreria avvia la programmazione del modulo e la gestione delle
alimenazioni. Power ON/OFF e programmazione tramite comandi AT. Al
termine della programmazione standard viene attivata la modalità rapida
a 960Kbaud ed effettuato il collegamento PPP. Successivamente viene
colegata tramite buffer e struttura la libreria CycloneTCP che rende
disponibili tutte le sue funzioni al collegamento trasparente PPP.</p>
</section>
</section>
<section id="mqtt">
<h2>MQTT<a class="headerlink" href="#mqtt" title="Link to this heading"></a></h2>
<p>Percorso test: <em>rmap/platformio/stima_v4/test/master_mqtt</em></p>
<section id="procedimento-6">
<span id="id16"></span><h3>Procedimento<a class="headerlink" href="#procedimento-6" title="Link to this heading"></a></h3>
<p>Eseguire tramite linea di comando: <strong>pio run test</strong></p>
</section>
<section id="requisiti-hardware-6">
<span id="id17"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-6" title="Link to this heading"></a></h3>
<p>Modulo Master con il modulo GSM</p>
</section>
<section id="descrizione-software-6">
<span id="id18"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-6" title="Link to this heading"></a></h3>
<p>Richiede una fase precedente di connessione del modem GSM. 1.
Inizializzazione task e libreria Cyclone 2. Connessione al server mqtt
3. Connessione al topic 4. Pubblicazione di una stringa fittizia</p>
<p>Il test effettua la connessione mqtt con parametri di default
preimpostati e avvia la pubblicazione e sottoscrizioneal server Mqtt
utilizzato per StimaV4. Termina alla pubblicazione di una linea di test.
Viene utilizzata la libreria CycloneTCP opportunamente configurata nel
sistema. Il test è in conseguenza della connessione GSM che attiva il
collegamento mqtt.</p>
</section>
</section>
<section id="ntp">
<h2>NTP<a class="headerlink" href="#ntp" title="Link to this heading"></a></h2>
<p>Percorso test: <em>rmap/platformio/stima_v4/test/master_ntp</em></p>
<section id="procedimento-7">
<span id="id19"></span><h3>Procedimento<a class="headerlink" href="#procedimento-7" title="Link to this heading"></a></h3>
<p>Eseguire tramite linea di comando: <strong>pio run test</strong></p>
</section>
<section id="requisiti-hardware-7">
<span id="id20"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-7" title="Link to this heading"></a></h3>
<p>Modulo Master con il modulo GSM</p>
</section>
<section id="descrizione-software-7">
<span id="id21"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-7" title="Link to this heading"></a></h3>
<p>Richiede una fase precedente di connessione del modem GSM.</p>
<p>Test sul task con inizializzazione, connessione e ricezione data e ora:
effettua la connessione ntp con parametri di default preimpostati e
avvia la sincronizzazione RTC e successiva programmazione dell'orologio
tramite libreria STM32Duino. Termina alla sincronizzazione RTC e
corretta programmazione e rilettura dell'orologio. Viene utilizzata la
libreria CycloneTCP opportunamente configurata nel sistema. Il test è in
conseguenza della connessione GSM che attiva il collegamento http.</p>
</section>
</section>
<section id="rpc-test-and-reboot">
<h2>RPC Test and Reboot<a class="headerlink" href="#rpc-test-and-reboot" title="Link to this heading"></a></h2>
<p>Percorso test: <em>rmap/platformio/stima_v4/test/master_rpc_test_reboot</em></p>
<section id="procedimento-8">
<span id="id22"></span><h3>Procedimento<a class="headerlink" href="#procedimento-8" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Alimentare la board tramite le disposizioni elencate sopra</p></li>
<li><p>Connettere la board al PC mediante un cavo USB type-C e aprire il
programma dedicato.</p></li>
<li><p>Eseguire tramite linea di comando: <strong>pio run test</strong></p></li>
</ol>
</section>
<section id="requisiti-hardware-8">
<span id="id23"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-8" title="Link to this heading"></a></h3>
<p>Modulo Master</p>
</section>
<section id="descrizione-software-8">
<span id="id24"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-8" title="Link to this heading"></a></h3>
<p>Test della classe RPC con test e reboot rpc inviati da USB mediante un
programma dedicato: effettua la verifica di linee di comando usb-rs232
tramite connettore usb-c presente nel master. Il test attende tramite
USB che venga eseguia una RPC di esempio chiamata “RpcTest” o una
“Reboot” nelle modalità StimaV4. Termina alla ricezione di “RpcTest”. Un
segnale buzzer viene eseguito al “Reboot” in modo da verificare
l'effettivo riavvio del sistema sulla chiamata della RPC “Reboot”. Il
test verifica inoltre la catena di funzionamento USB_Serial e relativo
task di controllo e inoltro all'oggetto C++ RPC di StimaV4.</p>
</section>
</section>
<section id="slave-low-power">
<h2>Slave low power<a class="headerlink" href="#slave-low-power" title="Link to this heading"></a></h2>
<p>Percorso test: <em>rmap/platformio/stima_v4/test/slave_lowpower</em></p>
<section id="procedimento-9">
<span id="id25"></span><h3>Procedimento<a class="headerlink" href="#procedimento-9" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Alimentare la board Master e caricare il firmware che si trova nel
percorso: rmap/platformio/stima_v4/master</p></li>
<li><p>Alimentare la board Slave e caricare il firmware che si trova nel
percorso: rmap/platformio/stima_v4/slave_th</p></li>
<li><p>Collegare le boards tramite CAN bus: connettere CANH e CANL del
Master rispettivamente al CANH e CANL dello Slave. Una volta
terminato il collegamento, lo Slave entrerà in modalità Tickless.</p></li>
<li><p>Eseguire tramite linea di comando: <strong>pio run test</strong></p></li>
</ol>
</section>
<section id="requisiti-hardware-9">
<span id="id26"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-9" title="Link to this heading"></a></h3>
<p>Modulo Slave</p>
</section>
<section id="descrizione-software-9">
<span id="id27"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-9" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Entrata in modalità IDLE a FreeRTOS attivo senza soppressione tick
automatico</p></li>
<li><p>Entrata in modalità Tickless 2 e risveglio dal LowPower Stop 2</p></li>
</ul>
<p>Il test effettua la verifica della modalità LowPower di un modulo Slave.
Per il corretto funzionamento è necessario che sia presente il master
che invii allo slave il segnale di LowPower. Il modulo slave infatti è
concepito per entrare in modalità LowPower solo con comando da Master.
Il test evidenzia l'utilizzo delle funzionalità STM32Duino LowPower e la
sua integrazione con Tickless su LPTim1. Dopo la programmazione dei
timer e delle modalità LowPower, alla richiesta di LowPower dal Master
viene attivata la relativa modalità STOP2 e il test termina al risveglio
corretto della piena funzionalità.</p>
</section>
</section>
<section id="slave-register">
<h2>Slave register<a class="headerlink" href="#slave-register" title="Link to this heading"></a></h2>
<p>Percorso test: <em>rmap/platformio/stima_v4/test/slave_register</em></p>
<section id="procedimento-10">
<span id="id28"></span><h3>Procedimento<a class="headerlink" href="#procedimento-10" title="Link to this heading"></a></h3>
<p>Eseguire tramite linea di comando: <strong>pio run test</strong></p>
</section>
<section id="requisiti-hardware-10">
<span id="id29"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-10" title="Link to this heading"></a></h3>
<p>Modulo Slave</p>
</section>
<section id="descrizione-software-10">
<span id="id30"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-10" title="Link to this heading"></a></h3>
<p>Test sull'inizializzazione, scrittura e lettura di un registro UAVCAN
memorizzato nella EEPROM: effettua la verifica della libreria UAVCAN
Register che permette la conservazione di registri UAVCAN nel modulo. La
gestione dei registri è stata integrata nella EEProm interna e le
chiamate di libreria leggono, scrivono inizializzano i registri in
modalità trasparente appogiandosi alla memoria EEProm di StimaV4.</p>
</section>
</section>
<section id="stack-fault-exception">
<h2>Stack Fault Exception<a class="headerlink" href="#stack-fault-exception" title="Link to this heading"></a></h2>
<p>Percorso test:
<em>rmap/platformio/stima_v4/test/master_stack_overflow_beep</em></p>
<section id="procedimento-11">
<span id="id31"></span><h3>Procedimento<a class="headerlink" href="#procedimento-11" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Il seguente test viene eseguito con il caricamento del firmware
mediante il comando: pio run -e stimav4_master -t upload</p></li>
<li><p>Quando si raggiunge l'overflow dello stack, il cicalino emetterà un
treno di impulsi che segnalano l'attivazione di un errore. Per una
controverifica modificare in src/main.cppcommentandola riga di
definizione del Supervisor task</p></li>
</ol>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="n">SupervisorTasksupervisor_task</span><span class="p">(</span><span class="s">&quot;SupervisorTask&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="n">OS_TASK_PRIORITY_02</span><span class="p">,</span><span class="w"> </span><span class="n">supervisorParam</span><span class="p">);</span>
</pre></div>
</div>
<p>e decommentando la linea superiore che presenta la stessa definizione ma
con una dimensione maggiore di stack assegnata. Ciò permetterà di non
raggiungere l'overflow.</p>
</section>
<section id="requisiti-hardware-11">
<span id="id32"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-11" title="Link to this heading"></a></h3>
<p>Modulo Master</p>
</section>
<section id="descrizione-software-11">
<span id="id33"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-11" title="Link to this heading"></a></h3>
<p>Test che simula un overlflow da parte dello stack: effettua la
dimostrazione del funzionamento delle funzioni di callBack inserite nel
modulo freertos_callback, che contengono tutte le chiamate agli errori
di sistema. In particolare viene ridotto lo stack di un task per
verificare e simulare un errore di memoria e verificarne tramite
attivazione del buzzere dell'avvenuta call_back nelle funzioni di
sistema.</p>
</section>
</section>
<section id="queue-log-with-sd-card">
<h2>Queue log with SD Card<a class="headerlink" href="#queue-log-with-sd-card" title="Link to this heading"></a></h2>
<p>Percorso test: <em>rmap/platformio/stima_v4/test/master_sd_queue_log</em></p>
<section id="procedimento-12">
<span id="id34"></span><h3>Procedimento<a class="headerlink" href="#procedimento-12" title="Link to this heading"></a></h3>
<p>Eseguire tramite linea di comando: <strong>pio run test</strong></p>
</section>
<section id="requisiti-hardware-12">
<span id="id35"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-12" title="Link to this heading"></a></h3>
<p>Modulo Master con il modulo SDCard UPIN27 (necessario collegarlo
attraverso il modulo GSM)</p>
</section>
<section id="descrizione-software-12">
<span id="id36"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-12" title="Link to this heading"></a></h3>
<p>Test che simula un comando su coda per effettuare un logging generico
con scrittura dati log su SD card: effettua un semplice push tramitre
coda al task SD Card che effettua un LOG al posto del TRACE su RS232 su
SD Card per un logging, conforme al TRACE su RS232. Dopo il push, viene
riverificata l'effettiva scrittura su SD del comando di logging e così
viene verificata SD, sua programmazione, coda con passaggio dati.</p>
</section>
</section>
<section id="uavcan">
<h2>Uavcan<a class="headerlink" href="#uavcan" title="Link to this heading"></a></h2>
<p>Percorso test Master:
<em>rmap/platformio/stima_v4/test/nucleo_uavcan/uavcan_master_cpp</em> Percorso
test Slave:
<em>rmap/platformio/stima_v4/test/nucleo_uavcan/uavcan_slave_cpp</em></p>
<section id="requisiti-hardware-13">
<span id="id37"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-13" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>STM32L496ZG (Master)</p></li>
<li><p>STM32L452RE (Slave)</p></li>
<li><p>2x MicroSD Card Adapter</p></li>
<li><p>2x SD-Card</p></li>
</ul>
</section>
<section id="collegamenti-necessari">
<h3>Collegamenti necessari<a class="headerlink" href="#collegamenti-necessari" title="Link to this heading"></a></h3>
<section id="connessione-moduli-con-microsd-card-adapter">
<h4>Connessione moduli con MicroSD Card Adapter<a class="headerlink" href="#connessione-moduli-con-microsd-card-adapter" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Master e Slave</p></th>
<th class="head"><p>MicroSD Card Adapter</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>5V</p></td>
<td><p>VCC</p></td>
</tr>
<tr class="row-odd"><td><p>GND</p></td>
<td><p>GND</p></td>
</tr>
<tr class="row-even"><td><p>PB6</p></td>
<td><p>CS</p></td>
</tr>
<tr class="row-odd"><td><p>PB13</p></td>
<td><p>SCK</p></td>
</tr>
<tr class="row-even"><td><p>PB14</p></td>
<td><p>MISO</p></td>
</tr>
<tr class="row-odd"><td><p>PB15</p></td>
<td><p>MOSI</p></td>
</tr>
</tbody>
</table>
</section>
<section id="connessione-moduli-tramite-can-bus">
<h4>Connessione moduli tramite CAN BUS<a class="headerlink" href="#connessione-moduli-tramite-can-bus" title="Link to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Master</p></th>
<th class="head"><p>Slave</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CAN TX PA12</p></td>
<td><p>CAN RX PA7</p></td>
</tr>
<tr class="row-odd"><td><p>CAN RX PA11</p></td>
<td><p>CAN TX PA6</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="procedimento-13">
<span id="id38"></span><h3>Procedimento<a class="headerlink" href="#procedimento-13" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Caricare il firmware nello Slave tramite linea di comando pio run -e
nucleo_l452re -t upload</p></li>
<li><p>Nel progetto del Master, decommentare il test da eseguire nel
platformio.ini (Selezionare solo un tipo di test alla volta)</p></li>
<li><p>Eseguire tramite linea di comando: <strong>pio run test</strong></p></li>
</ol>
</section>
</section>
<section id="watchdog">
<h2>Watchdog<a class="headerlink" href="#watchdog" title="Link to this heading"></a></h2>
<p>Percorso test: <em>rmap/platformio/stima_v4/test/master_watchdog</em></p>
<section id="procedimento-14">
<span id="id39"></span><h3>Procedimento<a class="headerlink" href="#procedimento-14" title="Link to this heading"></a></h3>
<p>Eseguire tramite linea di comando: <strong>pio run test</strong></p>
</section>
<section id="requisiti-hardware-14">
<span id="id40"></span><h3>Requisiti hardware<a class="headerlink" href="#requisiti-hardware-14" title="Link to this heading"></a></h3>
<p>Modulo Master</p>
</section>
<section id="descrizione-software-13">
<span id="id41"></span><h3>Descrizione software<a class="headerlink" href="#descrizione-software-13" title="Link to this heading"></a></h3>
<p>Test del task Watchdog. Verifica refresh con funzione presente in ogni
task e blocco con esecuzione Wathdog: effettua la verifica del WatchDog
per stima V4. In tutti i task master e slave sono stati inseriti delle
funzioni per effettuare il WatchDog a livello locale. Un Task principale
di watchdog effettua un continuo controllo dei task che devono azzerare
il relativo flag di controllo o porlo in uno stato di Sleep o Suspend
nel caso il task sia necessariamente soppresso per un tempo piuttosto
lungo. Il WatchDog Task effettua il reset fisico del WatchDog Hardware
solo se tutti i flag sono azzerati. In questo modo è abbastanza semplice
capire se un task è in stallo e agire di conseguenza sul software per
correggere potenziali problemi. Il test avvia il tutto in modalità
normale, succesivamente passati 10 secondi blocca volutamente un task e
il WatchDog interviene segnalando il task non rispondente.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Piè di pagina">
        <a href="../software_manual/software_manual.html" class="btn btn-neutral float-left" title="Manuale software" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Precedente</a>
        <a href="../../stima_wifi/index.html" class="btn btn-neutral float-right" title="Stima WiFi" accesskey="n" rel="next">Prossimo <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, CC BY-SA 4.0, Parco dei Cedri nel cuore.</p>
  </div>

  Realizzato con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    fornito da <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>