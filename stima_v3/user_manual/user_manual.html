

<!DOCTYPE html>
<html class="writer-html5" lang="it" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Manuale Utente &mdash; RMAP e Stima 3 documentazione</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Indice" href="../../genindex.html" />
    <link rel="search" title="Cerca" href="../../search.html" />
    <link rel="next" title="Stima V4" href="../../stima_v4/stima_v4.html" />
    <link rel="prev" title="Documentazione del codice" href="../stimacode.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> RMAP e Stima
          

          
            
            <img src="../../_static/logo_stima.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../rmap_rfc/rfc.html">RFC rmap versione 3.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../obsolete/index.html">Stima obsolete</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../stima_v3.html">Stima V3</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../howto_stima_v3/howto_stima_v3.html">Howto per Stima versione 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto_stima_v3.2/howto_stima_v3.2.html">Howto per Stima versione 3.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development_guide/development_guide.html">Guida per lo sviluppo software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stimacode.html">Documentazione del codice</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Manuale Utente</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hardware">Hardware</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#funzioni-svolte-dalle-board">Funzioni svolte dalle Board</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#funzioni-software">Funzioni software</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#accensione-e-supervisione-supervisor-task">Accensione e supervisione (supervisor task)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rtc-task">RTC task</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time-task">Time task</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gsm-task">GSM task</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sensors-reading-task">Sensors reading task</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-saving-task">Data saving task</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mqtt-task">MQTT task</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#messa-in-opera">Messa in opera</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#connessione-e-disconnessione">Connessione e disconnessione</a></li>
<li class="toctree-l4"><a class="reference internal" href="#regolazione-display">Regolazione Display</a></li>
<li class="toctree-l4"><a class="reference internal" href="#assemblaggio-scatola-stazione">Assemblaggio scatola stazione</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">SDcard</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configurazione-sensori">Configurazione sensori</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sensore-del-vento-windsonic">Sensore del vento Windsonic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configurazione-moduli">Configurazione moduli</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tramite-modulo-sensor-config">Tramite modulo sensor_config.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tramite-modulo-master">Tramite modulo master.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configurazione-stazione">Configurazione stazione</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creare-un-nuovo-utente-rmap-tramite-interfaccia-web">Creare un nuovo utente RMAP tramite interfaccia WEB</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configurare-una-nuova-stazione">Configurare una nuova stazione</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modificare-la-configurazione-di-una-stazione-esistente">Modificare la configurazione di una stazione esistente</a></li>
<li class="toctree-l4"><a class="reference internal" href="#trasferire-la-configurazione-al-datalogger">Trasferire la configurazione al datalogger</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#aggiornamento-firmware">Aggiornamento Firmware</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tramite-sdcard">Tramite SDcard</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tramite-porta-usb">Tramite porta USB</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#recupero-dati">Recupero dati</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remote-procedure-call">Remote Procedure Call</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configure">configure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reboot">reboot</a></li>
<li class="toctree-l4"><a class="reference internal" href="#recovery">recovery</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#temporizzazioni">Temporizzazioni</a></li>
<li class="toctree-l3"><a class="reference internal" href="#salvataggio-e-invio-dati">Salvataggio e invio dati</a></li>
<li class="toctree-l3"><a class="reference internal" href="#diagnostica">Diagnostica</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tramite-display">tramite DISPLAY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tramite-monitoraggio-mqtt">Tramite monitoraggio MQTT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tramite-porta-seriale">Tramite porta seriale</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">Tramite SDcard</a></li>
<li class="toctree-l4"><a class="reference internal" href="#diagnostica-del-bus-i2c">Diagnostica del bus I2C</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stima_v4/stima_v4.html">Stima V4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stima_wifi/index.html">Stima WiFi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../server_rmap/server_rmap.html">Server RMAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../videotutorial/videotutorial.html">Videotutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dispense/index.html">Dispense</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">RMAP e Stima</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../stima_v3.html">Stima V3</a> &raquo;</li>
        
      <li>Manuale Utente</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/stima_v3/user_manual/user_manual.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="manuale-utente">
<h1>Manuale Utente<a class="headerlink" href="#manuale-utente" title="Link a questa intestazione">¶</a></h1>
<div class="section" id="hardware">
<h2>Hardware<a class="headerlink" href="#hardware" title="Link a questa intestazione">¶</a></h2>
<p>Descrizione dell'hardware e delle sue principali funzioni.</p>
<p>Il datalogger è composto da moduli a loro volta composti board.
Una descrizione con alcune foto si trova a <a class="reference external" href="https://doc.rmap.cc/stima_v3/howto_stima_v3/howto_stima_v3.html">https://doc.rmap.cc/stima_v3/howto_stima_v3/howto_stima_v3.html</a> e <a class="reference external" href="https://doc.rmap.cc/stima_v3/doxygen/index.html">https://doc.rmap.cc/stima_v3/doxygen/index.html</a>
a cui fare riferimento per maggiori dettagli.
I moduli si interconnettono tra loro tramite bus I2C.
Le board si interconnettono tramite interfaccia basata sullo standard UPIN-27.</p>
<div class="section" id="funzioni-svolte-dalle-board">
<h3>Funzioni svolte dalle Board<a class="headerlink" href="#funzioni-svolte-dalle-board" title="Link a questa intestazione">¶</a></h3>
<div class="section" id="rtc">
<h4>RTC<a class="headerlink" href="#rtc" title="Link a questa intestazione">¶</a></h4>
<ul class="simple">
<li><p>determina la base dei tempi per il modulo master</p></li>
<li><p>conserva data e ora anche in mancanza di alimentazione tramite la
carica accumulata in un supercondensatore per non più di ~24h</p></li>
</ul>
</div>
<div class="section" id="core">
<h4>Core+<a class="headerlink" href="#core" title="Link a questa intestazione">¶</a></h4>
<p>Contiene il microcontrollore in queste due versioni:
* 8 MHz 3.3V
* 16 MHz 5V</p>
</div>
<div class="section" id="usb">
<h4>USB<a class="headerlink" href="#usb" title="Link a questa intestazione">¶</a></h4>
<p>E' una interfaccia USB con la porta seriale del microcontrollore.
Permette di:
* caricare firmware
* effettuare debug</p>
</div>
<div class="section" id="sdcard">
<h4>SDcard<a class="headerlink" href="#sdcard" title="Link a questa intestazione">¶</a></h4>
<p>Permette di utilizzare una SDcard per effettuare:
* <a class="reference internal" href="#aggiornamento-firmware">Aggiornamento firmware</a>
* salvataggio dati
* debug</p>
</div>
<div class="section" id="i2c">
<h4>I2C<a class="headerlink" href="#i2c" title="Link a questa intestazione">¶</a></h4>
<p>Espone una:
* connessione I2C
* ponticello per effettuare la configurazione</p>
</div>
<div class="section" id="gsm">
<h4>GSM<a class="headerlink" href="#gsm" title="Link a questa intestazione">¶</a></h4>
<p>E' in realtà composto da due board:
* SIM: in cui deve essere inserita la SIM card
* vero e proprio modulo GSM: a cui deve essere connessa l'antenna</p>
</div>
<div class="section" id="hub">
<h4>HUB<a class="headerlink" href="#hub" title="Link a questa intestazione">¶</a></h4>
<ul class="simple">
<li><p>interconnessione</p></li>
<li><p>alimentazione</p></li>
<li><p>separazione BUS I2C e adattamento tensioni</p></li>
</ul>
</div>
<div class="section" id="display">
<h4>Display<a class="headerlink" href="#display" title="Link a questa intestazione">¶</a></h4>
<ul class="simple">
<li><p><a class="reference internal" href="#diagnostica">Diagnostica</a></p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="funzioni-software">
<h2>Funzioni software<a class="headerlink" href="#funzioni-software" title="Link a questa intestazione">¶</a></h2>
<p>Da scrivere</p>
<div class="section" id="accensione-e-supervisione-supervisor-task">
<h3>Accensione e supervisione (supervisor task)<a class="headerlink" href="#accensione-e-supervisione-supervisor-task" title="Link a questa intestazione">¶</a></h3>
</div>
<div class="section" id="rtc-task">
<h3>RTC task<a class="headerlink" href="#rtc-task" title="Link a questa intestazione">¶</a></h3>
<p>Da scrivere</p>
</div>
<div class="section" id="time-task">
<h3>Time task<a class="headerlink" href="#time-task" title="Link a questa intestazione">¶</a></h3>
<p>Da scrivere</p>
</div>
<div class="section" id="gsm-task">
<h3>GSM task<a class="headerlink" href="#gsm-task" title="Link a questa intestazione">¶</a></h3>
<p>Da scrivere</p>
</div>
<div class="section" id="sensors-reading-task">
<h3>Sensors reading task<a class="headerlink" href="#sensors-reading-task" title="Link a questa intestazione">¶</a></h3>
<p>Da scrivere</p>
</div>
<div class="section" id="data-saving-task">
<h3>Data saving task<a class="headerlink" href="#data-saving-task" title="Link a questa intestazione">¶</a></h3>
<p>Da scrivere</p>
</div>
<div class="section" id="mqtt-task">
<h3>MQTT task<a class="headerlink" href="#mqtt-task" title="Link a questa intestazione">¶</a></h3>
<p>Da scrivere</p>
</div>
</div>
<div class="section" id="messa-in-opera">
<h2>Messa in opera<a class="headerlink" href="#messa-in-opera" title="Link a questa intestazione">¶</a></h2>
<p>Da scrivere</p>
<div class="section" id="connessione-e-disconnessione">
<h3>Connessione e disconnessione<a class="headerlink" href="#connessione-e-disconnessione" title="Link a questa intestazione">¶</a></h3>
<div class="section" id="impilamento-board">
<h4>Impilamento board<a class="headerlink" href="#impilamento-board" title="Link a questa intestazione">¶</a></h4>
<p>Fare riferimento a:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://doc.rmap.cc/stima_v3/howto_stima_v3/howto_stima_v3.html">https://doc.rmap.cc/stima_v3/howto_stima_v3/howto_stima_v3.html</a> e</p></li>
<li><p><a class="reference external" href="https://doc.rmap.cc/stima_v3/doxygen/index.html">https://doc.rmap.cc/stima_v3/doxygen/index.html</a></p></li>
</ul>
</div>
<div class="section" id="connessione-moduli">
<h4>Connessione moduli<a class="headerlink" href="#connessione-moduli" title="Link a questa intestazione">¶</a></h4>
<p>Fare riferimento a:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://doc.rmap.cc/stima_v3/howto_stima_v3/howto_stima_v3.html">https://doc.rmap.cc/stima_v3/howto_stima_v3/howto_stima_v3.html</a> e</p></li>
<li><p><a class="reference external" href="https://doc.rmap.cc/stima_v3/doxygen/index.html">https://doc.rmap.cc/stima_v3/doxygen/index.html</a></p></li>
</ul>
<p>Effettuare tutte le operazioni senza alimentazione elettrica.</p>
<p>Per la connessione elettrica tra moduli bisogna quindi conoscere la
tensione di funzionamento di ciascun modulo/dispositivo da connettere
e verificare la predisposizione corretta del ponticello di
configurazione hardware sulla board I2C-hub.</p>
</div>
<div class="section" id="utilizzo-del-tool-sensor-config-menu-sdcard">
<h4>Utilizzo del tool sensor_config_menu_sdcard<a class="headerlink" href="#utilizzo-del-tool-sensor-config-menu-sdcard" title="Link a questa intestazione">¶</a></h4>
<p>Il firmware tool sensor_config_menu_sdcard può essere utilizzato in differenti configurazioni hardware:</p>
<ul>
<li><p>sul modulo master:</p>
<ul class="simple">
<li><p>pro: non richiede ulteriore hardware, configura tutti i moduli</p></li>
<li><p>contro: non permette la configurazione del sensore del vento windsonic</p></li>
</ul>
</li>
<li><p>sul modulo i2c-wind:</p>
<p>praticamente utile solo per configurare il sensore del vento windsonic</p>
</li>
<li><p>sul modulo dedicato sensor_config:</p>
<ul class="simple">
<li><p>pro: il modulo può essere utilizzato in modo indipendente per:
+ formattare SD card
+ <a class="reference internal" href="#diagnostica-del-bus-i2c">Diagnostica del bus I2C</a>
+ configurare i moduli
+ sensore del vento windsonic</p></li>
<li><p>contro:
+ richiede ulteriore hardware
+ non permette la configurazione del sensore del vento windsonic</p></li>
</ul>
</li>
</ul>
<p>Su qualunque modulo sia utilizzato il firmware sensor_config_menu_sdcard
esso utilizza come dispositivi di input (uno o più, in alternativa o in contemporanea)</p>
<blockquote>
<div><ul class="simple">
<li><p>input:
+ tramite encoder con bottone
+ da porta seriale (USB)
+ tramite telecomando a infrarossi</p></li>
<li><p>output:
+ su display LCD
+ su porta seriale (USB)</p></li>
</ul>
</div></blockquote>
<p>Ovviamente tali dispositivi di input e output possono essere
utilizzati solo se collegati hardware.</p>
</div>
</div>
<div class="section" id="regolazione-display">
<h3>Regolazione Display<a class="headerlink" href="#regolazione-display" title="Link a questa intestazione">¶</a></h3>
<p>Il display dispone di una apposita vite di regolazione (trimmer) del
contrasto che deve essere regolato per rendere il display leggibile.
Una cattica regolazione del contrasto rende i caratteri sul display
completamente invisibili.  Dispone inoltre di un pulsante per attivare
la retroilluminazione.  Accendere la stazione per avere qualche
messaggio visualizzato sul display, premere il pulsante di
retrilluminazione e procedere alla regolazione fino a una
visualizzazione ottimale.</p>
<img alt="../../_images/trimmer_regolazione_contrasto.jpg" src="../../_images/trimmer_regolazione_contrasto.jpg" />
</div>
<div class="section" id="assemblaggio-scatola-stazione">
<h3>Assemblaggio scatola stazione<a class="headerlink" href="#assemblaggio-scatola-stazione" title="Link a questa intestazione">¶</a></h3>
<p>I moduli possono essere montati in qualsiasi ordine.  Sulla piastra
HUB deve verificare se l’alimentazione e’ impostat a 3.3 V o 5 V; Tale
tensione si può impostare spostando il ponticello corrispondente. Nei
moduli nell board base e’ riportata una piccola saldatura in
prossimita’ della del valore stampato 3 V o 5 V che indica a quale
tensione funziona il modulo.  Il modulo primario ed il display hanno
una tensione di funzionamento di 5V.  I cavi interni di collegamento
tra moduli ed HUB hanno come differenza solo da lunghezza.</p>
<p>Quando si connette un cavo fare attenzione nel momento
dell'inserimento a non piegare i pin sulla scheda HUB.</p>
<div class="section" id="sostituzione-batteria">
<h4>Sostituzione  batteria<a class="headerlink" href="#sostituzione-batteria" title="Link a questa intestazione">¶</a></h4>
<p>Per misurare la tensione della batteria a vuoto è necessario staccare
un polo per misurare la tensione reale senza il contributo del
pannello solare.</p>
<p>Se c'è da cambiare la batteria bisogna staccare il connettore in hub,
in modo da non bloccare la stazione. Staccando il connettore non si
incorre infatti nel problema di alimentare il datalogger con una
tensione sotto i 6 V.</p>
<p>Per il cambio batteria procedere prima staccando il polo nero (-) e
poi il rosso (+). Poi connettere prima il polo rosso e poi il nero
alla nuova batteria.</p>
<p>Per togliere e ridare tensione alla stazione occorre agire sul
regolatore di carica pannello-batteria nel modo seguente:</p>
<p>Facendo riferimento alla figura</p>
<img alt="../../_images/regolatore_di_carica.png" src="../../_images/regolatore_di_carica.png" />
<ul class="simple">
<li><p>rimuovere il positivo del pannello dal regolatore di carica, individuato dal numero 1</p></li>
<li><p>rimuovere il positivo della batteria dal regolatore di carica, individuato dal numero 3</p></li>
<li><p>aspettare 10 secondi</p></li>
<li><p>ricollegare la batteria attraverso il pin numero 3</p></li>
<li><p>ricollegare la batteria attraverso il pin numero 1</p></li>
</ul>
<p>Quindi la sequenza dei collegamenti è 1-3-3-1</p>
</div>
<div class="section" id="antenna">
<h4>Antenna<a class="headerlink" href="#antenna" title="Link a questa intestazione">¶</a></h4>
<p>Di solito l’antenna e’ posizionata internamento della scatola
stazione, ma può essere posizionata all'esterno praticando un foro
alla base della scatola e facendo uscire il cavo tramite un passacavo.
Il connettore e’ standard quindi si può usare anche una antenna
esterna di tipo direzionale.</p>
</div>
</div>
<div class="section" id="id1">
<h3>SDcard<a class="headerlink" href="#id1" title="Link a questa intestazione">¶</a></h3>
<div class="section" id="formattazione">
<h4>Formattazione<a class="headerlink" href="#formattazione" title="Link a questa intestazione">¶</a></h4>
<p>La formattazione della SDcard deve essere eseguita in modo corretto
per garantire il funzionamento del datalogger.
Sono accettati due tipi di formattazione:</p>
<ul class="simple">
<li><p>FAT16</p></li>
<li><p>FAT32</p></li>
</ul>
<p>Per essere certi di formattare correttamentela card ci sono due possibilità:</p>
<ul class="simple">
<li><p>per windows e MAC <a class="reference external" href="https://www.sdcard.org/downloads/formatter/">https://www.sdcard.org/downloads/formatter/</a></p></li>
<li><p>per tutti i sistemi l'apposito firmware SdFormatter
o il tool sensor_config_menu_sdcard messi a disposizione con Stima V3</p></li>
</ul>
<p>Il metodo consigliato è il secondo.</p>
<div class="section" id="come-formattare-l-sdcard-con-il-firmware-sdformatter">
<h5>Come formattare l'SDcard con il firmware SdFormatter.<a class="headerlink" href="#come-formattare-l-sdcard-con-il-firmware-sdformatter" title="Link a questa intestazione">¶</a></h5>
<p>Inserire l'SDcard nel modulo master e collegare solo il modulo master tramite cavo USB.
eseguire:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pio</span> <span class="n">run</span> <span class="o">-</span><span class="n">e</span> <span class="mi">1284</span><span class="n">p16m</span> <span class="o">-</span><span class="n">t</span> <span class="n">upload</span>
<span class="n">pio</span> <span class="n">device</span> <span class="n">monitor</span>
</pre></div>
</div>
<p>e seguire le indicazioni del programma.</p>
</div>
<div class="section" id="come-formattare-l-sdcard-con-il-tool-sensor-config-menu-sdcard">
<h5>Come formattare l'SDcard con il tool sensor_config_menu_sdcard<a class="headerlink" href="#come-formattare-l-sdcard-con-il-tool-sensor-config-menu-sdcard" title="Link a questa intestazione">¶</a></h5>
<p>Il firmware sensor_config_menu_sdcard permette anche di formattare semplicemente l'SD card.
Fare riferimento alla sezione <a class="reference internal" href="#utilizzo-del-tool-sensor-config-menu-sdcard">Utilizzo del tool sensor_config_menu_sdcard</a></p>
</div>
</div>
<div class="section" id="aggiornamento-del-firmware">
<h4>Aggiornamento del Firmware<a class="headerlink" href="#aggiornamento-del-firmware" title="Link a questa intestazione">¶</a></h4>
<p>Vedi <a class="reference internal" href="#aggiornamento-firmware">Aggiornamento Firmware</a></p>
</div>
<div class="section" id="logging">
<h4>Logging<a class="headerlink" href="#logging" title="Link a questa intestazione">¶</a></h4>
<p>Vedi <a class="reference internal" href="#diagnostica">Diagnostica</a></p>
</div>
<div class="section" id="recupero-dei-dati">
<h4>Recupero dei dati<a class="headerlink" href="#recupero-dei-dati" title="Link a questa intestazione">¶</a></h4>
<p>Vedi <a class="reference internal" href="#recupero-dati">Recupero dati</a></p>
</div>
</div>
</div>
<div class="section" id="configurazione-sensori">
<h2>Configurazione sensori<a class="headerlink" href="#configurazione-sensori" title="Link a questa intestazione">¶</a></h2>
<p>Qui vengono descritte le fasi per effettuare la configurazione dei
sensori utilizzati dalla stazione.  La stazione dovrà essere
completamente assemblata per poter seguire le istruzioni qui
riportate.</p>
<div class="section" id="sensore-del-vento-windsonic">
<h3>Sensore del vento Windsonic<a class="headerlink" href="#sensore-del-vento-windsonic" title="Link a questa intestazione">¶</a></h3>
<p>Prima di poter utilizzare il sensore del vento Windsonic esso dovrà
essere opportunamente configurato.  Per farlo è necessario caricare il
firmware sensor_config_menu_sdcard sul modulo i2c-wind.
Connettere:</p>
<ul class="simple">
<li><p>(sconsigliato) utilizzare un monitor seriale sulla porta USB dello
stesso modulo</p></li>
<li><p>(consigliato) l'encoder insieme a un monitor seriale sulla porta USB
dello stesso modulo</p></li>
</ul>
<p>Seguire i menu selezionando &quot;configurazione windsonic&quot; per eseguire l'operazione.</p>
</div>
</div>
<div class="section" id="configurazione-moduli">
<h2>Configurazione moduli<a class="headerlink" href="#configurazione-moduli" title="Link a questa intestazione">¶</a></h2>
<div class="section" id="tramite-modulo-sensor-config">
<h3>Tramite modulo sensor_config.<a class="headerlink" href="#tramite-modulo-sensor-config" title="Link a questa intestazione">¶</a></h3>
<ul class="simple">
<li><p>inserire SD card</p></li>
<li><p>collegare il modulo sensor_config al bus I2C tramite l'HUB</p></li>
<li><p>seguire i menu per configurare il moduli secondo le proprie esigenze</p></li>
<li><p>disconnettere il modulo sensor_config e riavviare la stazione</p></li>
</ul>
</div>
<div class="section" id="tramite-modulo-master">
<h3>Tramite modulo master.<a class="headerlink" href="#tramite-modulo-master" title="Link a questa intestazione">¶</a></h3>
<ul class="simple">
<li><p>rimuovere le board GSM, SIM e RTC</p></li>
<li><p>collegare l'encoder e/o il monitor della porta seriale (USB)</p></li>
<li><p>senza SD card inserita caricare il firmware sensor_config_menu_sdcard</p></li>
<li><p>inserire la SD card</p></li>
<li><p>avviare la stazione</p></li>
<li><p>seguire i menu per configurare il moduli secondo le proprie esigenze</p></li>
<li><p>rimuovere l'SD card</p></li>
<li><p>caricare il firmware di stazione stima</p></li>
<li><p>inserire la SD card operativa</p></li>
<li><p>riavviare la stazione</p></li>
</ul>
</div>
</div>
<div class="section" id="configurazione-stazione">
<h2>Configurazione stazione<a class="headerlink" href="#configurazione-stazione" title="Link a questa intestazione">¶</a></h2>
<p>Qui vengono descritte le fasi per effettuare la configurazione della
stazione necessaria al suo funzionamento.</p>
<p>Al termine delle operazioni la configurazione verrà salvata
permanentemente sulla EEprom del modulo master.</p>
<div class="section" id="creare-un-nuovo-utente-rmap-tramite-interfaccia-web">
<h3>Creare un nuovo utente RMAP tramite interfaccia WEB<a class="headerlink" href="#creare-un-nuovo-utente-rmap-tramite-interfaccia-web" title="Link a questa intestazione">¶</a></h3>
<p>Per iscriversi alla piattarforma RMAP bisogna collegarsi al sito:
<a class="reference external" href="http://rmap.cc/">http://rmap.cc/</a></p>
<p>Andare con il mouse sul menù &quot;Il mio RMAP&quot;, sulla destra della barra
nera, e clickare su &quot;Entra&quot;.</p>
<p>Apparirà una maschera che chiede utente e password.  Nella seconda
riga sotto a questa maschera clickare sul bottone blu &quot;Registrazione&quot;
e si verrà inoltrati automaticamente alla maschera di registrazione.</p>
<p>Per registrarsi bisognerà scegliere ed inviare le seguenti informazioni:</p>
<ul class="simple">
<li><p>username (una stringa lunga al massimo 9 caratteri che possono essere sia lettere che numeri);</p></li>
<li><p>la propria e-mail</p></li>
<li><p>la password (da inserire due volte per sicurezza).</p></li>
</ul>
<p>Quindi bisogna clickare sul quadratino per dichiarare di aver letto le
Condizioni di Servizio (descritte nel quadrato sotto riportato).
Completate queste operazioni si può procedere a clickare su &quot;Invia&quot;.
Fatto questo il server RMAP invierà una mail di conferma all'indirizzo
indicato nella maschera di registrazione.  La registrazione verrà
conclusa aprendo il messaggio mail e confermando la propria intenzione di
iscriversi seguendo il link indicato.</p>
</div>
<div class="section" id="configurare-una-nuova-stazione">
<h3>Configurare una nuova stazione<a class="headerlink" href="#configurare-una-nuova-stazione" title="Link a questa intestazione">¶</a></h3>
<div class="section" id="tramite-interfaccia-web">
<h4>Tramite interfaccia WEB<a class="headerlink" href="#tramite-interfaccia-web" title="Link a questa intestazione">¶</a></h4>
<p>Tramite interfaccia WEB è possibile definire solo stazioni di modello
(tipo e sensori) predefinito. Per modelli di stazione non predefiniti
utilizzare la modalità a linea di comando.</p>
<p>Per poter registrare una nuova stazione è utile aver configurato un
utente RMAP.</p>
<p>Seguire il link:
<a class="reference external" href="https://rmap.cc/insertdata/newstation">https://rmap.cc/insertdata/newstation</a></p>
<p>Per definire la posizione della stazione si può seguire
alternativamente una delle seguenti procedure:</p>
<ul class="simple">
<li><p>indicare nel primo modulo l'indirizzo esatto della stazione (il sito
utilizza il DataBase geografico di OpenStreetMap che riconosce gli
indirizzi solo se indicati con precisione, quindi è necessario
inserire l'indirizzo con nome completo della via, es: &quot;viale Antonio
Silvani 6, Bologna&quot;, oppure &quot; via degli Albergati 32, Zola Predosa,
Bologna&quot;). Selezionare invia.</p></li>
<li><p>utilizzare la mappa sottostante, del secondo modulo, clickare sul
segnaposto (quello a forma di goccia, ultimo in basso dei quattro
centrali a sinistra della mappa) e posizionarlo sul punto preciso
della mappa, con doppio click bottone sinistro del mouse. Se la
posizione scelta non è corretta, si potrà cancellare la posizione
(selezionare l'ultimo bottone a sinistra nella mappa a forma di
bidone e poi clickare sul segnaposto) e riposizionare il marker,
oppure spostare il segnaposto nella posizione corretta direttamente
sulla mappa (selezionando prima il penultimo bottone a sinistra a
forma di matita su foglio &quot;edit layers&quot;, spostando il segnaposto e
riclickando su &quot;edit layer&quot; per salvare la nuova posizione). Queste
funzionalità potrebbero non essere disponibili su
Android. Selezionare invia.</p></li>
<li><p>inserire nel terzo modulo le coordinate (latitudine e longitudine in
formato sessagesimale</p></li>
</ul>
<p>Individuata la posizione in tutti i casi bisognerà indicare:
* il nome della nuova stazione
* altezza della stazione in metri dal livello medio del mare
* il modello (tipo e sensori collegati).</p>
<p>La procedura di inserimento della nuova stazione si concluderà quindi
clickando su &quot;invia&quot;.</p>
<p>Se i dati risulteranno corretti verranno presentati alcuni dati che
dovranno essere utilizzati per trasferire i dati alla stazione.</p>
</div>
<div class="section" id="a-linea-di-comando">
<h4>A linea di comando<a class="headerlink" href="#a-linea-di-comando" title="Link a questa intestazione">¶</a></h4>
<p>Il tool a linea di comando da utilizzare per configurare le stazioni è:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmap</span><span class="o">-</span><span class="n">configure</span>
</pre></div>
</div>
<p>Quando si utizzano i tool a linea di comando bisogna sempre
considerare che saranno presenti due database:</p>
<ul class="simple">
<li><p>database sul server RMAP (persistente)</p></li>
<li><p>database locale (volatile)</p></li>
</ul>
<p>Mentre il database sul server RMAP è per definizione persistente
quello locale se non già presente va creato utilizzando il comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmapctrl</span> <span class="o">--</span><span class="n">syncdb</span>
</pre></div>
</div>
<p>Successivamente sono disponibili due comandi per mantenere i due
database sincronizzati:</p>
<ul>
<li><p>upload configuration to server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">upload_to_server</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">password</span><span class="o">=</span><span class="s2">&quot;mypassword&quot;</span> <span class="o">--</span><span class="n">server</span><span class="o">=</span><span class="n">rmap</span><span class="o">.</span><span class="n">cc</span>
</pre></div>
</div>
</li>
<li><p>download station configuration from server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">download_from_server</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">password</span><span class="o">=</span><span class="s2">&quot;mypassword&quot;</span> <span class="o">--</span><span class="n">server</span><span class="o">=</span><span class="n">rmap</span><span class="o">.</span><span class="n">cc</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="con-modello-tipo-e-template-sensori-predefinito">
<h5>Con modello (tipo e template sensori) predefinito<a class="headerlink" href="#con-modello-tipo-e-template-sensori-predefinito" title="Link a questa intestazione">¶</a></h5>
<p>In questa modalità bisogna disporre di:</p>
<ul class="simple">
<li><p>myuser: nome utente RMAP</p></li>
<li><p>mypassword: password utente RMAP</p></li>
<li><p>mystationname: nome stazione esteso</p></li>
<li><p>myslug: nome stazione breve</p></li>
<li><p>mystationmodel: modello stazione e template sensori connessi</p></li>
<li><p>mystationname: nome stazione esteso</p></li>
<li><p>myheight: altezza stazione in metri</p></li>
<li><p>mqttsamplerate: ogni quanti secondi deve essere elaborato e inviato un report</p></li>
<li><p>mytcpipntpserver: NTP server da utilizzare per sincronizzare l'ora</p></li>
<li><p>myapn: apn del provider GSM corrispondente alla schda SIM inserita in stazione (default=&quot;ibox.tim.it&quot;)</p></li>
</ul>
<p>Comandi da impartire per configurare la stazione:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">wizard</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;myheight&quot;</span> <span class="o">--</span><span class="n">stationname</span><span class="o">=</span><span class="s2">&quot;mystationname&quot;</span> <span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;myusername --password=&quot;</span><span class="n">mypassword</span><span class="s2">&quot; --lat=&quot;</span><span class="n">mylat</span><span class="s2">&quot; --lon=&quot;</span><span class="n">mylon</span><span class="s2">&quot;</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addboard</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">serialactivate</span> <span class="o">--</span><span class="n">mqttactivate</span> <span class="o">--</span><span class="n">mqttuser</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">mqttpassword</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">mqttsamplerate</span><span class="o">=</span><span class="s2">&quot;mymqttsamplerate&quot;</span> <span class="o">--</span><span class="n">tcpipactivate</span> <span class="o">--</span><span class="n">tcpipntpserver</span><span class="o">=</span><span class="s2">&quot;mytcpipntpserver&quot;</span> <span class="o">--</span><span class="n">tcpipname</span><span class="o">=</span><span class="n">stima</span> <span class="o">--</span><span class="n">tcpipgsmapn</span><span class="o">=</span><span class="s2">&quot;myapn&quot;</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addsensors_by_template</span><span class="o">=</span><span class="s2">&quot;mystationmodel&quot;</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">password</span><span class="o">=</span><span class="s2">&quot;mypassword&quot;</span> <span class="o">--</span><span class="n">upload_to_server</span>
</pre></div>
</div>
<p>Esempio di configurazione:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">wizard</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="n">malborghetto</span> <span class="o">--</span><span class="n">height</span><span class="o">=</span><span class="mi">2</span> <span class="o">--</span><span class="n">stationname</span><span class="o">=</span><span class="s2">&quot;Malborghetto di Boara&quot;</span> <span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">password</span><span class="o">=</span><span class="s2">&quot;mypassword&quot;</span> <span class="o">--</span><span class="n">lat</span><span class="o">=</span><span class="mf">44.85892</span> <span class="o">--</span><span class="n">lon</span><span class="o">=</span><span class="mf">11.65625</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addboard</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="n">malborghetto</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">serialactivate</span> <span class="o">--</span><span class="n">mqttactivate</span> <span class="o">--</span><span class="n">mqttuser</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">mqttpassword</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">mqttsamplerate</span><span class="o">=</span><span class="mi">900</span> <span class="o">--</span><span class="n">tcpipactivate</span> <span class="o">--</span><span class="n">tcpipntpserver</span><span class="o">=</span><span class="s2">&quot;it.pool.ntp.org&quot;</span> <span class="o">--</span><span class="n">tcpipname</span><span class="o">=</span><span class="n">stima</span> <span class="o">--</span><span class="n">tcpipgsmapn</span> <span class="n">internet</span><span class="o">.</span><span class="n">wind</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addsensors_by_template</span><span class="o">=</span><span class="n">stima_report_thpbwr</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="n">malborghetto</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">password</span><span class="o">=</span><span class="s2">&quot;mypassword&quot;</span>  <span class="o">--</span><span class="n">upload_to_server</span>
</pre></div>
</div>
<p>Eseguire:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>per avere indicazioni su altri parametri per particolari personalizzazioni.</p>
</div>
<div class="section" id="con-modello-tipo-e-template-sensori-non-predefinito">
<h5>Con modello (tipo e template sensori) non predefinito<a class="headerlink" href="#con-modello-tipo-e-template-sensori-non-predefinito" title="Link a questa intestazione">¶</a></h5>
<p>In questa modalità bisogna avere piena padronanza del data model, dei sensori connessi e dei relativi metadati.</p>
<p>Qui un esempio di configurazione:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">wizard</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;altezzametri&quot;</span> <span class="o">--</span><span class="n">stationname</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;&quot;nome stazione&quot;&quot;&quot;&quot; --username=&quot;</span><span class="n">myuser</span><span class="s2">&quot; --password=&quot;</span><span class="n">mypassword</span><span class="s2">&quot; --server=test.rmap.cc --lat=&quot;</span><span class="n">latitudine</span><span class="s2">&quot; --lon=&quot;</span><span class="n">longitudine</span><span class="s2">&quot;  --mqttrootpath=report --mqttmaintpath=maint</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addboard</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">serialactivate</span> <span class="o">--</span><span class="n">server</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">rmap</span><span class="o">.</span><span class="n">cc</span> <span class="o">--</span><span class="n">mqttactivate</span> <span class="o">--</span><span class="n">mqttuser</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">mqttpassword</span><span class="o">=</span><span class="s2">&quot;mypassword&quot;</span> <span class="o">--</span><span class="n">mqttsamplerate</span><span class="o">=</span><span class="mi">900</span> <span class="o">--</span><span class="n">tcpipactivate</span> <span class="o">--</span><span class="n">tcpipntpserver</span><span class="o">=</span><span class="s2">&quot;it.pool.ntp.org&quot;</span> <span class="o">--</span><span class="n">tcpipname</span><span class="o">=</span><span class="n">stima</span> <span class="o">--</span><span class="n">tcpipgsmapn</span> <span class="n">ibox</span><span class="o">.</span><span class="n">tim</span><span class="o">.</span><span class="n">it</span> <span class="o">--</span><span class="n">server</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">rmap</span><span class="o">.</span><span class="n">cc</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">delsensors</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addsensor</span>  <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">sensorname</span><span class="o">=</span><span class="s2">&quot;temperatura e umidità istantanea&quot;</span> <span class="o">--</span><span class="n">driver</span><span class="o">=</span><span class="n">I2C</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="n">ITH</span> <span class="o">--</span><span class="n">address</span><span class="o">=</span><span class="mi">35</span> <span class="o">--</span><span class="n">timerange</span><span class="o">=</span><span class="s2">&quot;254,0,0&quot;</span> <span class="o">--</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;103,2000,-,-&quot;</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addsensor</span>  <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">sensorname</span><span class="o">=</span><span class="s2">&quot;temperatura e umidità minima&quot;</span>     <span class="o">--</span><span class="n">driver</span><span class="o">=</span><span class="n">I2C</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="n">NTH</span> <span class="o">--</span><span class="n">address</span><span class="o">=</span><span class="mi">35</span> <span class="o">--</span><span class="n">timerange</span><span class="o">=</span><span class="s2">&quot;3,0,900&quot;</span> <span class="o">--</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;103,2000,-,-&quot;</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addsensor</span>  <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">sensorname</span><span class="o">=</span><span class="s2">&quot;temperatura e umidità media&quot;</span>      <span class="o">--</span><span class="n">driver</span><span class="o">=</span><span class="n">I2C</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="n">MTH</span> <span class="o">--</span><span class="n">address</span><span class="o">=</span><span class="mi">35</span> <span class="o">--</span><span class="n">timerange</span><span class="o">=</span><span class="s2">&quot;0,0,900&quot;</span> <span class="o">--</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;103,2000,-,-&quot;</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addsensor</span>  <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">sensorname</span><span class="o">=</span><span class="s2">&quot;temperatura e umidità massima&quot;</span>    <span class="o">--</span><span class="n">driver</span><span class="o">=</span><span class="n">I2C</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="n">XTH</span> <span class="o">--</span><span class="n">address</span><span class="o">=</span><span class="mi">35</span> <span class="o">--</span><span class="n">timerange</span><span class="o">=</span><span class="s2">&quot;2,0,900&quot;</span> <span class="o">--</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;103,2000,-,-&quot;</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addsensor</span>  <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">sensorname</span><span class="o">=</span><span class="s2">&quot;pioggia&quot;</span>                          <span class="o">--</span><span class="n">driver</span><span class="o">=</span><span class="n">I2C</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="n">TBR</span> <span class="o">--</span><span class="n">address</span><span class="o">=</span><span class="mi">33</span> <span class="o">--</span><span class="n">timerange</span><span class="o">=</span><span class="s2">&quot;1,0,900&quot;</span> <span class="o">--</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;1,-,-,-&quot;</span>

<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span>  <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">password</span><span class="o">=</span><span class="s2">&quot;mypassword&quot;</span> <span class="o">--</span><span class="n">server</span><span class="o">=</span><span class="n">test</span><span class="o">.</span><span class="n">rmap</span><span class="o">.</span><span class="n">cc</span> <span class="o">--</span><span class="n">upload_to_server</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">config_station</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span>  <span class="o">--</span><span class="n">board_slug</span><span class="o">=</span><span class="n">default</span> <span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">baudrate</span><span class="o">=</span><span class="mi">115200</span> <span class="o">--</span><span class="n">device</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">ttyUSB0</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="modificare-la-configurazione-di-una-stazione-esistente">
<h3>Modificare la configurazione di una stazione esistente<a class="headerlink" href="#modificare-la-configurazione-di-una-stazione-esistente" title="Link a questa intestazione">¶</a></h3>
<p>E' possibile modificare la configurazione della stazione dopo aver
fatto login con il proprio utente e accedendo alla propia pagina
personale selezionando la stazione e seguendo i successivi menu.</p>
</div>
<div class="section" id="trasferire-la-configurazione-al-datalogger">
<h3>Trasferire la configurazione al datalogger<a class="headerlink" href="#trasferire-la-configurazione-al-datalogger" title="Link a questa intestazione">¶</a></h3>
<div class="section" id="tramite-il-tool-a-linea-di-comando-tramite-porta-seriale-usb">
<h4>Tramite il tool a linea di comando tramite porta seriale (USB)<a class="headerlink" href="#tramite-il-tool-a-linea-di-comando-tramite-porta-seriale-usb" title="Link a questa intestazione">¶</a></h4>
<p>Dopo aver collegato il modulo master tramite il cavo USB ecco il
comando da impartire per trasferire e salvare la configurazione nel
datalogger:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">config_station</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span>  <span class="o">--</span><span class="n">baudrate</span><span class="o">=</span><span class="mi">115200</span> <span class="o">--</span><span class="n">device</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">ttyUSB0</span>
</pre></div>
</div>
</div>
<div class="section" id="tramite-file-binario">
<h4>Tramite file binario<a class="headerlink" href="#tramite-file-binario" title="Link a questa intestazione">¶</a></h4>
<div class="section" id="salvare-il-file-binario-su-sd-card">
<h5>Salvare il file binario su SD card<a class="headerlink" href="#salvare-il-file-binario-su-sd-card" title="Link a questa intestazione">¶</a></h5>
<p>Per eseguire la configurazione bisogna disporre del file binario
versione 32 ottenuto dopo la configurazione della stazione sul server
dal server stesso:
* autenticarsi al server con il proprio utente e password
* accedere alla propria pagina personale
* selezionare la stazione di interesse
* scaricare il file dalla voce &quot;Scaricare la configurazione per Stima V3&quot;
* salvare il file su SD card</p>
</div>
<div class="section" id="salvare-la-configurazione-sulla-memoria-permanente-della-stazione">
<h5>Salvare la configurazione sulla memoria permanente della stazione<a class="headerlink" href="#salvare-la-configurazione-sulla-memoria-permanente-della-stazione" title="Link a questa intestazione">¶</a></h5>
<div class="section" id="tramite-sd-card-sul-modulo-master">
<h6>Tramite SD card sul modulo master<a class="headerlink" href="#tramite-sd-card-sul-modulo-master" title="Link a questa intestazione">¶</a></h6>
<ul class="simple">
<li><p>rinominare il file binario di configurazione col nome &quot;config.cfg&quot;</p></li>
<li><p>inserire l'SD card con il file binario sul modulo master</p></li>
<li><p>inserire il ponticello di configurazione sul modulo master, board I2C</p></li>
<li><p>attendere 20 secondi</p></li>
<li><p>rimuovere il ponticello di configurazione</p></li>
<li><p>riavviare la stazione</p></li>
</ul>
</div>
<div class="section" id="tramite-firmware-sensor-config-menu-sdcard">
<h6>Tramite firmware sensor_config_menu_sdcard<a class="headerlink" href="#tramite-firmware-sensor-config-menu-sdcard" title="Link a questa intestazione">¶</a></h6>
<div class="section" id="id2">
<h7>Tramite modulo sensor_config.<a class="headerlink" href="#id2" title="Link a questa intestazione">¶</a></h7>
<ul class="simple">
<li><p>inserire SD card con i vari file binari di configurazione per le
varie stazioni nel modulo sensor_config</p></li>
<li><p>collegare il modulo sensor_config al bus I2C tramite l'HUB</p></li>
<li><p>seguire i menu per configurare il modulo master</p></li>
<li><p>selezionare il corretto file binario di configurazione stazione</p></li>
<li><p>trasferire la configurazione al modulo master tramite I2C &quot;I2C save conf&quot;</p></li>
<li><p>disconnettere il modulo sensor_config e riavviare la stazione</p></li>
</ul>
</div>
<div class="section" id="id3">
<h7>Tramite modulo master.<a class="headerlink" href="#id3" title="Link a questa intestazione">¶</a></h7>
<ul class="simple">
<li><p>rimuovere le board GSM, SIM e RTC</p></li>
<li><p>collegare l'encoder e/o il monitor della porta seriale (USB)</p></li>
<li><p>senza SD card inserita caricare il firmware sensor_config_menu_sdcard</p></li>
<li><p>inserire la SD card con i vari file binari di configurazione per le
varie stazioni nel modulo sensor_config</p></li>
<li><p>avviare la stazione</p></li>
<li><p>selezionare il corretto file binario di configurazione stazione</p></li>
<li><p>seguire i menu per salvare la configurazione su eeprom &quot;EE save config&quot;</p></li>
<li><p>rimuovere l'SD card</p></li>
<li><p>caricare il firmware di stazione stima</p></li>
<li><p>inserire la SD card operativa</p></li>
<li><p>riavviare la stazione</p></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="aggiornamento-firmware">
<h2>Aggiornamento Firmware<a class="headerlink" href="#aggiornamento-firmware" title="Link a questa intestazione">¶</a></h2>
<div class="section" id="tramite-sdcard">
<h3>Tramite SDcard<a class="headerlink" href="#tramite-sdcard" title="Link a questa intestazione">¶</a></h3>
<p>Per l'aggiornamento del firmware è necessario avere a disposizione due file:</p>
<ul class="simple">
<li><p>FIRMWARE.BIN</p></li>
<li><p>&quot;majorversion&quot; . &quot;minorversion&quot;</p></li>
</ul>
<p>majorversion e minorversion indicano la versione del firmware in oggetto ad esempio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FIRMWARE</span><span class="o">.</span><span class="n">BIN</span>
<span class="mf">3.7</span>
</pre></div>
</div>
<p>I due file andranno posti nella cartella principale della SDcard.
Inserire l'SDcard nel modulo che necessita aggiornamento a modulo non
alimentato e alimentare il modulo e attendere almeno 30 secondi.</p>
<p>E' possibile verificare se l'aggiornamento ha avuto buon fine con il
modulo master tramite il display LCD che all'accensione deve
visualizzare la nuova versione del firmware.</p>
</div>
<div class="section" id="tramite-porta-usb">
<h3>Tramite porta USB<a class="headerlink" href="#tramite-porta-usb" title="Link a questa intestazione">¶</a></h3>
<p>Per l'aggiornamento del firmware è necessario avere a disposizione un file:</p>
<ul class="simple">
<li><p>FIRMWARE.BIN</p></li>
</ul>
<p>che dorà risiedere nella cartella corrente da dove si eseguiranno i comandi.</p>
<p>Collegare il modulo tramite cavo USB e dovrà essere l'unico
dispositivo USB collegato in modalità seriale.</p>
<p>Per il modulo master e impartire il comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">avrdude</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">p</span> <span class="n">atmega1284p</span> <span class="o">-</span><span class="n">c</span> <span class="n">arduino</span> <span class="o">-</span><span class="n">b</span> <span class="mi">115200</span> <span class="o">-</span><span class="n">D</span> <span class="o">-</span><span class="n">P</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">ttyUSB0</span> <span class="o">-</span><span class="n">U</span> <span class="n">flash</span><span class="p">:</span><span class="n">w</span><span class="p">:</span><span class="n">FIRMWARE</span><span class="o">.</span><span class="n">BIN</span><span class="p">:</span><span class="n">i</span>
</pre></div>
</div>
<p>Per gli altri moduli impartire il comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">avrdude</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">p</span> <span class="n">atmega644p</span> <span class="o">-</span><span class="n">c</span> <span class="n">arduino</span> <span class="o">-</span><span class="n">b</span> <span class="mi">115200</span> <span class="o">-</span><span class="n">D</span> <span class="o">-</span><span class="n">P</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">ttyUSB0</span> <span class="o">-</span><span class="n">U</span> <span class="n">flash</span><span class="p">:</span><span class="n">w</span><span class="p">:</span><span class="n">FIRMWARE</span><span class="o">.</span><span class="n">BIN</span><span class="p">:</span><span class="n">i</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="recupero-dati">
<h2>Recupero dati<a class="headerlink" href="#recupero-dati" title="Link a questa intestazione">¶</a></h2>
<p>Una volta recuperata la scheda Sdcard dal datalogger i dati possono
essere letti con apposito tool linea di comando.</p>
<p>Sono necessari almeno due file:</p>
<ul class="simple">
<li><p>AAAA_MM_GG.txt : AAAA = anno ; MM = mese ; GG = giorno</p></li>
<li><p>info.dat  : metadati</p></li>
</ul>
<p>Eseguire il seguente comando dalla stessa cartella contenete i file con i dati:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mqtt2bufr</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">f</span> <span class="n">AAAA_MM_GG</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">a</span> <span class="n">info</span><span class="o">.</span><span class="n">dat</span> <span class="o">|</span> <span class="n">bufr2mqtt</span> <span class="o">-</span><span class="n">h</span> <span class="n">rmap</span><span class="o">.</span><span class="n">cc</span> <span class="o">-</span><span class="n">u</span> <span class="s2">&quot;myusername&quot;</span> <span class="o">-</span><span class="n">P</span> <span class="s2">&quot;mypassword&quot;</span>
</pre></div>
</div>
<p>dove:</p>
<ul class="simple">
<li><p>myuser: nome utente RMAP</p></li>
<li><p>mypassword: password utente RMAP</p></li>
</ul>
</div>
<div class="section" id="remote-procedure-call">
<h2>Remote Procedure Call<a class="headerlink" href="#remote-procedure-call" title="Link a questa intestazione">¶</a></h2>
<p>I dati vengono salvati sul modulo master ed è quella SD card che deve
essere asportata dopo aver scollegato l'alimentazione.</p>
<p>Le remote procedure call permettono di far eseguire delle operazioni
dal datalogger da remoto.</p>
<div class="section" id="configure">
<h3>configure<a class="headerlink" href="#configure" title="Link a questa intestazione">¶</a></h3>
<p>La configurazione da remoto è possibile tramite tool a linea di comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">config_station</span> <span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">transport</span><span class="o">=</span><span class="n">mqtt</span>
</pre></div>
</div>
<p>Tramite un programma python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rmap</span> <span class="kn">import</span> <span class="n">jsonrpc</span>

<span class="n">MQTT_HOST</span> <span class="o">=</span> <span class="s1">&#39;rmap.cc&#39;</span>
<span class="n">MQTT_RPCTOPIC</span> <span class="o">=</span> <span class="s1">&#39;rpc/myuser/1112345,4412345/fixed/&#39;</span><span class="p">)</span>
<span class="n">MQTT_USERNAME</span> <span class="o">=</span> <span class="s1">&#39;myuser&#39;</span>
<span class="n">MQTT_PASSWORD</span> <span class="o">=</span> <span class="s1">&#39;mypassword&#39;</span>

<span class="k">with</span> <span class="n">jsonrpc</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span> <span class="n">jsonrpc</span><span class="o">.</span><span class="n">JsonRpc20</span><span class="p">(),</span>\
          <span class="n">jsonrpc</span><span class="o">.</span><span class="n">TransportMQTT</span><span class="p">(</span>
              <span class="n">host</span><span class="o">=</span><span class="n">MQTT_HOST</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">MQTT_USERNAME</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="n">MQTT_PASSWORD</span><span class="p">,</span>
              <span class="n">rpctopic</span><span class="o">=</span><span class="n">MQTT_RPCTOPIC</span><span class="p">,</span>
              <span class="n">logfunc</span><span class="o">=</span><span class="n">jsonrpc</span><span class="o">.</span><span class="n">log_stdout</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span> <span class="k">as</span> <span class="n">rpcproxy</span> <span class="p">:</span>

          <span class="n">rpcproxy</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
          <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
          <span class="c1">#rpcproxy.configure(mqttrootpath=&#39;report/myuser/1112345,4412345/fixed/&#39;)</span>
          <span class="c1">#rpcproxy.configure(mqttmaintpath=&#39;maint/myuser/1112345,4412345/fixed/&#39;)</span>
          <span class="c1">#rpcproxy.configure(mqttrpcpath=&#39;rpc/myuser/1165625,4485892/fixed/&#39;)</span>
          <span class="n">rpcproxy</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">mqttsampletime</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>
          <span class="n">rpcproxy</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="n">rpcproxy</span><span class="o">.</span><span class="n">reboot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="reboot">
<h3>reboot<a class="headerlink" href="#reboot" title="Link a questa intestazione">¶</a></h3>
<p>Il reboot del modulo master è possibile tramite tool a linea di comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">rpc_mqtt_reboot</span> <span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span>
</pre></div>
</div>
<p>oppure tramite un programma python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rmap</span> <span class="kn">import</span> <span class="n">jsonrpc</span>

<span class="n">MQTT_HOST</span> <span class="o">=</span> <span class="s1">&#39;rmap.cc&#39;</span>
<span class="n">MQTT_RPCTOPIC</span> <span class="o">=</span> <span class="s1">&#39;rpc/myuser/1112345,4412345/fixed/&#39;</span><span class="p">)</span>
<span class="n">MQTT_USERNAME</span> <span class="o">=</span> <span class="s1">&#39;myuser&#39;</span>
<span class="n">MQTT_PASSWORD</span> <span class="o">=</span> <span class="s1">&#39;mypassword&#39;</span>

<span class="k">with</span> <span class="n">jsonrpc</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span> <span class="n">jsonrpc</span><span class="o">.</span><span class="n">JsonRpc20</span><span class="p">(),</span>\
          <span class="n">jsonrpc</span><span class="o">.</span><span class="n">TransportMQTT</span><span class="p">(</span>
              <span class="n">host</span><span class="o">=</span><span class="n">MQTT_HOST</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">MQTT_USERNAME</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="n">MQTT_PASSWORD</span><span class="p">,</span>
              <span class="n">rpctopic</span><span class="o">=</span><span class="n">MQTT_RPCTOPIC</span><span class="p">,</span>
              <span class="n">logfunc</span><span class="o">=</span><span class="n">jsonrpc</span><span class="o">.</span><span class="n">log_stdout</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span> <span class="k">as</span> <span class="n">rpcproxy</span> <span class="p">:</span>

          <span class="n">rpcproxy</span><span class="o">.</span><span class="n">reboot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="recovery">
<h3>recovery<a class="headerlink" href="#recovery" title="Link a questa intestazione">¶</a></h3>
<p>Il recupero dei dati salvati su SDcard è possibile tramite tool a linea di comando
specificando la data iniziale dei dati da recuperare (fino a data e ora corrente):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">rpc_mqtt_recovery</span> <span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;myuser&quot;</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=</span><span class="s2">&quot;myslug&quot;</span> <span class="o">--</span><span class="n">datetime</span><span class="o">=</span><span class="s2">&quot;2022-02-16T12:00&quot;</span>
</pre></div>
</div>
<p>oppure tramite un programma python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rmap</span> <span class="kn">import</span> <span class="n">jsonrpc</span>

<span class="n">MQTT_HOST</span> <span class="o">=</span> <span class="s1">&#39;rmap.cc&#39;</span>
<span class="n">MQTT_RPCTOPIC</span> <span class="o">=</span> <span class="s1">&#39;rpc/myuser/1112345,4412345/fixed/&#39;</span><span class="p">)</span>
<span class="n">MQTT_USERNAME</span> <span class="o">=</span> <span class="s1">&#39;myuser&#39;</span>
<span class="n">MQTT_PASSWORD</span> <span class="o">=</span> <span class="s1">&#39;mypassword&#39;</span>
<span class="n">DATETIMESTART</span><span class="o">=</span><span class="p">[</span><span class="mi">2021</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

<span class="k">with</span> <span class="n">jsonrpc</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span> <span class="n">jsonrpc</span><span class="o">.</span><span class="n">JsonRpc20</span><span class="p">(),</span>\
          <span class="n">jsonrpc</span><span class="o">.</span><span class="n">TransportMQTT</span><span class="p">(</span>
              <span class="n">host</span><span class="o">=</span><span class="n">MQTT_HOST</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">MQTT_USERNAME</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="n">MQTT_PASSWORD</span><span class="p">,</span>
              <span class="n">rpctopic</span><span class="o">=</span><span class="n">MQTT_RPCTOPIC</span><span class="p">,</span>
              <span class="n">logfunc</span><span class="o">=</span><span class="n">jsonrpc</span><span class="o">.</span><span class="n">log_stdout</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span> <span class="k">as</span> <span class="n">rpcproxy</span> <span class="p">:</span>

          <span class="n">rpcproxy</span><span class="o">.</span><span class="n">recovery</span><span class="p">(</span><span class="n">dts</span><span class="o">=</span><span class="n">DATETIMESTART</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="temporizzazioni">
<h2>Temporizzazioni<a class="headerlink" href="#temporizzazioni" title="Link a questa intestazione">¶</a></h2>
<p>Da scrivere</p>
</div>
<div class="section" id="salvataggio-e-invio-dati">
<h2>Salvataggio e invio dati<a class="headerlink" href="#salvataggio-e-invio-dati" title="Link a questa intestazione">¶</a></h2>
<p>Da scrivere</p>
</div>
<div class="section" id="diagnostica">
<h2>Diagnostica<a class="headerlink" href="#diagnostica" title="Link a questa intestazione">¶</a></h2>
<div class="section" id="tramite-display">
<h3>tramite DISPLAY<a class="headerlink" href="#tramite-display" title="Link a questa intestazione">¶</a></h3>
<div class="section" id="messaggi-all-accensione">
<h4>Messaggi all'accensione<a class="headerlink" href="#messaggi-all-accensione" title="Link a questa intestazione">¶</a></h4>
<p><strong>Prima schermata attesa configurazione:</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Wait configuration</p></td>
</tr>
<tr class="row-even"><td></td>
</tr>
<tr class="row-odd"><td></td>
</tr>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<p>E' stato inserito il ponticello per la configurazione e la stazione rimane in attesa;
Per attivare la stazioen bisogna rimuovere il ponticello.</p>
<p><strong>Prima schermata, tipo e versioni:</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>---- www.rmap.cc ----</p></td>
</tr>
<tr class="row-even"><td><p>Stima station</p></td>
</tr>
<tr class="row-odd"><td><p>&lt;station type&gt; V: &lt;firmware version&gt;</p></td>
</tr>
<tr class="row-even"><td><p>Configuration V: &lt;configuration version&gt;</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><strong>station type</strong>: tipo di stazione definito a tempo compilazione</p></li>
<li><p><strong>firmware version</strong>: versione del firmware</p></li>
<li><p><strong>configuration version</strong>: versione della configurazione per compatibilità</p></li>
</ul>
<p><strong>Seconda schermata, dati costanti di stazione:</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>&lt;bcode1&gt;: &lt;constant station data 1&gt;</p></td>
</tr>
<tr class="row-even"><td></td>
</tr>
<tr class="row-odd"><td><p>&lt;bcode2&gt;: &lt;constant station data 2&gt;</p></td>
</tr>
<tr class="row-even"><td></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><strong>bcode1</strong>: codice della prima variabile come da tabella B; Get the full table from: <a class="reference external" href="https://github.com/ARPA-SIMC/dballe/blob/master/tables/dballe.txt">https://github.com/ARPA-SIMC/dballe/blob/master/tables/dballe.txt</a></p></li>
<li><p><strong>constant station data 1</strong>: value 1</p></li>
<li><p><strong>bcode2</strong>: codice della secondavariabile come da tabella B; Get the full table from: <a class="reference external" href="https://github.com/ARPA-SIMC/dballe/blob/master/tables/dballe.txt">https://github.com/ARPA-SIMC/dballe/blob/master/tables/dballe.txt</a></p></li>
<li><p><strong>constant station data 2</strong>: value 2</p></li>
</ul>
<p><strong>Terza schermata, stato sensori e metadati di configurazione:</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Sensor:</p></td>
<td><p>&lt;sensor ok&gt;/&lt;sensor total&gt; &lt;OKKO&gt;</p></td>
</tr>
<tr class="row-even"><td><p>user</p></td>
<td><p>&lt;user&gt;</p></td>
</tr>
<tr class="row-odd"><td><p>station</p></td>
<td><p>&lt;station&gt;</p></td>
</tr>
<tr class="row-even"><td><p>board</p></td>
<td><p>&lt;board&gt;</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><strong>sensor ok</strong>: numero sensori rilevati</p></li>
<li><p><strong>sensor total</strong>: numero tolale sensori previsti</p></li>
<li><p><strong>OKKO</strong>: stato riassuntivo dei sensori ( OK: tutto bene; KO: malfunzionamento)</p></li>
<li><p><strong>user</strong>: mqtt username</p></li>
<li><p><strong>station</strong>: station slug</p></li>
<li><p><strong>board</strong>: board slug</p></li>
</ul>
<p><strong>Quarta schermata, stato sensori e metadati di configurazione:</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Sensor:</p></td>
<td><p>&lt;sensor ok&gt;/&lt;sensor total&gt; &lt;OKKO&gt;</p></td>
</tr>
<tr class="row-even"><td><p>server</p></td>
<td><p>&lt;mqtt server&gt;</p></td>
</tr>
<tr class="row-odd"><td><p>ntp</p></td>
<td><p>&lt;ntp server&gt;</p></td>
</tr>
<tr class="row-even"><td><p>board</p></td>
<td><p>&lt;board&gt;</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><strong>sensor ok</strong>: numero sensori rilevati</p></li>
<li><p><strong>sensor total</strong>: numero tolale sensori previsti</p></li>
<li><p><strong>OKKO</strong>: stato riassuntivo dei sensori ( OK: tutto bene; KO: malfunzionamento)</p></li>
<li><p><strong>server</strong>: mqtt server name</p></li>
<li><p><strong>ntp</strong>: ntp server name</p></li>
<li><p><strong>board</strong>: board slug</p></li>
</ul>
<p><strong>Messaggi visualizzati nella quarta riga del display:</strong></p>
<ul class="simple">
<li><p><strong>SD Card: KO</strong>: c'è un problema nell'utilizzo dell'SDcard</p></li>
<li><p><strong>NEW Firmware loaded</strong>: è stato appena affettuato un aggiornamento del firmware e il firmware è stato rinominato sull'SDcard</p></li>
</ul>
</div>
<div class="section" id="messaggi-durante-il-funzionamento">
<h4>Messaggi durante il funzionamento<a class="headerlink" href="#messaggi-durante-il-funzionamento" title="Link a questa intestazione">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 26%" />
<col style="width: 28%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>&lt;SN&gt;:</p></td>
<td><p>&lt;h&gt;:&lt;m&gt;:&lt;s&gt;</p></td>
<td colspan="2"><p>rf:&lt;rssi&gt;/&lt;ber&gt; &lt;LCD: KO&gt;</p></td>
</tr>
<tr class="row-even"><td><p>&lt;RT&gt;</p></td>
<td><p>temp</p></td>
<td><p>humidity</p></td>
<td><p>precipitation</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>battery</p></td>
<td><p>charge</p></td>
<td><p>solar panel</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>SD&lt;SN&gt;&lt;SOKKO&gt;</p></td>
<td><p>MQ&lt;MN&gt;&lt;MOKKO&gt;</p></td>
<td><p>FA&lt;FN&gt;&lt;FOKKO&gt;</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><strong>SN</strong>: orario prossima elaborazione: S inizio periodo report; N fine periodo report</p></li>
<li><p><strong>h</strong>: ora GMT</p></li>
<li><p><strong>m</strong>: minuti</p></li>
<li><p><strong>s</strong>: secondi</p></li>
<li><p><strong>rssi</strong>: qualità segnale radio; vedi tabella sotto (oppure KO in caso di errore)</p></li>
<li><p><strong>ber</strong>:  qualità segnale radio; vedi tabella sotto (oppure KO in caso di errore)</p></li>
<li><p><strong>LCD</strong>: KO: messaggio se l'LCD ha avuto errori ed è stato reinizializzato</p></li>
</ul>
<p>ultimi dati acquisiti:</p>
<ul class="simple">
<li><p><strong>RT</strong>: i dati visualizzati si riferiscono a: T test; R report</p></li>
<li><p><strong>temp</strong>: temperatura e unità di misura</p></li>
<li><p><strong>humidity</strong>: umidità e unità di misura</p></li>
<li><p><strong>precipitation</strong>: precipitazione e unità di misura</p></li>
<li><p><strong>battery</strong>: tensione batteria e unità di misura</p></li>
<li><p><strong>charge</strong>: carica batteria e unità di misura</p></li>
<li><p><strong>solar</strong> panel: tensione pannello solare e unità di misura</p></li>
</ul>
<p>ultime oprazioni eseguite:</p>
<ul class="simple">
<li><p><strong>SN</strong>: numero di dati scritti su SDcard</p></li>
<li><p><strong>SOKKO</strong>: stato riassuntivo scrittura SDcard ( OK: tutto bene; KO: malfunzionamento)</p></li>
<li><p><strong>MN</strong>: numero di dati inviati al broker MQTT</p></li>
<li><p><strong>MOKKO</strong>: stato riassuntivo invio dati MQTT ( OK: tutto bene; KO: malfunzionamento)</p></li>
<li><p><strong>FN</strong>: numero di dati con acquisizione fallita dai sensori</p></li>
<li><p><strong>FOKKO</strong>: stato riassuntivo acquisizione dati dai sensori ( OK: tutto bene; KO: malfunzionamento)</p></li>
</ul>
<p><strong>rssi</strong>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>RSI</p></th>
<th class="head"><p>value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>-115 dBm or less</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>-111 dBm</p></td>
</tr>
<tr class="row-even"><td><p>2 to 30</p></td>
<td><p>-110 dBm to -54 dBm</p></td>
</tr>
<tr class="row-odd"><td><p>31</p></td>
<td><p>-52 dBm or greater</p></td>
</tr>
<tr class="row-even"><td><p>99</p></td>
<td><p>not known or not detectable</p></td>
</tr>
</tbody>
</table>
<p>dBm is short for decibel per milliwatt and is a common unit for signal
strength. -115 dbm is the lowest signal strength value and would
typically mean that the station is on a network blind spot. -111 dBm
is also a bad number for signal reception. I was able to connect to a
network at -70 dBm. Here is a handy list of dBm levels and what they
mean:</p>
<p>RSSI Condition:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>dBm</p></th>
<th class="head"><p>mean</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-109</p></td>
<td><p>Marginal</p></td>
</tr>
<tr class="row-odd"><td><p>-107</p></td>
<td><p>Marginal</p></td>
</tr>
<tr class="row-even"><td><p>-105</p></td>
<td><p>Marginal</p></td>
</tr>
<tr class="row-odd"><td><p>-103</p></td>
<td><p>Marginal</p></td>
</tr>
<tr class="row-even"><td><p>-101</p></td>
<td><p>Marginal</p></td>
</tr>
<tr class="row-odd"><td><p>-99</p></td>
<td><p>Marginal</p></td>
</tr>
<tr class="row-even"><td><p>-97</p></td>
<td><p>Marginal</p></td>
</tr>
<tr class="row-odd"><td><p>-95</p></td>
<td><p>Marginal</p></td>
</tr>
<tr class="row-even"><td><p>-93</p></td>
<td><p>OK</p></td>
</tr>
<tr class="row-odd"><td><p>-91</p></td>
<td><p>OK</p></td>
</tr>
<tr class="row-even"><td><p>-89</p></td>
<td><p>OK</p></td>
</tr>
<tr class="row-odd"><td><p>-87</p></td>
<td><p>OK</p></td>
</tr>
<tr class="row-even"><td><p>-85</p></td>
<td><p>OK</p></td>
</tr>
<tr class="row-odd"><td><p>-83</p></td>
<td><p>Good</p></td>
</tr>
<tr class="row-even"><td><p>-81</p></td>
<td><p>Good</p></td>
</tr>
<tr class="row-odd"><td><p>-79</p></td>
<td><p>Good</p></td>
</tr>
<tr class="row-even"><td><p>-77</p></td>
<td><p>Good</p></td>
</tr>
<tr class="row-odd"><td><p>-75</p></td>
<td><p>Good</p></td>
</tr>
<tr class="row-even"><td><p>-73</p></td>
<td><p>Excellent</p></td>
</tr>
<tr class="row-odd"><td><p>-71</p></td>
<td><p>Excellent</p></td>
</tr>
<tr class="row-even"><td><p>-69</p></td>
<td><p>Excellent</p></td>
</tr>
<tr class="row-odd"><td><p>-67</p></td>
<td><p>Excellent</p></td>
</tr>
<tr class="row-even"><td><p>-65</p></td>
<td><p>Excellent</p></td>
</tr>
<tr class="row-odd"><td><p>-63</p></td>
<td><p>Excellent</p></td>
</tr>
<tr class="row-even"><td><p>-61</p></td>
<td><p>Excellent</p></td>
</tr>
<tr class="row-odd"><td><p>-59</p></td>
<td><p>Excellent</p></td>
</tr>
<tr class="row-even"><td><p>-57</p></td>
<td><p>Excellent</p></td>
</tr>
<tr class="row-odd"><td><p>-55</p></td>
<td><p>Excellent</p></td>
</tr>
<tr class="row-even"><td><p>-53</p></td>
<td><p>Excellent</p></td>
</tr>
</tbody>
</table>
<p>If you will compare this to smartphones, marginal is one bar, OK is
two bars, good is three bars and excellent is four bars.</p>
<p><strong>ber</strong> (bit error rate):</p>
<p>In digital transmission, the number of bit errors is the number of
received bits of a data stream over a communication channel that have
been altered due to noise, interference, distortion or bit
synchronization errors.</p>
<p>The bit error rate (BER) is the number of bit errors per unit
time. The bit error ratio (also BER) is the number of bit errors
divided by the total number of transferred bits during a studied time
interval. Bit error ratio is a unitless performance measure, often
expressed as a percentage</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>bear</p></th>
<th class="head"><p>mean</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>BER  &lt; 0.2%</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>0.2%  &lt; BER &lt; 0.4%</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>0.4%  &lt; BER &lt; 0.8%</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>0.8%  &lt; BER &lt; 1.6%</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>1.6%  &lt; BER &lt; 3.2%</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>3.2%  &lt; BER &lt; 6.4%</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>6.4%  &lt; BER &lt; 12.8%</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>12.8% &lt; BER</p></td>
</tr>
<tr class="row-even"><td><p>99</p></td>
<td><p>not known or not detectable</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="tramite-monitoraggio-mqtt">
<h3>Tramite monitoraggio MQTT<a class="headerlink" href="#tramite-monitoraggio-mqtt" title="Link a questa intestazione">¶</a></h3>
<p>Questo monitoraggio permette di visualizzare tutti i messaggi che la
stazione invia al server e che il server ha ricevuto correttamente:</p>
<blockquote>
<div><p>rmap-configure --mqtt_monitor --station_slug=&quot;myslug&quot; --user=&quot;myuser&quot;</p>
</div></blockquote>
<p>i dati vengo visualizzati così come pubblicati e anche decodificati e
interpretati.</p>
</div>
<div class="section" id="tramite-porta-seriale">
<h3>Tramite porta seriale<a class="headerlink" href="#tramite-porta-seriale" title="Link a questa intestazione">¶</a></h3>
<p>Questo monitoraggio permette di visualizzare tutti i messaggi di
logging che la stazione invia sulla porta seriale tramite il
connettore USB:</p>
<blockquote>
<div><p>rmap-configure --serial_monitor --station_slug=&quot;myslug&quot; --user=&quot;myuser&quot;</p>
</div></blockquote>
<p>Ogni messaggio è composto da:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 60%" />
<col style="width: 26%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>data</p></td>
<td><p>importanza del messaggio</p></td>
<td><p>messaggio</p></td>
</tr>
</tbody>
</table>
<p>La data e ora sono in GMT.</p>
<p>La importanza del messaggio è rappresentata da una lettera da interpretare come da legenda:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 8%" />
<col style="width: 92%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>F</p></td>
<td><p>fatal errors</p></td>
</tr>
<tr class="row-even"><td><p>E</p></td>
<td><p>all errors</p></td>
</tr>
<tr class="row-odd"><td><p>W</p></td>
<td><p>errors, and warnings</p></td>
</tr>
<tr class="row-even"><td><p>N</p></td>
<td><p>errors, warnings and notices</p></td>
</tr>
<tr class="row-odd"><td><p>T</p></td>
<td><p>errors, warnings, notices &amp; traces</p></td>
</tr>
<tr class="row-even"><td><p>V</p></td>
<td><p>all</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id4">
<h3>Tramite SDcard<a class="headerlink" href="#id4" title="Link a questa intestazione">¶</a></h3>
<p>Per effettuare questo monitoraggio occorre utilizzare un firmware
appositamente compilato con questa funzione inclusa; il firmware
utilizzati normalmente in produzione non lo permettono.</p>
<p>Avviata la stazione la stessa messaggistica ottenuta dal monitoraggio
tramite porta seriale verrà scritta in un file sulla SDcard con
postfisso &quot;.log&quot;.  Il file sarà leggibile da PC una volta recuperata
la SDcard.</p>
</div>
<div class="section" id="diagnostica-del-bus-i2c">
<h3>Diagnostica del bus I2C<a class="headerlink" href="#diagnostica-del-bus-i2c" title="Link a questa intestazione">¶</a></h3>
<p>Il il firmware sensor_config_menu_sdcard permette una disgnostica del bus I2C
ma solo se connesso come dispositivo di output a un monito della porta seriale (USB).</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../../stima_v4/stima_v4.html" class="btn btn-neutral float-right" title="Stima V4" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../stimacode.html" class="btn btn-neutral float-left" title="Documentazione del codice" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, CC BY-SA 4.0, Arpae https://www.arpae.it.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>