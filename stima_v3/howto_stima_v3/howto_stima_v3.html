

<!DOCTYPE html>
<html class="writer-html5" lang="it" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Howto per Stima versione 3 &mdash; RMAP e Stima 3 documentazione</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Indice" href="../../genindex.html" />
    <link rel="search" title="Cerca" href="../../search.html" />
    <link rel="next" title="Guida per lo sviluppo software" href="../development_guide/development_guide.html" />
    <link rel="prev" title="Stima V3" href="../stima_v3.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> RMAP e Stima
          

          
            
            <img src="../../_static/logo_stima.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../rmap_rfc/rfc.html">RFC rmap versione 3.3</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../stima_v3.html">Stima V3</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Howto per Stima versione 3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#caratteristiche-hardware-delle-singole-board">Caratteristiche hardware delle singole board</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#stima-core-644-e-stima-core-1284">Stima core+644 e Stima core+1284</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stima-i2c-base">Stima I2C-Base</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stima-i2c-digital">Stima I2C-Digital</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stima-i2c-rtc">Stima I2C-RTC</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stima-i2c-ft232rl">Stima I2C-FT232RL</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stima-sd-card">Stima SD-Card</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stima-sim800c-power">Stima SIM800C Power</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stima-sim800c-module">Stima SIM800C Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stima-i2c-hub">Stima I2C-HUB</a></li>
<li class="toctree-l4"><a class="reference internal" href="#regolatore-di-tensione-e-carica-della-batteria-con-bus-i2c-digitecopower">Regolatore di tensione e carica della batteria con bus I<sup>2</sup>C DigitecoPower</a></li>
<li class="toctree-l4"><a class="reference internal" href="#display-lcd-20x4-con-interfaccia-i2c">Display LCD 20x4 con interfaccia I2C</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configurazioni-hardware-dei-moduli-stima">Configurazioni hardware dei moduli Stima</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#modulo-stima-ethernet-master">Modulo Stima Ethernet (master)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modulo-stima-gsm-gprs-master">Modulo Stima GSM/GPRS (master)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modulo-stima-passivo-master">Modulo Stima Passivo (master)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modulo-stima-i2c-th">Modulo Stima I2C-TH</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modulo-stima-i2c-rain">Modulo Stima I2C-Rain</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modulo-stima-sensor-config">Modulo Stima sensor_config</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configurazioni-software-dei-moduli-stima">Configurazioni software dei moduli Stima</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installazione-del-software-per-la-configurazione">Installazione del software per la configurazione</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installazione-del-software-per-la-compilazione-dei-firmware">Installazione del software per la compilazione dei firmware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installazione-dei-sorgenti-dei-firmware-e-dei-progetti-kicad">Installazione dei sorgenti dei firmware e dei progetti kicad</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modulo-stima-gsm-gprs">Modulo Stima GSM/GPRS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modulo-stima-ethernet">Modulo Stima Ethernet</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modulo-stima-passive">Modulo Stima Passive</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Modulo Stima I2C-TH</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">Modulo Stima I2C-Rain</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#compilazione-e-caricamento-del-bootloader-digitecoboot">Compilazione e caricamento del bootloader Digitecoboot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compilazione-del-firmware-in-formato-binario">Compilazione del firmware in formato binario</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upload-del-firmware-tramite-micro-sd-card-attraverso-digitecoboot">Upload del firmware tramite micro SD-Card attraverso Digitecoboot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configurazione-moduli-e-sensori">Configurazione moduli e sensori</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assemblaggio-stazione-stima">Assemblaggio stazione Stima</a></li>
<li class="toctree-l3"><a class="reference internal" href="#appendici">Appendici</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#elenco-pin-utilizzati">Elenco PIN utilizzati</a></li>
<li class="toctree-l4"><a class="reference internal" href="#elenco-indirizzi-i2c">Elenco indirizzi I2C</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../development_guide/development_guide.html">Guida per lo sviluppo software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stimacode.html">Documentazione del codice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_manual/user_manual.html">Manuale Utente</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stima_v4/stima_v4.html">Stima V4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stima_wifi/stima_wifi_howto.html">Stima-wifi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../server_rmap/server_rmap.html">Server RMAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../videotutorial/videotutorial.html">Videotutorial</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">RMAP e Stima</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../stima_v3.html">Stima V3</a> &raquo;</li>
        
      <li>Howto per Stima versione 3</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/stima_v3/howto_stima_v3/howto_stima_v3.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="howto-per-stima-versione-3">
<h1>Howto per Stima versione 3<a class="headerlink" href="#howto-per-stima-versione-3" title="Link a questa intestazione">¶</a></h1>
<div class="section" id="caratteristiche-hardware-delle-singole-board">
<h2>Caratteristiche hardware delle singole board<a class="headerlink" href="#caratteristiche-hardware-delle-singole-board" title="Link a questa intestazione">¶</a></h2>
<div class="section" id="stima-core-644-e-stima-core-1284">
<h3>Stima core+644 e Stima core+1284<a class="headerlink" href="#stima-core-644-e-stima-core-1284" title="Link a questa intestazione">¶</a></h3>
<p><a class="reference internal" href="../../_images/100000000000009E000000ACAE9B9D2F445B8061.jpg"><img alt="image0" src="../../_images/100000000000009E000000ACAE9B9D2F445B8061.jpg" style="width: 3.679cm; height: 3.999cm;" /></a><a class="reference internal" href="../../_images/100000000000009A000000AEEEAB07A37000F6DA.jpg"><img alt="image1" src="../../_images/100000000000009A000000AEEEAB07A37000F6DA.jpg" style="width: 3.526cm; height: 3.999cm;" /></a></p>
<p>Le due board Stima core+644 e Stima core+1284 sono realizzate sul
medesimo circuito stampato, appositamente progettato per accogliere
indifferentemente il microcontrollore ATmega644 o ATmega1284 nelle
configurazioni a 8 MHz a 3.3V o 16 MHz a 5V.</p>
<p>Per selezionare la corretta tensione di alimentazione sul
microcontrollore, è sufficiente un punto di saldatura sullo switch delle
piste del circuito stampato della scheda, a patto di aver selezionato il
giusto quarzo in funzione della tensione di alimentazione.</p>
<p>Entrambe le board sono realizzate sullo standard UPIN-27.</p>
<p>Gli schemi elettrici realizzati in KiCad sono disponibili nella cartella:</p>
<p>kicad/r-map_v3/Microduino_Core+_DE</p>
</div>
<div class="section" id="stima-i2c-base">
<h3>Stima I2C-Base<a class="headerlink" href="#stima-i2c-base" title="Link a questa intestazione">¶</a></h3>
<p><a class="reference internal" href="../../_images/100000000000009A000000ADE4C08B4E60589267.jpg"><img alt="image2" src="../../_images/100000000000009A000000ADE4C08B4E60589267.jpg" style="width: 3.56cm; height: 3.999cm;" /></a><a class="reference internal" href="../../_images/100000000000009D000000AD4DC00E68B401E996.jpg"><img alt="image3" src="../../_images/100000000000009D000000AD4DC00E68B401E996.jpg" style="width: 3.621cm; height: 3.999cm;" /></a></p>
<p>Basato sullo standard UPIN-27 e quindi impilabile come un normalissimo
modulo Microduino, è stato progettato per far fronte alle necessità di
alimentazione e collegamento su bus I<sup>2</sup>C dell’intero stack.</p>
<p>È dotato di un connettore a quattro pin, posto nella parte frontale del
modulo (l’unico libero dal connettore UPIN-27) la cui funzione duale è
quella di alimentare lo stack e di fornire il collegamento su bus
I<sup>2</sup>C a tutti i moduli ad esso collegati.</p>
<p>Per la corretta configurazione hardware di tale modulo, è necessario
effettuare un punto di saldatura sullo switch delle piste del circuito
stampato atto a selezionare l’alimentazione (3.3V o 5V) e la
corrispondente tensione di alimentazione del bus I<sup>2</sup>C sullo
stack di moduli nel quale verrà installato.</p>
<p>Inoltre, tale switch presenta un’ulteriore via che prevede
l’abilitazione dell’alimentazione sul bus I<sup>2</sup>C controllabile
attraverso un pin di un microcontrollore impilato nello stack: funzione
utile nel caso di test o di configurazione di particolari sensori
I<sup>2</sup>C.</p>
<p>Si specifica che il connettore a quattro pin presenta clip di
collegamento elettriche in materiale anti ossidante in grado di
garantire un perfetto contatto elettrico nel corso degli anni. Inoltre è
realizzato in modo tale da non permettere il distacco accidentale del
cavo, assicurando la comunicazione. Altra peculiarità è quella di poter
essere innestato in un unico verso evitando l’inversione di polarità di
alimentazione e di collegamento del bus.</p>
<p>Tale board, inoltre, presenta due pin cortocircuitabili temporaneamente
attraverso un jumper atto a consentire la configurazione della stazione
attraverso porta seriale.</p>
<p>A causa dell’ingombro in altezza maggiorato rispetto ad una board
standard dovuto al connettore a quattro pin, tale scheda è impilabile
solamente attraverso l’adozione di due file di pin del tipo UPIN-27.</p>
<p>Gli schemi elettrici realizzati in KiCad sono disponibili nella cartella:</p>
<p>kicad/r-map_v3/Microduino_BASE_DE</p>
</div>
<div class="section" id="stima-i2c-digital">
<h3>Stima I2C-Digital<a class="headerlink" href="#stima-i2c-digital" title="Link a questa intestazione">¶</a></h3>
<p><a class="reference internal" href="../../_images/10000000000000A5000000AD53D182DF34A4940D.jpg"><img alt="image4" src="../../_images/10000000000000A5000000AD53D182DF34A4940D.jpg" style="width: 3.801cm; height: 4.001cm;" /></a><a class="reference internal" href="../../_images/100000000000009E000000ADEB419933E3C33867.jpg"><img alt="image5" src="../../_images/100000000000009E000000ADEB419933E3C33867.jpg" style="width: 3.641cm; height: 4.001cm;" /></a></p>
<p>Il modulo in oggetto, realizza le funzioni di input o output di segnali
digitali. Basato sullo standard UPIN-27, sarà dotato di un connettore a
quattro pin del tipo usato nel modulo Stima I2C-Base ma adoperato per
l’input o l’output di segnali digitali.</p>
<p>In particolare, sono presenti tre pin corrispondenti alle tre linee di
interrupt fisiche fornite dai microcontrollori ed un pin di massa,
comune alle tre linee.</p>
<p>A causa dell’ingombro in altezza maggiorato rispetto ad una board
standard dovuto al connettore a quattro pin, tale scheda è impilabile
solamente attraverso l’adozione di due file di pin del tipo UPIN-27.</p>
<p>Gli schemi elettrici realizzati in KiCad sono disponibili nella cartella:</p>
<p>kicad/r-map_v3/Microduino_DIGITALE_DE</p>
</div>
<div class="section" id="stima-i2c-rtc">
<h3>Stima I2C-RTC<a class="headerlink" href="#stima-i2c-rtc" title="Link a questa intestazione">¶</a></h3>
<p><a class="reference internal" href="../../_images/100000000000009C000000AD3AA0095948111B89.jpg"><img alt="image6" src="../../_images/100000000000009C000000AD3AA0095948111B89.jpg" style="width: 3.602cm; height: 4.001cm;" /></a><a class="reference internal" href="../../_images/100000000000009C000000ADAF9C13A96CAA663F.jpg"><img alt="image7" src="../../_images/100000000000009C000000ADAF9C13A96CAA663F.jpg" style="width: 3.6cm; height: 4.001cm;" /></a></p>
<p>Tale modulo, compatibile con lo standard UPIN-27, assolve le funzioni di
mantenimento della data ed ora nel tempo, attraverso l’adozione del Real
Time Clock (RTC), interfacciato al microcontrollore attraverso bus
I<sup>2</sup>C.</p>
<p>Per la corretta configurazione hardware di tale modulo, è necessario
effettuare un punto di saldatura sullo switch delle piste del circuito
stampato atto a selezionare l’alimentazione (3.3V o 5V).</p>
<p>Inoltre, per garantire il funzionamento dello stesso nel caso di
distacco dell’alimentazione principale, è provvisto di un super
condensatore in grado di fornire energia sufficiente a garantirne il
funzionamento per alcune ore.</p>
<p>Un’ulteriore caratteristica del modulo, è quella di poter generare un
segnale a frequenza costante e programmabile via software, che potrà
essere convogliata su una delle tre linee digitali ad interrupt del
microcontrollore, utilizzabile come segnale di risveglio per il
microcontrollore impostato in risparmio energetico profondo, in modo
tale da poter ridurre i consumi energetici dell’intera stazione.</p>
<p>Gli schemi elettrici realizzati in KiCad sono disponibili nella cartella:</p>
<p>kicad/r-map_v3/Microduino_RTC_DE</p>
</div>
<div class="section" id="stima-i2c-ft232rl">
<h3>Stima I2C-FT232RL<a class="headerlink" href="#stima-i2c-ft232rl" title="Link a questa intestazione">¶</a></h3>
<p><a class="reference internal" href="../../_images/100000000000009C000000AD7308EC30CDDC5C93.jpg"><img alt="image8" src="../../_images/100000000000009C000000AD7308EC30CDDC5C93.jpg" style="width: 3.602cm; height: 4.001cm;" /></a><a class="reference internal" href="../../_images/1000000000000099000000AD361FB05CE16B3BAD.jpg"><img alt="image9" src="../../_images/1000000000000099000000AD361FB05CE16B3BAD.jpg" style="width: 3.54cm; height: 4.001cm;" /></a></p>
<p>Il modulo in questione, permette di collegare la porta seriale zero del
microcontrollore ad un bus USB (ad esempio, quello di un computer) in
modo tale da poter facilmente instaurare una comunicazione seriale con
il microcontrollore. Tale metodo di comunicazione risulta comodo sia nel
caso di upload del firmware che nel caso di configurazione della
stazione.</p>
<p>Inoltre, l’integrato FT232RL è in grado di generare una tensione a 3.3V
a bassa potenza in grado di alimentare direttamente il microcontrollore
nella configurazione 3.3V e 8MHz, permettendone la programmazione dello
stesso quando non è alimentato da una fonte di alimentazione esterna.</p>
<p>Tale tensione può o meno essere fornita al microcontrollore effettuando
o meno una saldatura sul circuito stampato della board. L’intero modulo
è realizzato secondo lo standard UPIN-27.</p>
<p>Gli schemi elettrici realizzati in KiCad sono disponibili nella cartella:</p>
<p>kicad/r-map_v3/Microduino_FT232R_DE</p>
</div>
<div class="section" id="stima-sd-card">
<h3>Stima SD-Card<a class="headerlink" href="#stima-sd-card" title="Link a questa intestazione">¶</a></h3>
<p><a class="reference internal" href="../../_images/100000000000009F000000AD0C6720AFF04FBC92.jpg"><img alt="image10" src="../../_images/100000000000009F000000AD0C6720AFF04FBC92.jpg" style="width: 3.66cm; height: 4.001cm;" /></a><a class="reference internal" href="../../_images/100000000000009C000000ADBC133CD18BF49B67.jpg"><img alt="image11" src="../../_images/100000000000009C000000ADBC133CD18BF49B67.jpg" style="width: 3.602cm; height: 4.001cm;" /></a></p>
<p>Tale board permette il collegamento di una micro SD-Card al
microcontrollore permettendo il salvataggio dei dati dei sensori e
l’upload del firmware con il bootloader Digitecoboot. L’intera board è
anch’essa basata sullo standard UPIN-27.</p>
<p>Gli schemi elettrici realizzati in KiCad sono disponibili nella cartella:</p>
<p>kicad/r-map_v3/Microduino_SD_DE</p>
</div>
<div class="section" id="stima-sim800c-power">
<h3>Stima SIM800C Power<a class="headerlink" href="#stima-sim800c-power" title="Link a questa intestazione">¶</a></h3>
<p><a class="reference internal" href="../../_images/100000000000009C000000AD009D4C95E03328E3.jpg"><img alt="image12" src="../../_images/100000000000009C000000AD009D4C95E03328E3.jpg" style="width: 3.602cm; height: 4.001cm;" /></a><a class="reference internal" href="../../_images/100000000000009F000000AD91A590CDC2953A54.jpg"><img alt="image13" src="../../_images/100000000000009F000000AD91A590CDC2953A54.jpg" style="width: 3.679cm; height: 4.001cm;" /></a></p>
<p>Il modulo SIM800C Power costituisce il modulo di alimentazione per il
modulo GSM/GPRS SIM800C ed include il connettore per la SIM Card in
formato standard. Basato sul connettore UPIN-27, necessita di ulteriori
6 pin posti a contatto con la parte posteriore del connettore
principale, atti al trasporto di tensioni di alimentazione e segnali
verso il modulo SIM800C posto nella board Stima SIM800C Module.</p>
<p>Il comparto di alimentazione è realizzato mediante alimentatore
switching e fornisce la giusta alimentazione al modulo SIM800C a partire
dalla tensione di alimentazione primaria di 5V.</p>
<p>A causa dell’ingombro in altezza maggiorato rispetto ad una board
standard dovuto alla componentistica elettronica, tale scheda è
impilabile solamente attraverso l’adozione di una fila di pin del tipo
UPIN-27.</p>
<p>Gli schemi elettrici realizzati in KiCad sono disponibili nella cartella:</p>
<p>kicad/r-map_v3/Microduino_GSM_DE/SIM_shield_DE</p>
</div>
<div class="section" id="stima-sim800c-module">
<h3>Stima SIM800C Module<a class="headerlink" href="#stima-sim800c-module" title="Link a questa intestazione">¶</a></h3>
<p><a class="reference internal" href="../../_images/1000000000000091000000D997BF03554711E1F9.jpg"><img alt="image14" src="../../_images/1000000000000091000000D997BF03554711E1F9.jpg" style="width: 3.023cm; height: 4.5cm;" /></a><a class="reference internal" href="../../_images/1000000000000095000000D91AFF552082E80FA7.jpg"><img alt="image15" src="../../_images/1000000000000095000000D91AFF552082E80FA7.jpg" style="width: 3.096cm; height: 4.5cm;" /></a></p>
<p>In tale modulo basato sul connettore UPIN-27, trova alloggio il modulo
GSM/GPRS SIM800C, due led di funzionamento ed il connettore SMA per il
collegamento dell’antenna, introdotto in quanto molto più solido,
robusto e di facile installazione rispetto a quello adottato sulle board
Microduino.</p>
<p>Per garantire il risparmio energetico della stazione, il modulo GSM/GPRS
è sempre spento e viene acceso solo nel momento in cui si rende
necessario il suo utilizzo. L’operazione di accensione o spegnimento è
effettuata ponendo a livello logico basso il pin dedicato del modulo per
almeno un secondo. L’identificazione di tale pin è inserita nel file
gsm_config.h nella cartella platformio/stima_ve/stima/include.</p>
<p>Il modulo è provvisto di due led di stato che forniscono indicazioni sul
funzionamento e sullo stato della rete. In particolare, osservando il
modulo frontalmente, il led di sinistra:</p>
<ul class="simple">
<li><p>Acceso: il modulo è acceso ed è in funzionamento</p></li>
<li><p>Spento: il modulo è spento</p></li>
</ul>
<p>Il led di destra:</p>
<ul class="simple">
<li><p>Spento: il modulo è spento</p></li>
<li><p>Acceso per 64ms e spento per 800ms: il modulo non è registrato sulla
rete</p></li>
<li><p>Acceso per 64ms e spento per 3000ms: il modulo è registrato sulla
rete</p></li>
<li><p>Acceso per 64ms e spento per 300ms: comunicazione GPRS in corso</p></li>
</ul>
<p>Si consiglia quindi di impilare per prima la board Stima SIM800C Power,
di interporre un’ulteriore fila di pin del connettore UPIN-27 e di
impilare in testa la board Stima SIM800C Module.</p>
<p>Gli schemi elettrici realizzati in KiCad sono disponibili nella cartella:</p>
<p>kicad/r-map_v3/Microduino_GSM_DE/SIM800C_DE</p>
</div>
<div class="section" id="stima-i2c-hub">
<h3>Stima I2C-HUB<a class="headerlink" href="#stima-i2c-hub" title="Link a questa intestazione">¶</a></h3>
<p><a class="reference internal" href="../../_images/100000000000010E000001B1A0413A5CCCDE9CF2.jpg"><img alt="image16" src="../../_images/100000000000010E000001B1A0413A5CCCDE9CF2.jpg" style="width: 4.367cm; height: 7.001cm;" /></a><a class="reference internal" href="../../_images/1000000000000112000001B1D4FF4C4434FC1D0B.jpg"><img alt="image17" src="../../_images/1000000000000112000001B1D4FF4C4434FC1D0B.jpg" style="width: 4.424cm; height: 7.001cm;" /></a></p>
<p>Il modulo Stima I2C-HUB garantisce la massima modularità dell’intero
progetto della stazione meteorologica Stima, preservando la
compatibilità con tutti i moduli Stima esistenti e garantendo il
collegamento su bus I<sup>2</sup>C di dispositivi operanti a tensioni di
3.3 V e 5 V contemporaneamente.</p>
<p>L’HUB presenta una porta in ingresso e sei porte in uscita, utilizzabili
per il collegamento e/o alimentazione di moduli su bus I<sup>2</sup>C.
Ogni porta è realizzata mediante il connettore a quattro pin dello
stesso tipo di quello installato negli altri moduli (Stima I2C-Base e
Stima I2C-Digital).</p>
<p>Fatta eccezione per la porta in ingresso, la quale dev’essere sempre
collegata ad un bus I<sup>2</sup>C a 5V, ognuna delle sei porte in
uscita è configurabile indipendentemente per collegare e/o alimentare
moduli funzionanti a tensioni di 3.3V o 5V, selezionabili facilmente e
velocemente attraverso un jumper posto in prossimità di ogni porta.
Inoltre, ogni singola porta è bufferizzata e protetta contro scariche
elettrostatiche.</p>
<p>L’HUB è in grado di ricevere alimentazione a 5V attraverso il connettore
USB tipo B o dalla porta in ingresso con connettore a quattro pin. Tale
alimentazione, verrà propagata sull’intera linea a 5V e su tutti i
moduli connessi all’HUB.</p>
<p>Diversamente, un circuito di alimentazione da 5V a 3.3V posto sull’HUB,
provvederà ad alimentare tutti i moduli collegati sul bus a 3.3V.</p>
<p>Con riferimento alla porta in ingresso con connettore a quattro pin, si
evidenzia che tale porta può essere adottata per collegare un HUB B ad
un ad HUB A nel caso in cui vi sia la necessità di collegare un certo
numero di periferiche sull’HUB B posto a distanza dall’HUB A. In tal
caso, sarà sufficiente collegare attraverso un cavo, una delle sei porte
in uscita dell’HUB A impostata a 5V al connettore in ingresso dell’HUB
B.</p>
<p>Stima I2C-HUB consente la piena modularità della stazione Stima,
garantendo molteplici topologie di collegamento dei moduli o dei
sensori, facilitandone la connessione ed il cablaggio e dimenticandosi
di calcolare di volta in volta i giusti valori di resistenze di pull-up
e il massimo limite di capacità del bus I<sup>2</sup>C.</p>
<p>Gli schemi elettrici realizzati in KiCad sono disponibili nella cartella:</p>
<p>kicad/r-map_v3/Microduino_HUB_DE</p>
</div>
<div class="section" id="regolatore-di-tensione-e-carica-della-batteria-con-bus-i2c-digitecopower">
<h3>Regolatore di tensione e carica della batteria con bus I<sup>2</sup>C DigitecoPower<a class="headerlink" href="#regolatore-di-tensione-e-carica-della-batteria-con-bus-i2c-digitecopower" title="Link a questa intestazione">¶</a></h3>
<p>Il regolatore di alimentazione DigitecoPower, di tipo switching, è
progettato per garantire un uso efficiente della batteria con
funzionamento in tampone.</p>
<p>Nel caso specifico, il regolatore monitorerà lo stato di salute della
batteria fornendo i dati riassuntivi tramite interrogazione su bus
I<sup>2</sup>C. È provvisto di una linea di alimentazione 12-30 V DC
fornita da un pannello fotovoltaico o da un alimentatore DC, di una
linea a 12V in uscita per la connessione di una batteria al piombo di
tipo sigillato e di quattro pin per la connessione di tale alimentatore
alla porta a quattro pin in ingresso al HUB.</p>
<p>In particolare, i valori monitorabili ed acquisiti attraverso la
libreria DigitecoPower implementata nella libreria SensorDriver, sono:</p>
<ul class="simple">
<li><p>Tensione di alimentazione</p></li>
<li><p>Corrente di alimentazione</p></li>
<li><p>Tensione di batteria</p></li>
<li><p>Corrente di batteria</p></li>
<li><p>Percentuale di carica della batteria</p></li>
<li><p>Tensione a 5V</p></li>
</ul>
<p>Per la verifica istantanea del funzionamento, è presente un led di
notifica tri-colore (rosso, giallo, verde) in grado di indicare la
carica o meno della batteria ed il livello di energia della stessa:</p>
<ul class="simple">
<li><p>Led rosso: batteria scarica</p></li>
<li><p>Led giallo: batteria mediamente carica</p></li>
<li><p>Led verde: batteria carica</p></li>
<li><p>Led lampeggiante lentamente: batteria in scarica</p></li>
<li><p>Led lampeggiante velocemente: batteria in carica</p></li>
</ul>
<p>Ad esempio, un led rosso con un lampeggio veloce indica che la batteria
è scarica e si sta caricando, diversamente, un led verde con lampeggio
lento, indica che la batteria è carica ma si sta scaricando.</p>
<p>Per l’interfacciamento di tale modulo, si faccia riferimento al seguente
schema di collegamento:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 11%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Collegamento</p></th>
<th class="head"><p>Nome</p></th>
<th class="head"><p>Descrizione</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>VCC_IN</p></td>
<td><p>ingresso alimentazione 12-30V DC VCC (+)</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>GND_IN</p></td>
<td><p>ingresso alimentazione 12-30V DC GND (-)</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>VCC_BAT</p></td>
<td><p>uscita alimentazione batteria 12V DC VCC (+)</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>GND_BAT</p></td>
<td><p>uscita alimentazione batteria 12V DC GND (-)</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>LED</p></td>
<td><p>LED di stato</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>VCC_OUT</p></td>
<td><p>uscita tensione di alimentazione HUB 5V DC VCC (+)</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>SCL</p></td>
<td><p>I2C SCL HUB</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>SDA</p></td>
<td><p>I2C SDA HUB</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>GND_OUT</p></td>
<td><p>uscita tensione di alimentazione HUB 5V DC GND (-)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="display-lcd-20x4-con-interfaccia-i2c">
<h3>Display LCD 20x4 con interfaccia I2C<a class="headerlink" href="#display-lcd-20x4-con-interfaccia-i2c" title="Link a questa intestazione">¶</a></h3>
<p>Il display consente di visualizzare lo stato della stazione: prossimo
orario di acquisizione, stato del salvataggio dei dati su sd-card, stato
dell’invio dei dati attraverso mqtt ed un valore rappresentativo
dell’ultima acquisizione, utile per verificare in campo il corretto
funzionamento della strumentazione.</p>
<p>Inoltre, è provvisto di un pulsante per l’accensione temporanea della
retroilluminazione, evitando inutilmente il consumo della batteria.</p>
</div>
</div>
<div class="section" id="configurazioni-hardware-dei-moduli-stima">
<h2>Configurazioni hardware dei moduli Stima<a class="headerlink" href="#configurazioni-hardware-dei-moduli-stima" title="Link a questa intestazione">¶</a></h2>
<div class="section" id="modulo-stima-ethernet-master">
<h3>Modulo Stima Ethernet (master)<a class="headerlink" href="#modulo-stima-ethernet-master" title="Link a questa intestazione">¶</a></h3>
<p><a class="reference internal" href="../../_images/10000000000002080000039C7112DE85740F92D8.jpg"><img alt="image18" src="../../_images/10000000000002080000039C7112DE85740F92D8.jpg" style="width: 5.999cm; height: 10.666cm;" /></a></p>
<p>Il modulo Stima Ethernet consente la connessione della stazione
attraverso Ethernet con eventuale alimentazione PoE ed è realizzabile
assemblando i seguenti moduli (dal basso verso l’alto):</p>
<ol class="arabic simple">
<li><p>Stima I2C-Base &#64; 5V</p></li>
<li><p>Microduino Ethernet WIZ</p></li>
<li><p>Microduino RJ45</p></li>
<li><p>Stima core+1284 &#64; 5V</p></li>
<li><p>Stima I2C-RTC &#64; 5V</p></li>
<li><p>Stima FT232RL</p></li>
<li><p>Stima SD-Card</p></li>
</ol>
<p>Successivamente sarà necessario fornire connettività Ethernet e
alimentazione attraverso una delle seguenti modalità:</p>
<ul class="simple">
<li><p>Power over ethernet (PoE)</p></li>
<li><p>Connettore micro USB posto sulla board Stima FT232RL</p></li>
<li><p>Connettore a quattro pin posto sulla board Stima I2C-Base</p></li>
<li><p>Collegando il modulo a Stima I2C-HUB</p></li>
</ul>
</div>
<div class="section" id="modulo-stima-gsm-gprs-master">
<h3>Modulo Stima GSM/GPRS (master)<a class="headerlink" href="#modulo-stima-gsm-gprs-master" title="Link a questa intestazione">¶</a></h3>
<p><a class="reference internal" href="../../_images/10000000000002080000039C60408299913E84DA.jpg"><img alt="image19" src="../../_images/10000000000002080000039C60408299913E84DA.jpg" style="width: 6.001cm; height: 10.666cm;" /></a></p>
<p>Il modulo Stima GSM/GPRS consente la connessione della stazione
attraverso GPRS ed è realizzabile assemblando i seguenti moduli (dal
basso verso l’alto):</p>
<ol class="arabic simple">
<li><p>Stima I2C-Base &#64; 5V</p></li>
<li><p>Stima SIM800C Power</p></li>
<li><p>Stima SIM800C Module</p></li>
<li><p>Stima core+1284 &#64; 5V</p></li>
<li><p>Stima I2C-RTC &#64; 5V</p></li>
<li><p>Stima FT232RL</p></li>
<li><p>Stima SD-Card</p></li>
</ol>
<p>Infine, è necessario collegare un’antenna GPRS Dual Band 850/1900 MHz
attraverso il connettore SMA posto sulla board Stima SIM800C Module e
fornire alimentazione attraverso una delle seguenti modalità:</p>
<ul class="simple">
<li><p>Connettore micro USB posto sulla board Stima FT232RL</p></li>
<li><p>Connettore a quattro pin posto sulla board Stima I2C-Base</p></li>
<li><p>Collegando il modulo a Stima I2C-HUB</p></li>
</ul>
</div>
<div class="section" id="modulo-stima-passivo-master">
<h3>Modulo Stima Passivo (master)<a class="headerlink" href="#modulo-stima-passivo-master" title="Link a questa intestazione">¶</a></h3>
<p>Tale modulo passivo permette di acquisire i sensori collegati su bus
I<sup>2</sup>C e di esporre i dati ad un altro modulo “attivo”
attraverso Remote Procedure Call (RPC) ed è realizzabile assemblando i
seguenti moduli (dal basso verso l’alto):</p>
<ol class="arabic simple">
<li><p>Stima I2C-Base &#64; 5V / 3.3V</p></li>
<li><p>Stima core+1284 &#64; 5V / Stima core+644 &#64; 3.3V</p></li>
<li><p>Stima I2C-RTC &#64; 5V / 3.3V</p></li>
<li><p>Stima FT232RL</p></li>
</ol>
<p>A tale modulo, è possibile fornire alimentazione attraverso una delle
seguenti modalità:</p>
<ul class="simple">
<li><p>Connettore micro USB posto sulla board Stima FT232RL</p></li>
<li><p>Connettore a quattro pin posto sulla board Stima I2C-Base</p></li>
<li><p>Collegando il modulo a Stima I2C-HUB</p></li>
</ul>
</div>
<div class="section" id="modulo-stima-i2c-th">
<h3>Modulo Stima I2C-TH<a class="headerlink" href="#modulo-stima-i2c-th" title="Link a questa intestazione">¶</a></h3>
<p>Acquisisce i dati dai sensori di temperatura e umidità collegati su bus
I<sup>2</sup>C fornendo elaborazioni relative a valori istantanei,
minimi, medi e massimi. Tali dati potranno essere acquisiti da uno dei
moduli atti a tale operazione, attraverso la libreria SensorDriver.</p>
<p><a class="reference internal" href="../../_images/10000000000002080000039C65525BFD8A198AD1.jpg"><img alt="image20" src="../../_images/10000000000002080000039C65525BFD8A198AD1.jpg" style="width: 6.001cm; height: 10.666cm;" /></a></p>
<p>Nello specifico, assemblare il modulo con le seguenti board (dal basso
verso l’alto):</p>
<ol class="arabic simple">
<li><p>Stima I2C-Base &#64; 3.3V</p></li>
<li><p>Stima core+644 &#64; 3.3V</p></li>
<li><p>Stima FT232RL</p></li>
<li><p>Stima SD-Card</p></li>
</ol>
<p>Per garantire il risparmio energetico della stazione, il modulo Stima
I2C-TH è perennemente posto in risparmio energetico sufficiente al
mantenimento del funzionamento del clock della CPU e del timer ad
elevata precisione posto all’interno del microcontrollore.</p>
<p>Il timer è programmato per generare un interrupt allo scadere di un
certo intervallo di tempo in secondi (programmabile via software),
corrispondente all’intervallo di acquisizione dei sensori di temperatura
e umidità.</p>
<p>Al termine delle operazioni di acquisizione dei sensori, il
microcontrollore torna in risparmio energetico attendendo il successivo
istante di acquisizione.</p>
</div>
<div class="section" id="modulo-stima-i2c-rain">
<h3>Modulo Stima I2C-Rain<a class="headerlink" href="#modulo-stima-i2c-rain" title="Link a questa intestazione">¶</a></h3>
<p>Effettua un conteggio del numero di basculate di un pluviometro
nell’arco di tempo desiderato. Tale dato sarà acquisito da uno dei
moduli atti a tale operazione, attraverso la libreria SensorDriver.</p>
<p><a class="reference internal" href="../../_images/10000000000002080000039CD77BF3581111FD6D.jpg"><img alt="image21" src="../../_images/10000000000002080000039CD77BF3581111FD6D.jpg" style="width: 6.001cm; height: 10.666cm;" /></a></p>
<p>Nello specifico, assemblare il modulo con le seguenti board
(dal basso verso l’alto):</p>
<ol class="arabic simple">
<li><p>Stima I2C-Base &#64; 3.3V</p></li>
<li><p>Stima core+644 &#64; 3.3V</p></li>
<li><p>Stima I2C-Digital</p></li>
<li><p>Stima FT232RL</p></li>
<li><p>Stima SD-Card</p></li>
</ol>
<p>In genere la segnalazione di una basculata del pluviometro viene fornita
con la chiusura di un contatto elettrico. Tale collegamento può essere
realizzato mediante collegamento al pin di massa e ad una delle tre
linee di interrupt presenti sul connettore a quattro pin sulla board
Stima I2C-Digital.</p>
<p>Per garantire il risparmio energetico della stazione, il modulo Stima
I2C-Rain è perennemente posto in risparmio energetico profondo e
risvegliato all’occorrenza da un interrupt scaturito dalla basculata del
pluviometro.</p>
</div>
<div class="section" id="modulo-stima-sensor-config">
<h3>Modulo Stima sensor_config<a class="headerlink" href="#modulo-stima-sensor-config" title="Link a questa intestazione">¶</a></h3>
<p>questo è un modulo opzionale utilizzato una tantum per:</p>
<ul class="simple">
<li><p>configurare sensori e moduli</p></li>
<li><p>configurare la stazione</p></li>
<li><p>formattare SD card</p></li>
<li><p>fare semplici operazioni di diagnostica</p></li>
</ul>
<p>Nello specifico, assemblare il modulo con le seguenti board
(dal basso verso l’alto):</p>
<ol class="arabic simple">
<li><p>Stima I2C-Base &#64; 5V</p></li>
<li><p>Stima core+ 1284 &#64; 5V</p></li>
<li><p>Stima FT232RL</p></li>
<li><p>Stima SD-Card</p></li>
</ol>
<p>Collegare poi un encoder di tipo incrementale con pulsante (ad esempio Alps EC11B152442D)
secondo questo schema:</p>
<ul class="simple">
<li><p>D2: encoder A</p></li>
<li><p>D3: encoder B</p></li>
<li><p>D9: button A</p></li>
<li><p>GND: encoder common e button B</p></li>
</ul>
</div>
</div>
<div class="section" id="configurazioni-software-dei-moduli-stima">
<h2>Configurazioni software dei moduli Stima<a class="headerlink" href="#configurazioni-software-dei-moduli-stima" title="Link a questa intestazione">¶</a></h2>
<div class="section" id="installazione-del-software-per-la-configurazione">
<h3>Installazione del software per la configurazione<a class="headerlink" href="#installazione-del-software-per-la-configurazione" title="Link a questa intestazione">¶</a></h3>
<p>Installare Rocky linux 8.</p>
<p>Aggiunta repository e installazione pacchetti da utente amministratore</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dnf</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">epel</span><span class="o">-</span><span class="n">release</span>
<span class="n">dnf</span> <span class="n">install</span> <span class="n">yum</span><span class="o">-</span><span class="n">plugin</span><span class="o">-</span><span class="n">copr</span>
<span class="n">dnf</span> <span class="n">copr</span> <span class="n">enable</span> <span class="n">simc</span><span class="o">/</span><span class="n">stable</span>
<span class="n">dnf</span> <span class="n">copr</span> <span class="n">enable</span> <span class="n">pat1</span><span class="o">/</span><span class="n">rmap</span>
<span class="n">dnf</span> <span class="n">config</span><span class="o">-</span><span class="n">manager</span> <span class="o">--</span><span class="nb">set</span><span class="o">-</span><span class="n">enabled</span> <span class="n">powertools</span>
<span class="n">dnf</span> <span class="n">groupinstall</span> <span class="n">rmap</span>
</pre></div>
</div>
</div>
<div class="section" id="installazione-del-software-per-la-compilazione-dei-firmware">
<h3>Installazione del software per la compilazione dei firmware<a class="headerlink" href="#installazione-del-software-per-la-compilazione-dei-firmware" title="Link a questa intestazione">¶</a></h3>
<p>Per compilazione del firmware è necessario installare PlatformIO
<a class="reference external" href="https://platformio.org">https://platformio.org</a></p>
<p>Utilizzeremo per la copilazione i comandi a CLI tramite Command Line Tool.
Quindi seguire le istruzioni a:
<a class="reference external" href="https://platformio.org/install/cli">https://platformio.org/install/cli</a></p>
</div>
<div class="section" id="installazione-dei-sorgenti-dei-firmware-e-dei-progetti-kicad">
<h3>Installazione dei sorgenti dei firmware e dei progetti kicad<a class="headerlink" href="#installazione-dei-sorgenti-dei-firmware-e-dei-progetti-kicad" title="Link a questa intestazione">¶</a></h3>
<p>Scaricare e scompattare l'ultima release denominata Stima disponibile a:
<a class="reference external" href="https://github.com/r-map/rmap/releases">https://github.com/r-map/rmap/releases</a>
ad esempio:
<a class="reference external" href="https://github.com/r-map/rmap/archive/refs/tags/3.4.tar.gz">https://github.com/r-map/rmap/archive/refs/tags/3.4.tar.gz</a></p>
</div>
<div class="section" id="modulo-stima-gsm-gprs">
<h3>Modulo Stima GSM/GPRS<a class="headerlink" href="#modulo-stima-gsm-gprs" title="Link a questa intestazione">¶</a></h3>
<ol class="arabic">
<li><p>Il progetto per platformio si trova in:
platformio/stima_v3/stima</p></li>
<li><p>Aprire il file stima-config.h in platformio/stima_v3/stima/src:</p>
<ul class="simple">
<li><p>Impostare la #define MODULE_TYPE con il valore
STIMA_MODULE_TYPE_REPORT_GSM per definire una stazione di tipo
report o STIMA_MODULE_TYPE_SAMPLE_GSM per definire una stazione di
tipo sample</p></li>
</ul>
</li>
<li><p>Aprire il file sensors_config.h nella cartella
platformio/stima_v3/stima/include:</p>
<ul class="simple">
<li><p>Settare la #define USE_JSON con il valore true</p></li>
<li><p>Settare le altre #define USE_SENSOR_XXX con valori true o false a
seconda dei sensori che si vuole abilitare o disabilitare</p></li>
<li><p>Impostare il valore in decimi di mm di pioggia per ogni basculata
del pluviometro nella #define RAIN_FOR_TIP</p></li>
</ul>
</li>
<li><ul class="simple">
<li><p>Impostare il numero di valori da leggere per ogni singolo sensore
nella #define VALUES_TO_READ_FROM_SENSOR_COUNT (tra tutti i valori
a disposizione, inserire quello più alto)</p></li>
</ul>
</li>
<li><ul class="simple">
<li><p>Impostare il valore in minuti per il calcolo di un’osservazione
nella #define OBSERVATIONS_MINUTES (in genere 1)</p></li>
<li><p>Impostare il numero di osservazioni necessarie a produrre un dato
utile per il report nella #define STATISTICAL_DATA_COUNT (in
genere 15)</p></li>
</ul>
</li>
<li><p>Impostare il microcontrollore su core+1284 a 5V</p></li>
<li><p>Compilare il firmware e caricarlo attraverso il cavo USB
tramite il comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">platformio</span><span class="o">/</span><span class="n">stima_v3</span><span class="o">/</span><span class="n">stima</span>
<span class="n">pio</span> <span class="n">run</span> <span class="o">-</span><span class="n">e</span> <span class="mi">1284</span><span class="n">p16m</span> <span class="o">-</span><span class="n">t</span> <span class="n">upload</span>
</pre></div>
</div>
</li>
<li><p>Inserire il jumper sulla board Stima I2C-Base, configurare la
stazione e rimuovere il jumper a configurazione terminata</p></li>
</ol>
<p>Per la configurazione:</p>
<ul>
<li><p>Per ottenere una username e una password iscriversi al sito <a class="reference external" href="http://rmap.cc/registrazione/register/">http://rmap.cc/registrazione/register/</a></p></li>
<li><p>Eventualmente (dopo la prima configurazione) ponticellare sulla scheda i pin &quot;Set&quot;.</p></li>
<li><p>Eseguire i comandi:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmapctrl</span> <span class="o">--</span><span class="n">syncdb</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">wizard</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=&lt;</span><span class="n">nome_stazione</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">height</span><span class="o">=&lt;</span><span class="n">height</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">stationname</span><span class="o">=&lt;</span><span class="n">nome_descrittivo</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">username</span><span class="o">=&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">password</span><span class="o">=&lt;</span><span class="n">password</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">server</span><span class="o">=</span><span class="n">rmap</span><span class="o">.</span><span class="n">cc</span> <span class="o">--</span><span class="n">lat</span><span class="o">=&lt;</span><span class="n">xx</span><span class="o">.</span><span class="n">xxxxx</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">lon</span><span class="o">=&lt;</span><span class="n">xx</span><span class="o">.</span><span class="n">xxxxx</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">mqttrootpath</span><span class="o">=</span><span class="n">report</span> <span class="o">--</span><span class="n">mqttmaintpath</span><span class="o">=</span><span class="n">maint</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addboard</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=&lt;</span><span class="n">nome_stazione</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=&lt;</span><span class="n">board_name</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">user</span><span class="o">=&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">serialactivate</span> <span class="o">--</span><span class="n">mqttactivate</span> <span class="o">--</span><span class="n">mqttuser</span><span class="o">=&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">mqttpassword</span><span class="o">=&lt;</span><span class="n">password</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">mqttsamplerate</span><span class="o">=</span><span class="mi">900</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addsensors_by_template</span><span class="o">=</span><span class="n">stima_report_thpb</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=&lt;</span><span class="n">nome_stazione</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=&lt;</span><span class="n">nome_board</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">user</span><span class="o">=&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">password</span><span class="o">=&lt;</span><span class="n">password</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">upload_to_server</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">config_station</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=&lt;</span><span class="n">nome_stazione</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=&lt;</span><span class="n">nome_board</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">username</span><span class="o">=&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">baudrate</span> <span class="mi">115200</span>
</pre></div>
</div>
<p>sostituendo i valori &lt;&gt; con opportuni valori.</p>
</li>
<li><p>Rimuovere il ponticello ai pin &quot;Set&quot;.</p></li>
</ul>
</div>
<div class="section" id="modulo-stima-ethernet">
<h3>Modulo Stima Ethernet<a class="headerlink" href="#modulo-stima-ethernet" title="Link a questa intestazione">¶</a></h3>
<ol class="arabic">
<li><p>Il progetto per platformio si trova in:
platformio/stima_v3/stima</p></li>
<li><p>Aprire il file stima-config.h in platformio/stima_v3/stima/src:</p>
<ul class="simple">
<li><p>Impostare la #define MODULE_TYPE con il valore
STIMA_MODULE_TYPE_REPORT_ETH per definire una stazione di tipo
report o STIMA_MODULE_TYPE_SAMPLE_ETH per definire una stazione di
tipo sample</p></li>
</ul>
</li>
<li><p>Aprire il file sensors_config.h nella cartella
platformio/stima_v3/stima/include:</p>
<ul class="simple">
<li><p>Settare la #define USE_JSON con il valore true</p></li>
<li><p>Settare le altre #define USE_SENSOR_XXX con valori true o false a
seconda dei sensori che si vuole abilitare o disabilitare</p></li>
<li><p>Impostare il valore in decimi di mm di pioggia per ogni basculata
del pluviometro nella #define RAIN_FOR_TIP</p></li>
<li><p>Impostare il numero di valori da leggere per ogni singolo sensore
nella #define VALUES_TO_READ_FROM_SENSOR_COUNT (tra tutti i valori
a disposizione, inserire quello più alto)</p></li>
<li><p>Impostare il valore in minuti per il calcolo di un’osservazione
nella #define OBSERVATIONS_MINUTES (in genere 1)</p></li>
<li><p>Impostare il numero di osservazioni necessarie a produrre un dato
utile per il report nella #define STATISTICAL_DATA_COUNT (in
genere 15)</p></li>
</ul>
</li>
<li><p>Impostare il microcontrollore su core+1284 a 5V</p></li>
<li><p>Compilare il firmware e caricarlo attraverso il cavo USB
tramite il comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">platformio</span><span class="o">/</span><span class="n">stima_v3</span><span class="o">/</span><span class="n">stima</span>
<span class="n">pio</span> <span class="n">run</span> <span class="o">-</span><span class="n">e</span> <span class="mi">1284</span><span class="n">p16m</span> <span class="o">-</span><span class="n">t</span> <span class="n">upload</span>
</pre></div>
</div>
</li>
<li><p>Inserire il jumper sulla board Stima I2C-Base, configurare la
stazione e rimuovere il jumper a configurazione terminata.</p></li>
</ol>
<p>Per la configurazione:</p>
<ul>
<li><p>Per ottenere una username e una password iscriversi al sito <a class="reference external" href="http://rmap.cc/registrazione/register/">http://rmap.cc/registrazione/register/</a></p></li>
<li><p>Eventualmente (dopo la prima configurazione) ponticellare sulla scheda i pin &quot;Set&quot;.</p></li>
<li><p>Eseguire i comandi:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rmapctrl</span> <span class="o">--</span><span class="n">syncdb</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">wizard</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=&lt;</span><span class="n">nome_stazione</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">height</span><span class="o">=&lt;</span><span class="n">height</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">stationname</span><span class="o">=&lt;</span><span class="n">nome_descrittivo</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">username</span><span class="o">=&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">password</span><span class="o">=&lt;</span><span class="n">password</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">server</span><span class="o">=</span><span class="n">rmap</span><span class="o">.</span><span class="n">cc</span> <span class="o">--</span><span class="n">lat</span><span class="o">=&lt;</span><span class="n">xx</span><span class="o">.</span><span class="n">xxxxx</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">lon</span><span class="o">=&lt;</span><span class="n">xx</span><span class="o">.</span><span class="n">xxxxx</span><span class="o">&gt;</span>  <span class="o">--</span><span class="n">mqttrootpath</span><span class="o">=</span><span class="n">report</span> <span class="o">--</span><span class="n">mqttmaintpath</span><span class="o">=</span><span class="n">maint</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addboard</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=&lt;</span><span class="n">nome_stazione</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=&lt;</span><span class="n">nome_board</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">user</span><span class="o">=&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">serialactivate</span> <span class="o">--</span><span class="n">mqttactivate</span> <span class="o">--</span><span class="n">mqttuser</span><span class="o">=&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">mqttpassword</span><span class="o">=&lt;</span><span class="n">password</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">mqttsamplerate</span><span class="o">=</span><span class="mi">900</span> <span class="o">--</span><span class="n">tcpipactivate</span> <span class="o">--</span><span class="n">tcpipntpserver</span><span class="o">=</span><span class="s2">&quot;it.pool.ntp.org&quot;</span> <span class="o">--</span><span class="n">tcpipname</span><span class="o">=</span><span class="n">stima</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">addsensors_by_template</span><span class="o">=</span><span class="n">stima_report_thpb</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=&lt;</span><span class="n">nome_stazione</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">board_slug</span><span class="o">=&lt;</span><span class="n">nome_board</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">user</span><span class="o">=&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">password</span><span class="o">=&lt;</span><span class="n">password</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">upload_to_server</span>
<span class="n">rmap</span><span class="o">-</span><span class="n">configure</span> <span class="o">--</span><span class="n">config_station</span> <span class="o">--</span><span class="n">station_slug</span><span class="o">=&lt;</span><span class="n">nome_stazione</span><span class="o">&gt;</span>  <span class="o">--</span><span class="n">board_slug</span><span class="o">=&lt;</span><span class="n">nome_board</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">username</span><span class="o">=&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">baudrate</span> <span class="mi">115200</span>
</pre></div>
</div>
<p>sostituendo i valori tra &lt;&gt; con opportuni valori.</p>
</li>
<li><p>Rimuovere il ponticello ai pin &quot;Set&quot;.</p></li>
</ul>
</div>
<div class="section" id="modulo-stima-passive">
<h3>Modulo Stima Passive<a class="headerlink" href="#modulo-stima-passive" title="Link a questa intestazione">¶</a></h3>
<ol class="arabic">
<li><p>Il progetto per platformio si trova in:
platformio/stima_v3/stima</p></li>
<li><p>Aprire il file stima-config.h platformio/stima_v3/stima/src:</p>
<ul class="simple">
<li><p>Impostare la #define MODULE_TYPE con il valore
STIMA_MODULE_TYPE_PASSIVE per definire una stazione di tipo
passivo</p></li>
</ul>
</li>
<li><p>Aprire il file sensors_config.h nella cartella
platformio/stima_v3/stima/include:</p>
<ul class="simple">
<li><p>Settare la #define USE_JSON con il valore true</p></li>
<li><p>Settare le altre #define USE_SENSOR_XXX con valori true o false a
seconda dei sensori che si vuole abilitare o disabilitare</p></li>
<li><p>Impostare il valore in decimi di mm di pioggia per ogni basculata
del pluviometro nella #define RAIN_FOR_TIP</p></li>
<li><p>Impostare il numero di valori da leggere per ogni singolo sensore
nella #define VALUES_TO_READ_FROM_SENSOR_COUNT (tra tutti i valori
a disposizione, inserire quello più alto)</p></li>
<li><p>Impostare il valore in minuti per il calcolo di un’osservazione
nella #define OBSERVATIONS_MINUTES (in genere 1)</p></li>
<li><p>Impostare il numero di osservazioni necessarie a produrre un dato
utile per il report nella #define STATISTICAL_DATA_COUNT (in
genere 15)</p></li>
</ul>
</li>
<li><p>Compilare il firmware e caricarlo attraverso il cavo USB
tramite il comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">platformio</span><span class="o">/</span><span class="n">stima_v3</span><span class="o">/</span><span class="n">stima</span>
<span class="n">pio</span> <span class="n">run</span> <span class="o">-</span><span class="n">e</span> <span class="mi">1284</span><span class="n">p16m</span> <span class="o">-</span><span class="n">t</span> <span class="n">upload</span>
</pre></div>
</div>
</li>
<li><p>Inserire il jumper sulla board Stima I2C-Base, configurare la
stazione e rimuovere il jumper a configurazione terminata</p></li>
</ol>
</div>
<div class="section" id="id2">
<h3>Modulo Stima I2C-TH<a class="headerlink" href="#id2" title="Link a questa intestazione">¶</a></h3>
<ol class="arabic">
<li><p>Aprire lo sketch i2c-th.ino nella cartella
platformio/stima_v3/i2c-th</p></li>
<li><p>Aprire il file sensors_config.h nella cartella
platformio/stima_v3/i2c-th/include:</p>
<ul class="simple">
<li><p>Settare la #define USE_JSON con il valore false</p></li>
<li><p>Settare le altre #define USE_SENSOR_XXX con valori true o false a
seconda dei sensori che si vuole abilitare o disabilitare</p></li>
<li><p>Impostare il numero di valori da leggere per ogni singolo sensore
nella #define VALUES_TO_READ_FROM_SENSOR_COUNT (tra tutti i valori
a disposizione, inserire quello più alto)</p></li>
<li><p>Impostare il valore in minuti per il calcolo di un’osservazione
nella #define OBSERVATIONS_MINUTES (in genere 1 o in accordo con
quanto impostato per la compilazione dello sketch stima.ino)</p></li>
<li><p>Impostare il numero di osservazioni necessarie a produrre un dato
utile per il report nella #define STATISTICAL_DATA_COUNT (in
genere 15 o in accordo con quanto impostato per la compilazione
dello sketch stima.ino)</p></li>
</ul>
</li>
<li><p>Compilare il firmware e caricarlo attraverso il cavo USB
tramite il comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">platformio</span><span class="o">/</span><span class="n">stima_v3</span><span class="o">/</span><span class="n">i2c</span><span class="o">-</span><span class="n">th</span>
<span class="n">pio</span> <span class="n">run</span> <span class="o">-</span><span class="n">e</span> <span class="mi">644</span><span class="n">pa8m</span> <span class="o">-</span><span class="n">t</span> <span class="n">upload</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id3">
<h3>Modulo Stima I2C-Rain<a class="headerlink" href="#id3" title="Link a questa intestazione">¶</a></h3>
<ol class="arabic">
<li><p>Il progetto platformio si trova nella cartella:
platformio/stima_v3/i2c-rain</p></li>
<li><p>Aprire il file sensors_config.h nella cartella
platformio/stima_v3/i2c-rain/include:</p>
<ul class="simple">
<li><p>Settare la #define USE_JSON con il valore false</p></li>
<li><p>Settare le altre #define USE_SENSOR_XXX con valori true o false a
seconda dei sensori che si vuole abilitare o disabilitare</p></li>
<li><p>Impostare il numero di valori da leggere per ogni singolo sensore
nella #define VALUES_TO_READ_FROM_SENSOR_COUNT (tra tutti i valori
a disposizione, inserire quello più alto)</p></li>
<li><p>Impostare la quantità di pioggia espressa in decimi di millimetro
da conteggiare per ogni basculata del pluviometro nella #define
RAIN_FOR_TIP</p></li>
</ul>
</li>
<li><p>Compilare il firmware e caricarlo attraverso il cavo USB
tramite il comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">platformio</span><span class="o">/</span><span class="n">stima_v3</span><span class="o">/</span><span class="n">i2c</span><span class="o">-</span><span class="n">rain</span>
<span class="n">pio</span> <span class="n">run</span> <span class="o">-</span><span class="n">e</span> <span class="mi">644</span><span class="n">pa8m</span> <span class="o">-</span><span class="n">t</span> <span class="n">upload</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="compilazione-e-caricamento-del-bootloader-digitecoboot">
<h2>Compilazione e caricamento del bootloader Digitecoboot<a class="headerlink" href="#compilazione-e-caricamento-del-bootloader-digitecoboot" title="Link a questa intestazione">¶</a></h2>
<ol class="arabic">
<li><p>Aprire il file avr_conf nella cartella digitecoboot</p></li>
<li><p>Editare la variabile AVR_DIR inserendo il percorso corretto per la
directory AVR</p></li>
<li><p>Nella cartella digitecoboot compilare il bootloader attraverso
-  make atmega644p
-  make atmega1284p</p></li>
<li><p>La compilazione produce i seguenti files:
-  digitecoboot_atmega644p.hex: booatloader per core+644
-  digitecoboot_atmega1284p.hex: booatloader per core+1284</p></li>
<li><p>Caricare il bootloader attraverso un programmatore impostando i
seguenti parametri: stk500v1, 19200 baud, Low fuse 0xFF, Extended
fuse 0xFD, High fuse 0xD0</p>
<p>Questo è un esempio dei comandi da impartire a avrdude:</p>
<ul class="simple">
<li><p>avrdude  -v -patmega1284p -cavrisp -P/dev/ttyUSB0 -b19200 -e -Ulock:w:0x3F:m -Uefuse:w:0xFD:m -Uhfuse:w:0xD0:m -Ulfuse:w:0xFF:m</p></li>
<li><p>avrdude  -v -patmega1284p -cavrisp -P/dev/ttyUSB0 -b19200 -V -U digitecoboot_atmega1284p.hex</p></li>
<li><p>avrdude  -v -patmega1284p -cavrisp -P/dev/ttyUSB0 -b19200 -U lock:w:0x0F:m</p></li>
</ul>
</li>
</ol>
<dl class="simple">
<dt>Per usare arduino come programmatore riferirsi a:</dt><dd><p><a class="reference external" href="https://docs.arduino.cc/built-in-examples/arduino-isp/ArduinoISP">https://docs.arduino.cc/built-in-examples/arduino-isp/ArduinoISP</a></p>
</dd>
</dl>
<p>E' possibile utilizzare due moduli microduino core+, uno 1284p16m da usare come programmatore e il secondo con la stessa tensione di funzionamento da programmare collegati come da schema:
<img alt="image_arduino_isp_schema" src="../../_images/microduino-arduino-isp.png" /></p>
<p>Un esempio di connessione rapida (il condensatore elettrolitico è assente):
<img alt="image_arduino_microduino_photo" src="../../_images/microduino-microduino-isp.png" /></p>
<p>Programmare il microduino-core+ da usare come ISP con il firmware
ArduinoIsp in ambiente platformio che si trova in
platformio/stima_v3/arduino_isp</p>
<p>ed eseguire:</p>
<ul class="simple">
<li><p>make atmega644p_isp</p></li>
</ul>
<p>oppure:</p>
<ul class="simple">
<li><p>make atmega1284p_isp</p></li>
</ul>
</div>
<div class="section" id="compilazione-del-firmware-in-formato-binario">
<h2>Compilazione del firmware in formato binario<a class="headerlink" href="#compilazione-del-firmware-in-formato-binario" title="Link a questa intestazione">¶</a></h2>
<ol class="arabic simple">
<li><p>Compilare il firmware per i moduli Stima secondo quanto scritto ai
punti precedenti</p></li>
<li><p>Localizzare il file firmware.elf compilato, solitamente
-  rmap/platformio/stima_v3/stima/.pio/build/1284p16m</p></li>
<li><p>Attraverso una consolle o il prompt dei comandi, eseguire
-  ~/.platformio/packages/toolchain-atmelavr/bin//avr-objcopy -I ihex -O binary firmware.elf FIRMWARE.BIN</p></li>
</ol>
</div>
<div class="section" id="upload-del-firmware-tramite-micro-sd-card-attraverso-digitecoboot">
<h2>Upload del firmware tramite micro SD-Card attraverso Digitecoboot<a class="headerlink" href="#upload-del-firmware-tramite-micro-sd-card-attraverso-digitecoboot" title="Link a questa intestazione">¶</a></h2>
<ol class="arabic simple">
<li><p>Copiare il file FIRMWARE.BIN su una micro SD-Card formattata in FAT32</p></li>
<li><p>Creare un file sulla scheda SD con il nome esattamente corrispondente alla
versione del firmware: ad esempio &quot;3.6&quot;</p></li>
<li><p>Inserire la micro SD-Card in uno dei moduli Stima Ethernet, Stima
GSM/GPRS, Stima I2C-TH o Stima-Rain</p></li>
<li><p>Alimentare il modulo e attendere 30 secondi per la fine del
caricamento del firmware</p></li>
<li><p>Spegnere il modulo e rimuovere eventualmente la micro SD-Card contenente il
firmware</p></li>
<li><p>Verificare sul display LCD la corretta versione del firmware</p></li>
<li><p>Se necessario, inserire la micro SD-Card utile per il funzionamento
del modulo (senza il file FIRMWARE.BIN)</p></li>
<li><p>Alimentare il modulo</p></li>
</ol>
</div>
<div class="section" id="configurazione-moduli-e-sensori">
<h2>Configurazione moduli e sensori<a class="headerlink" href="#configurazione-moduli-e-sensori" title="Link a questa intestazione">¶</a></h2>
<p>Per configurare moduli e sensori utilizzare lo sketch sensor_config_menu_sdcard
presente nella cartella platformio/stima_v3</p>
<p>E' sicuramente necessario se si voglio utilizzare più sensori o moduli
dello stesso tipo.</p>
<p>Fare riferimento al manuale utente per il suo utilizzo.</p>
</div>
<div class="section" id="assemblaggio-stazione-stima">
<h2>Assemblaggio stazione Stima<a class="headerlink" href="#assemblaggio-stazione-stima" title="Link a questa intestazione">¶</a></h2>
<p>Per assemblare una stazione Stima, è necessario disporre di:</p>
<ul class="simple">
<li><p>Stima I2C-Master nella versione GSM/GPRS o Ethernet</p></li>
<li><p>Stima I2C-HUB</p></li>
<li><p>Stima I2C-TH</p></li>
<li><p>Stima I2C-Rain</p></li>
<li><p>Sensore di temperatura e umidità Digiteco TU022 (con sensore HYT221 o
HYT271) oppure sensore di temperatura ADT7420 e sensore di umidità
HIH6100</p></li>
<li><p>Pluviometro Digiteco PL005 o Digiteco PL010 o qualsiasi altro
pluviometro con uscita a contatto</p></li>
<li><p>Cavi di collegamento:</p>
<ul>
<li><p>per sensore di temperatura e umidità Digiteco TU022: cavo 4 poli
con connettore a vite lato sensore e connettore 4 pin lato HUB</p></li>
<li><p>o per sensori ADT7420 e HIH6100 con cavi a 4 poli per sensore a
saldare lato sensore e connettore 4 pin lato HUB</p></li>
<li><p>per pluviometro a contatto: cavo a 2 poli con connettore 4 pin
lato modulo Stima I2C-Rain</p></li>
</ul>
</li>
<li><p>Antenna dual/quad band GPRS con connettore SMA per stazione GSM/GPRS</p></li>
<li><p>Contenitore stagno IP66 310x425x160</p></li>
<li><p>Batteria sigillata al piombo 12V e relativi cavi di collegamento con
fusibile di protezione</p></li>
<li><p>Pannello fotovoltaico 20W o sorgente di alimentazione continua 12-30
V</p></li>
<li><p>DigitecoPower: se presente batteria tampone 12V con pannello
fotovoltaico o sorgente di alimentazione esterna DC</p></li>
<li><p>Palo acciaio inox diametro 48 mm</p></li>
<li><p>Collare alluminio anodizzato per fissaggio a palo diametro 48 mm</p></li>
<li><p>Morsetto alluminio anodizzato per fissaggio a sensore diametro 40 mm</p></li>
<li><p>Braccetto alluminio anodizzato cilindrico per fissaggio del morsetto
sensore al collare del palo</p></li>
<li><p>Supporto per pluviometro</p></li>
<li><p>Display I2C LCD con supporto in alluminio</p></li>
<li><p>Supporti per moduli Stima su guida DIN</p></li>
</ul>
<p>Una volta aver collegato i sensori, i moduli Stima, compilato i firmware
e configurato tutti i moduli, così come illustrato nei capitoli
precedenti, la stazione è pronta per essere utilizzata.</p>
<p>Di seguito un esempio di installazione di una stazione Stima GSM/GPRS
con:</p>
<ul class="simple">
<li><p>Stima I2C-TH</p></li>
<li><p>Stima I2C-Rain</p></li>
<li><p>Stima I2C-HUB</p></li>
<li><p>DigitecoPower</p></li>
<li><p>Batteria sigillata 12V</p></li>
<li><p>Pannello fotovoltaico</p></li>
</ul>
<p><a class="reference internal" href="../../_images/10000000000004660000027A5B0AC97A38FC96F0.jpg"><img alt="image22" src="../../_images/10000000000004660000027A5B0AC97A38FC96F0.jpg" style="width: 15cm; height: 8.437cm;" /></a></p>
<p>A partire da sinistra, è visibile il modulo Stima GSM/GPRS dotato di
connettore tipo SMA per il collegamento dell’antenna. Al centro è
visibile il modulo Stima I2C-TH e subito a destra è posizionato il
modulo Stima I2C-Rain. Stima I2C-HUB collega i tre moduli, preleva
l’alimentazione attraverso il connettore in ingresso in basso a destra
dal modulo DigitecoPower e dispone di altre due porte libere per il
collegamento di ulteriori sensori e moduli su bus I<sup>2</sup>C.</p>
<p>Sono ben visibili i jumper, uno per porta, per la selezione della
corrispondente tensione di alimentazione (5V o 3.3V) per i moduli Stima
e per i sensori I2C.</p>
<p><a class="reference internal" href="../../_images/1000000000000512000006C2853D8725B012F802.jpg"><img alt="image23" src="../../_images/1000000000000512000006C2853D8725B012F802.jpg" style="width: 14.998cm; height: 19.999cm;" /></a></p>
<p><a class="reference internal" href="../../_images/1000000000000512000006C284D72348DD042022.jpg"><img alt="image24" src="../../_images/1000000000000512000006C284D72348DD042022.jpg" style="width: 15cm; height: 20.001cm;" /></a></p>
</div>
<div class="section" id="appendici">
<h2>Appendici<a class="headerlink" href="#appendici" title="Link a questa intestazione">¶</a></h2>
<div class="section" id="elenco-pin-utilizzati">
<h3>Elenco PIN utilizzati<a class="headerlink" href="#elenco-pin-utilizzati" title="Link a questa intestazione">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 45%" />
<col style="width: 39%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>File di definizione</p></th>
<th class="head"><p>Macro</p></th>
<th class="head"><p>valore</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sensor_config_menu_sdcard/src/sensor_config.ino</p></td>
<td><p>encA</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>sensor_config_menu_sdcard/src/sensor_config.ino</p></td>
<td><p>encB</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>stima/include/gsm_config.h</p></td>
<td><p>SIM800_ON_OFF_PIN</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>stima/src/stima-config.h</p></td>
<td><p>RTC_INTERRUPT_PIN</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>stima/src/stima-config.h</p></td>
<td><p>SDCARD_CHIP_SELECT_PIN</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>stima/src/stima-config.h</p></td>
<td><p>CONFIGURATION_RESET_PIN</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>sensor_config_menu_sdcard/src/sensor_config.ino</p></td>
<td><p>encBtn</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>stima/src/stima-config.h</p></td>
<td><p>W5500_CHIP_SELECT_PIN</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>stima/src/stima-config.h</p></td>
<td><p>GSM_ON_OFF_PIN</p></td>
<td><p>SIM800_ON_OFF_PIN</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="elenco-indirizzi-i2c">
<h3>Elenco indirizzi I2C<a class="headerlink" href="#elenco-indirizzi-i2c" title="Link a questa intestazione">¶</a></h3>
<p>moduli:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 42%" />
<col style="width: 40%" />
<col style="width: 18%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>File di definizione</p></th>
<th class="head"><p>Macro</p></th>
<th class="head"><p>valore</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Rmap/registers-master.h</p></td>
<td><p>I2C_MASTER_DEFAULT_ADDRESS</p></td>
<td><p>(0x20)</p></td>
</tr>
<tr class="row-odd"><td><p>Rmap/registers-rain.h</p></td>
<td><p>I2C_RAIN_DEFAULT_ADDRESS</p></td>
<td><p>(0x21)</p></td>
</tr>
<tr class="row-even"><td><p>Rmap/registers-power.h</p></td>
<td><p>I2C_POWER_DEFAULT_ADDRESS</p></td>
<td><p>(0x4A)</p></td>
</tr>
<tr class="row-odd"><td><p>Rmap/registers-wind.h:</p></td>
<td><p>I2C_WIND_DEFAULT_ADDRESS</p></td>
<td><p>(0x45)</p></td>
</tr>
<tr class="row-even"><td><p>Rmap/registers-th.h</p></td>
<td><p>I2C_TH_DEFAULT_ADDRESS</p></td>
<td><p>(0x23)</p></td>
</tr>
<tr class="row-odd"><td><p>Rmap/registers-radiation.h</p></td>
<td><p>I2C_SOLAR_RADIATION_DEFAULT_ADDRESS</p></td>
<td><p>(0x47)</p></td>
</tr>
</tbody>
</table>
<p>opzionali:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 47%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>File di definizione</p></th>
<th class="head"><p>Macro</p></th>
<th class="head"><p>valore</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Rmap/registers-leaf.h</p></td>
<td><p>I2C_LEAF_DEFAULT_ADDRESS</p></td>
<td><p>(0x65)</p></td>
</tr>
<tr class="row-odd"><td><p>Rmap/registers-opc.h</p></td>
<td><p>I2C_OPC_DEFAULT_ADDRESS</p></td>
<td><p>(0x55)</p></td>
</tr>
<tr class="row-even"><td><p>Rmap/registers-thr.h</p></td>
<td><p>I2C_THR_DEFAULT_ADDRESS</p></td>
<td><p>(0x23)</p></td>
</tr>
<tr class="row-odd"><td><p>Rmap/registers-thr.h</p></td>
<td><p>I2C_THR_TEMPERATURE_DEFAULT_ADDRESS</p></td>
<td><p>(0x49)</p></td>
</tr>
<tr class="row-even"><td><p>Rmap/registers-thr.h</p></td>
<td><p>I2C_THR_HUMIDITY_DEFAULT_ADDRESS</p></td>
<td><p>(0x27)</p></td>
</tr>
</tbody>
</table>
<p>sensori:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>File di definizione</p></th>
<th class="head"><p>valore</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HYT</p></td>
<td><p>(0x28)</p></td>
</tr>
<tr class="row-odd"><td><p>SHT</p></td>
<td><p>(0x44)</p></td>
</tr>
</tbody>
</table>
<p>ADC:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>File di definizione</p></th>
<th class="head"><p>valore</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ADC  radiation</p></td>
<td><p>(0x48)</p></td>
</tr>
<tr class="row-odd"><td><p>ADC  power</p></td>
<td><p>(0x49)</p></td>
</tr>
</tbody>
</table>
<p>display LCD</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 52%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>File di definizione</p></th>
<th class="head"><p>Macro</p></th>
<th class="head"><p>valore</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>include/lcd_config.h</p></td>
<td><p>LCD_I2C_ADDRESS</p></td>
<td><p>(0x3F)</p></td>
</tr>
<tr class="row-odd"><td><p>include/lcd_config.h</p></td>
<td><p>LCD_I2C_SECONDARY_ADDRESS</p></td>
<td><p>(0x27)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../development_guide/development_guide.html" class="btn btn-neutral float-right" title="Guida per lo sviluppo software" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../stima_v3.html" class="btn btn-neutral float-left" title="Stima V3" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, CC BY-SA 4.0, Arpae https://www.arpae.it.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>